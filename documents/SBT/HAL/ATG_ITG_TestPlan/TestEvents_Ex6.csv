TESTSUITENAME,HAL - Hybrid Automated Liaison Test Script for Example 6 from HAL-2 Test Plan
PRINTOUTPUTHEADING,
STARTPOINT,

COMMENT,Step 1: Create/Update and Login SA & Trader User; Verify Hybrid product existance; Verify empty book,
SALOGIN,$SA1,$SA1,TRUE,TRUE,Log in User $SA1,
SELECTREPORTINGCLASSESANDPRODUCTS,$SA1,$SESSION1,7,1,CLASS,5,PRODUCT,TAP,TRUE,TRUE,Comment...,
PAUSE,5000,
CREATEUSER,$SA1,$MM1,$MM1EXCHANGE,$MM1EXECFIRM,M,1,Automated API MM User,FALSE,TRUE,FALSE,Comment,
CREATEUSER,$SA1,$MM2,$MM2EXCHANGE,$MM2EXECFIRM,M,1,Automated API MM User,FALSE,TRUE,FALSE,Comment,
SETQUOTELOCKNOTIFICATIONTIMER,$SA1,$SESSION1,$CLASS1,1000,TRUE,TRUE,Set Quote Lock Notification Timer
SETQUOTELOCKTIMER,$SA1,$SESSION1,$CLASS1,7000,TRUE,TRUE,Set Quote Lock Timer
SETQUOTETRIGGERTIMER,$SA1,$SESSION1,$CLASS1,5000,TRUE,TRUE,Set Quote Trigger Timer
ASETALLOCATIONSTRATEGIES,$SA1,$SESSION1,$CLASS1,2=1;4;13 3=14 0=1;4;13,TRUE,TRUE,Set proper alloc strategies,
VERIFYQUOTELOCKNOTIFICATIONTIMER,$SA1,$SESSION1,$CLASS1,1000,TRUE,TRUE,Verify Quote Lock Notification Timer
VERIFYQUOTELOCKTIMER,$SA1,$SESSION1,$CLASS1,7000,TRUE,TRUE,Set Quote Lock Timer
VERIFYQUOTETRIGGERTIMER,$SA1,$SESSION1,$CLASS1,5000,TRUE,TRUE,Set Quote Trigger Timer
MYCOMMENT,CREATEUSER,$SA1,$MM3,$MM3EXCHANGE,$MM3EXECFIRM,M,1,Automated API MM User,FALSE,TRUE,FALSE,Comment,
MYCOMMENT,CREATEUSER,$SA1,$MM4,$MM4EXCHANGE,$MM4EXECFIRM,M,1,Automated API MM User,FALSE,TRUE,FALSE,Comment,
CREATEUSER,$SA1,$BD1,$BD1EXCHANGE,$BD1EXECFIRM,B,1,Automated API BD User,FALSE,TRUE,FALSE,Comment,
MYCOMMENT,CREATEUSER,$SA1,$BD2,$BD2EXCHANGE,$BD2EXECFIRM,B,1,Automated API CUST User,FALSE,TRUE,FALSE,Comment,
MYCOMMENT,CREATEUSER,$SA1,$BD3,$BD3EXCHANGE,$BD3EXECFIRM,B,1,Automated API CUST User,FALSE,TRUE,FALSE,Comment,
MYCOMMENT,CREATEUSER,$SA1,$BD4,$BD4EXCHANGE,$BD4EXECFIRM,B,1,Automated API CUST User,FALSE,TRUE,FALSE,Comment,
VERIFYUSEREXISTENCE,$SA1,$MM1EXCHANGE,$MM1,M,TRUE,TRUE,TRUE,Comment...,
VERIFYUSEREXISTENCE,$SA1,$MM2EXCHANGE,$MM2,M,TRUE,TRUE,TRUE,Comment...,
MYCOMMENT,VERIFYUSEREXISTENCE,$SA1,$MM3EXCHANGE,$MM3,M,TRUE,TRUE,TRUE,Comment...,
MYCOMMENT,VERIFYUSEREXISTENCE,$SA1,$MM4EXCHANGE,$MM4,M,TRUE,TRUE,TRUE,Comment...,
VERIFYUSEREXISTENCE,$SA1,$BD1EXCHANGE,$BD1,B,TRUE,TRUE,TRUE,Comment...,
MYCOMMENT,VERIFYUSEREXISTENCE,$SA1,$BD2EXCHANGE,$BD2,B,TRUE,TRUE,TRUE,Comment...,
MYCOMMENT,VERIFYUSEREXISTENCE,$SA1,$BD3EXCHANGE,$BD3,B,TRUE,TRUE,TRUE,Comment...,
MYCOMMENT,VERIFYUSEREXISTENCE,$SA1,$BD4EXCHANGE,$BD4,B,TRUE,TRUE,TRUE,Comment...,

COMMENT,Step 2: Log in Trader Users
TRADERLOGIN,$MM1,$MM1,$CASANDPORT,TRUE,TRUE,Logging in to enter Opening Quotes,
TRADERLOGIN,$BD1,$BD1,$CASANDPORT,TRUE,TRUE,Logging in BD user BD1.,Log in Traders & Clear Product's Market,
TRADERLOGIN,$MM2,$MM2,$CASANDPORT,TRUE,TRUE,Logging in MM user MM2.,
MYCOMMENT,TRADERLOGIN,$MM3,$MM3,$CASANDPORT,TRUE,TRUE,Logging in MM user MM3.,
MYCOMMENT,TRADERLOGIN,$MM4,$MM4,$CASANDPORT,TRUE,TRUE,Logging in MM user MM4.,
MYCOMMENT,TRADERLOGIN,$BD2,$BD2,$CASANDPORT,TRUE,TRUE,Logging in Customer user BD2.,
MYCOMMENT,TRADERLOGIN,$BD3,$BD3,$CASANDPORT,TRUE,TRUE,Logging in Customer user BD3.,
MYCOMMENT,TRADERLOGIN,$BD4,$BD4,$CASANDPORT,TRUE,TRUE,Logging in Customer user BD4.,
UNSETUSERQUOTERISKMANAGEMENT,$MM1,$CLASS1,TRUE,TRUE,UnSet QRM,

COMMENT,Step 3: Verify Session State; Set/Verify HAL Product States
CLEARALLCALLBACKS,$SA1,
VERIFYSESSIONSTATE,$SA1,$SESSION1,2,TRUE,TRUE,Verify Session is Open,
SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT1,CLASS1,1,TRUE,TRUE,Set Product to CLOSE,
SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT2,CLASS1,1,TRUE,TRUE,Set Product to CLOSE,
SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT3,CLASS1,1,TRUE,TRUE,Set Product to CLOSE,
MYCOMMENT,SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT4,CLASS1,1,TRUE,TRUE,Set Product to CLOSE,
MYCOMMENT,SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT5,CLASS1,1,TRUE,TRUE,Set Product to CLOSE,
SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT1,CLASS1,2,TRUE,TRUE,Set Product to PreOpen,
SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT2,CLASS1,2,TRUE,TRUE,Set Product to PreOpen,
SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT3,CLASS1,2,TRUE,TRUE,Set Product to PreOpen,
MYCOMMENT,SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT4,CLASS1,2,TRUE,TRUE,Set Product to PreOpen,
MYCOMMENT,SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT5,CLASS1,2,TRUE,TRUE,Set Product to PreOpen,
SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT1,CLASS1,3,TRUE,TRUE,Set Product to OpeningRotation,
SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT2,CLASS1,3,TRUE,TRUE,Set Product to OpeningRotation,
SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT3,CLASS1,3,TRUE,TRUE,Set Product to OpeningRotation,
MYCOMMENT,SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT4,CLASS1,3,TRUE,TRUE,Set Product to OpeningRotation,
MYCOMMENT,SETPRODUCTSTATEBYPRODUCT,$SA1,$SESSION1,$CLASS1PRODUCT5,CLASS1,3,TRUE,TRUE,Set Product to OpeningRotation,
PRODUCTSTATEQUERY,$SA1,$SESSION1,$CLASS1PRODUCT1,3,TRUE,TRUE,Verify Product is in OpeningRotation,
PRODUCTSTATEQUERY,$SA1,$SESSION1,$CLASS1PRODUCT2,3,TRUE,TRUE,Verify Product is in OpeningRotation,
PRODUCTSTATEQUERY,$SA1,$SESSION1,$CLASS1PRODUCT3,3,TRUE,TRUE,Verify Product is in OpeningRotation,
MYCOMMENT,PRODUCTSTATEQUERY,$SA1,$SESSION1,$CLASS1PRODUCT4,3,TRUE,TRUE,Verify Product is in OpeningRotation,
MYCOMMENT,PRODUCTSTATEQUERY,$SA1,$SESSION1,$CLASS1PRODUCT5,3,TRUE,TRUE,Verify Product is in OpeningRotation,


COMMENT,Step 4: Set/Verify Needed Trading Properties for the HAL class

SETAUCTIONMINMAXORDERSIZE,$SA1,$SESSION1,$CLASS1,1,50,1000,TRUE,TRUE,Set Min Max Order size
VERIFYAUCTIONMINMAXORDERSIZE,$SA1,$SESSION1,$CLASS1,1,50,1000,TRUE,TRUE,Verify Set Min Max Order size

SETAUCTIONTIMETOLIVE,$SA1,$SESSION1,$CLASS1,1,60000,72000,TRUE,TRUE,Set Auction time To live 60 - 72 sec's
VERIFYAUCTIONTIMETOLIVE,$SA1,$SESSION1,$CLASS1,1,60000,72000,TRUE,TRUE,Verify Set time To live 60 - 72 sec's

SETHALTRIGGERTIMER,$SA1,$SESSION1,$CLASS1,4,90000,TRUE,TRUE,Set HAL Trigger timer 90 sec's
VERIFYHALTRIGGERTIMER,$SA1,$SESSION1,$CLASS1,4,90000,TRUE,TRUE,Verify Set HAL Trigger timer 90 sec's

SETAUCTIONORDERTICKSAWAYFROMNBBO,$SA1,$SESSION1,$CLASS1,4,1,TRUE,TRUE,Set Ticks Away from NBBO to 1
VERIFYAUCTIONORDERTICKSAWAYFROMNBBO,$SA1,$SESSION1,$CLASS1,4,1,TRUE,TRUE,Set Ticks Away from NBBO to 1

SETALLOWEDHALARRAY,$SA1,$SESSION1,$CLASS1,1:2:3,TRUE,TRUE,Set Allowed HAL Types to NR TW TL,
VERIFYALLOWEDHALARRAY,$SA1,$SESSION1,$CLASS1,1:2:3,TRUE,TRUE,Verify that Allowed HAL Types is NR TW TL,

SETAUCTIONRECEIVERTYPES,$SA1,$SESSION1,$CLASS1,1,1,TRUE,TRUE,Set Auction Receiver Type
VERIFYAUCTIONRECEIVERTYPES,$SA1,$SESSION1,$CLASS1,1,1,TRUE,TRUE,Verify Auction Receiver Type

SETAUCTIONENABLED,$SA1,$SESSION1,$CLASS1,1,TRUE,TRUE,TRUE,Set Auction Enabled
VERIFYAUCTIONENABLED,$SA1,$SESSION1,$CLASS1,1,TRUE,TRUE,TRUE,Verify Auction Enabled

SETAUCTIONMINQUOTERS,$SA1,$SESSION1,$CLASS1,1,1,TRUE,TRUE,Set Auction Min Quoters
VERIFYAUCTIONMINQUOTERS,$SA1,$SESSION1,$CLASS1,1,1,TRUE,TRUE,Verify Auction Min Quoters

SETQUOTELOCKNOTIFICATIONTIMER,$SA1,$SESSION1,$CLASS1,1000,TRUE,TRUE,Set Quote Lock Notification Timer
VERIFYQUOTELOCKNOTIFICATIONTIMER,$SA1,$SESSION1,$CLASS1,1000,TRUE,TRUE,Verify Quote Lock Notification Timer

SETQUOTELOCKTIMER,$SA1,$SESSION1,$CLASS1,30000,TRUE,TRUE,Set Quote Lock Timer
VERIFYQUOTELOCKTIMER,$SA1,$SESSION1,$CLASS1,30000,TRUE,TRUE,Verify Quote Lock Timer for leg class

SETQUOTETRIGGERTIMER,$SA1,$SESSION1,$CLASS1,60000,TRUE,TRUE,Set Quote Trigger Timer
VERIFYQUOTETRIGGERTIMER,$SA1,$SESSION1,$CLASS1,60000,TRUE,TRUE,Verify Quote Trigger Timer

SETCONTINGENCYTIMETOLIVE,$SA1,$SESSION1,$CLASS1,60,TRUE,TRUE,Set Contingency Time To Live Timer
VERIFYCONTINGENCYTIMETOLIVE,$SA1,$SESSION1,$CLASS1,60,TRUE,TRUE,Verify Contingency Time To Live  Timer

SETBOTRENABLED,$SA1,$SESSION1,$CLASS1,1,TRUE,TRUE,Set BOTR Enabled
VERIFYBOTRENABLED,$SA1,$SESSION1,$CLASS1,1,TRUE,TRUE,Verify BOTR Enabled

SETBOTRRANGESCALES,$SA1,$SESSION1,$CLASS1,2,1,00,10,1,20,10,TRUE,TRUE,Set BOTR Range
VERIFYBOTRRANGESCALES,$SA1,$SESSION1,$CLASS1,2,1,00,10,1,20,10,TRUE,TRUE,Verify BOTR Range set to 1.00-1.20x10
UPDATEBOTR,$SA1,$SESSION,$CLASS1,$CLASS1PRODUCT1,B,2,1,00,100,$EXCHANGE,100,TRUE,TRUE,Update BOTR to Buy 1.00 x 10 NYSE=100
UPDATEBOTR,$SA1,$SESSION,$CLASS1,$CLASS1PRODUCT1,S,2,1,20,100,$EXCHANGE,100,TRUE,TRUE,Update BOTR to Sell 1.00 x 10 NYSE=100


COMMENT,Step 5: Verify test product book is clear
TOPOFBOOKVERIFICATION,$MM1,$SESSION1,$CLASS1PRODUCT1,0,1,0,0,0,1,0,0,TRUE,TRUE,Verify Leg Market is clear,
TOPOFBOOKVERIFICATION,$MM1,$SESSION1,$CLASS1PRODUCT2,0,1,0,0,0,1,0,0,TRUE,TRUE,Verify Leg Market is clear,


COMMENT,Step 6: Set up Subscriptions for the option class
SUBSCRIBECURRENTMARKET,$MM1,$SESSION1,$CLASS1,$CLASS1PRODUCT1,TRUE,TRUE,Subscribe for $CLASS1 CurrentMarket,
SUBSCRIBERECAP,$MM1,$SESSION1,$CLASS1PRODUCT1,TRUE,TRUE,Subscribe for $CLASS1PRODUCT1 Recap,
SUBSCRIBETICKER,$MM1,$SESSION1,$CLASS1PRODUCT1,TRUE,TRUE,Subscribe for $CLASS1PRODUCT1 Ticker,
SUBSCRIBECURRENTMARKETV3,$MM1,$SESSION1,$CLASS1,$CLASS1PRODUCT1,0,TRUE,TRUE,Subscribe for CurrentMarket,
SUBSCRIBECURRENTMARKET,$BD1,$SESSION1,$CLASS1,$CLASS1PRODUCT1,TRUE,TRUE,Subscribe for $CLASS1 CurrentMarket,
SUBSCRIBERECAP,$BD1,$SESSION1,$CLASS1PRODUCT1,TRUE,TRUE,Subscribe for $CLASS1PRODUCT1 Recap,
SUBSCRIBETICKER,$BD1,$SESSION1,$CLASS1PRODUCT1,TRUE,TRUE,Subscribe for $CLASS1PRODUCT1 Ticker,
SUBSCRIBECURRENTMARKETV3,$BD1,$SESSION1,$CLASS1,$CLASS1PRODUCT1,0,TRUE,TRUE,Subscribe for CurrentMarket,


SUBSCRIBEAUCTION,$MM1,$SESSION1,$CLASS1,1,TRUE,TRUE,Subscribe Auction for simple orders,


COMMENT,Step 7: Set up MM quotes in the book to open the HAL product,
CLEARALLCALLBACKS,$MM1,
CLEARALLCALLBACKS,$BD1,
CLEARALLCALLBACKS,$SA1,
QUOTE,$MM1,2,1,00,10,2,1,30,10,$CLASS1PRODUCT1,$SESSION1,User Assigned Id,TRUE,TRUE,Quote to receive a RPF
QUOTEQUERY,$MM1,2,1,00,10,2,1,30,10,$CLASS1PRODUCT1,$SESSION1,User Assigned Id,7,TRUE,TRUE,Verifying that the MM1s current quote is as expected,
CURRENTMARKETQUERY,$MM1,$SESSION1,$CLASS1PRODUCT1,2,1,00,2,1,30,10,10,TRUE,TRUE,Verify Current Market,
TOPOFBOOKVERIFICATION,$MM1,$SESSION1,$CLASS1PRODUCT1,10,2,1,00,10,2,1,30,TRUE,TRUE,Verify Book is not Empty,
ORDER,$MM1,$MM5EXCHANGE,$MM1EXECFIRM,EJE,101,ABC,*,$MM1EXCHANGE,$MM1,50,$CLASS1PRODUCT1,B,2,1,40,D,2/2/2006  9:50:00.0,1,1,0,0,0,-,-,-,$MM1,$MM1,C,FALSE,C,C,1,REMAINDER=4;,-,$SESSION1,TRUE,TRUE,Enter Order ($MM1),
RFPQUERY,$MM1,$SESSION1,$CLASS1PRODUCT1,$AUCTION1,B,50,2,1,20,FALSE,TRUE,Find RFP,
UPDATEBOTR,$SA1,$SESSION,$CLASS1,$CLASS1PRODUCT1,B,2,1,00,100,$EXCHANGE,100,TRUE,TRUE,Update BOTR to Buy 1.00 x 10 NYSE=100
UPDATEBOTR,$SA1,$SESSION,$CLASS1,$CLASS1PRODUCT1,S,2,1,15,100,$EXCHANGE,100,TRUE,TRUE,Update BOTR to Sell 1.15 x 10 NYSE=100
QUOTE,$MM1,2,1,00,10,2,1,15,10,$CLASS1PRODUCT1,$SESSION1,User Assigned Id,TRUE,TRUE,Quote worsens when BOTR moves,
PAUSE,400,
MYCOMMENT, Check Quote Trigger @ 1.15
AQUOTESTATUSVERIFICATION,$MM1,$CLASS1PRODUCT1,$SESSION1,2,1,00,2,1,15,10,10,12,TRUE,TRUE,Verify Quote Trigger (Buy) Notification @ 1.15,
LASTSALEQUERY,$MM1,$SESSION1,$CLASS1PRODUCT1,2,1,15,10,TRUE,TRUE,Verify Last Sale dissemination,
CURRENTMARKETQUERY,$MM2,$SESSION1,$CLASS1PRODUCT1,2,1,00,2,1,30,100,100,TRUE,TRUE,Verify Current Market,
PAUSE,400,
ORDERFILLVERIFICATION,$MM2,$MM2EXCHANGE,$MM2EXECFIRM,AAA,1111,ABC,*,0,0,3,10,1,2,1,20,TRUE,TRUE,Verify Customer Order C1 Fill ,
QUOTEFILLVERIFICATION,$MM1,$CLASS1PRODUCT1,$SESSION1,0,10,1,2,1,20,User Assigned Id,TRUE,TRUE,Verify MM1 Quote Fill,
MYCOMMENT,Cancel all remaining quotes,
QUOTECANCEL,$MM1,$SESSION1,$CLASS1PRODUCT1,2,TRUE,TRUE,Cancel MM1's quote,
QUOTECANCEL,$MM2,$SESSION1,$CLASS1PRODUCT1,2,TRUE,TRUE,Cancel MM2's quote,
MYCOMMENT,HAL Test Suite Example #6 (from HAL-2 Document) is Over with HAL Flashing on NBBO Reject HALable NON-contingent C-order,


COMMENT,Step 8: Checkout complete - Log off users,
TRADERLOGOUT,$MM1,TRUE,TRUE,Logging out $MM1,
TRADERLOGOUT,$MM2,TRUE,TRUE,Logging out $MM2,
MYCOMMENT,TRADERLOGOUT,$MM3,TRUE,TRUE,Logging out $MM3,
MYCOMMENT,TRADERLOGOUT,$MM4,TRUE,TRUE,Logging out $MM4,
MYCOMMENT,TRADERLOGOUT,$BD2,TRUE,TRUE,Logging out $BD2,
MYCOMMENT,TRADERLOGOUT,$BD3,TRUE,TRUE,Logging out $BD3,
MYCOMMENT,TRADERLOGOUT,$BD4,TRUE,TRUE,Logging out $BD4,
TRADERLOGOUT,$BD1,TRUE,TRUE,Logging out $BD1,
SALOGOUT,$SA1,TRUE,TRUE,Logging out $SA1,
ENDPOINT,
PRINTOUTPUTSUMMARY,Test Wrapup,

