<HTML><HEAD><META CONTENT="text/html; charset=ISO-8859-1" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://emma.sourceforge.net/">EMMA</A> Coverage Report (generated Thu Mar 03 11:11:30 CST 2011)</TH></TR><TR><TD CLASS="nv">[<A HREF="../coverage.html">all classes</A>][<A HREF="1.html">com.cboe.ohs.deprecated.oms</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">TPFOrderMaintenanceServiceDelegateImpl.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>TPFOrderMaintenanceServiceDelegateImpl.java</TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/70)</TD><TD CLASS="h">0%   (0/2670)</TD><TD CLASS="h">0%   (0/585)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">TPFOrderMaintenanceServiceDelegateImpl</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/70)</TD><TD CLASS="h">0%   (0/2670)</TD><TD CLASS="h">0%   (0/585)</TD></TR><TR><TD CLASS="f"><A HREF="#0">&lt;static initializer&gt;</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">TPFOrderMaintenanceServiceDelegateImpl (OrderHome, ProductDataCache, OrderVal...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/82)</TD><TD CLASS="h">0%   (0/23)</TD></TR><TR><TD CLASS="f"><A HREF="#3">acceptCancel (String, CancelRequestStruct, ProductKeysStruct): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/15)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">acceptCancelReplace (CancelRequestStruct, OrderStruct): OrderIdStruct</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/17)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#5">acceptCancelReport (ProductKeysStruct, InternalCancelReportStruct [], boolean...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">acceptFillReport (ProductKeysStruct, OrderIdStruct, PriceStruct, FilledReport...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#7">acceptNothingDone (ProductKeysStruct, OrderIdStruct, boolean): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#8">acceptOrderWithInstructions (OrderStruct, OrderHandlingInstructionStruct, Pri...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/16)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#9">acceptStrategyCancelReplace (CancelRequestStruct, OrderStruct, LegOrderEntryS...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#a">acceptStrategyLegOrderCancelReport (RoutingParameterStruct, OrderIdStruct, Ca...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#b">acceptStrategyLegOrderFillReport (RoutingParameterStruct, OrderIdStruct, Fill...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#c">acceptStrategyOrder (OrderStruct, LegOrderEntryStruct []): OrderIdStruct</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#d">acceptStrategyOrderWithInstruction (OrderStruct, LegOrderEntryStruct [], Orde...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/39)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#e">allAdjustmentsAppliedNotice (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#f">applyOrderCancel (int, OrderIdStruct, int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#10">applyOrderUpdate (int, OrderIdStruct, PriceStruct, int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#11">applyOrderUpdateWithContingency (int, OrderIdStruct, PriceStruct, PriceStruct...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">assertNotNull (Object, String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/15)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#13">buildLegDetailBasedOnNewValue (Order, LegOrderEntryStructV2): LegOrderDetailS...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/69)</TD><TD CLASS="h">0%   (0/17)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">calculateCancelQuantity (Order, int, int): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/19)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="f"><A HREF="#15">convertLegOrderEntryStructsToV2 (LegOrderEntryStruct []): LegOrderEntryStruct...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/27)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">createCancelRequestStructWithTypeCheck (Order, int, int, CancelRequestStruct)...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/84)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR><TD CLASS="f"><A HREF="#17">createLegEntryDetailsFromFoundOrder (Order): LegOrderEntryStructV2 []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/91)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#18">createNewOrder (OrderStruct, LegOrderEntryStructV2 [], OrderHandlingInstructi...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/157)</TD><TD CLASS="h">0%   (0/30)</TD></TR><TR><TD CLASS="f"><A HREF="#19">createNewOrder (OrderStruct, LegOrderEntryStructV2 [], boolean): Order</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1a">deleteOrderFromBook (String, CancelRequestStruct, ProductKeysStruct): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#1b">executeCancelReplace (OrderRoutingParameterStruct, CancelRequestStruct, Order...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/54)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1c">executeCxlReplaceOrderWorkflow (CancelReplaceContext): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/46)</TD><TD CLASS="h">0%   (0/14)</TD></TR><TR><TD CLASS="f"><A HREF="#1d">executeCxlReplaceRerouteWorkflow (CancelReplaceContext): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/58)</TD><TD CLASS="h">0%   (0/18)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1e">executeCxlRerouteWorkflow (Order, String, CancelRequestStruct, ProductKeysStr...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/29)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#1f">executeNewOrderWorkflow (OrderContext): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/46)</TD><TD CLASS="h">0%   (0/14)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#20">executeOrderRerouteWorkflow (OrderContext): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/58)</TD><TD CLASS="h">0%   (0/18)</TD></TR><TR><TD CLASS="f"><A HREF="#21">executeOrderWithInstructions (OrderStruct, LegOrderEntryStructV2 [], Order, O...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/151)</TD><TD CLASS="h">0%   (0/29)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#22">findOrderAndCheckSource (OrderStruct): Order</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/62)</TD><TD CLASS="h">0%   (0/17)</TD></TR><TR><TD CLASS="f"><A HREF="#23">findOrderByOrderId (OrderIdStruct): Order</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/48)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#24">getCxlReOrderExecutor (CancelReplaceContext): IWorkflowExecutor</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/23)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#25">getCxlReRerouteExecutor (CancelReplaceContext): IWorkflowExecutor</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/23)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#26">getCxlRerouteExecutor (Order, String, CancelRequestStruct, ProductKeysStruct)...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/36)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="f"><A HREF="#27">getExtensions (String, String): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/32)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#28">getNewOrderExecutor (OrderContext): IWorkflowExecutor</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/23)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#29">getOrderRerouteExecutor (OrderContext): IWorkflowExecutor</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/23)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2a">getOrderValidationStrategy (String): OrderValidationStrategy</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="f"><A HREF="#2b">getReplacementOrder (OrderStruct): Order</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2c">initWorkflows (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/81)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR><TD CLASS="f"><A HREF="#2d">isEmpty (String): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/17)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2e">isPdpmExtension (String): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#2f">log (): Logger</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#30">maybeThrow (BaseContext): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/36)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR><TD CLASS="f"><A HREF="#31">mergeExtension (Map, String, boolean): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/68)</TD><TD CLASS="h">0%   (0/13)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#32">mergedExtensions (String, String): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/70)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR><TD CLASS="f"><A HREF="#33">msg (): MsgBuilder</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#34">orderAccepted (ProductKeysStruct, OrderIdStruct, boolean): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#35">overridePriceBasedOnContingency (OrderStruct): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/52)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#36">priceAdjustmentAppliedNotice (PendingAdjustmentStruct): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#37">processCancel (OrderRoutingParameterStruct, String, CancelRequestStruct, Prod...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/141)</TD><TD CLASS="h">0%   (0/24)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#38">processCancelReplace (OrderRoutingParameterStruct, CancelRequestStruct, Order...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/181)</TD><TD CLASS="h">0%   (0/29)</TD></TR><TR><TD CLASS="f"><A HREF="#39">processOrderWithInstruction (OrderStruct, LegOrderEntryStructV2 [], OrderHand...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/71)</TD><TD CLASS="h">0%   (0/15)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3a">processOrderWithInstructions (OrderStruct, OrderHandlingInstructionStruct, Pr...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#3b">processReinstateOrder (int, CboeIdStruct, CboeIdStruct, int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3c">setPreviousLocationAndLocationType (Order, OrderRoutingParameterStruct): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/11)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#3d">updateOrderWithHandlingInstruction (OrderStruct, Order, OrderHandlingInstruct...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/51)</TD><TD CLASS="h">0%   (0/13)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3e">userHasOrders (String): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#3f">validateCancelReplace (CancelRequestStruct, OrderStruct, LegOrderEntryStructV...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/83)</TD><TD CLASS="h">0%   (0/14)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#40">validateExistingStrategyOrderLegFirm (Order): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/61)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="f"><A HREF="#41">validateOrder (OrderStruct, OrderHandlingInstructionStruct): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/32)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#42">validateOrderId (OrderIdStruct): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/31)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#43">validateProductState (String, int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/40)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#44">validateProductState (int, OrderStruct): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/57)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="f"><A HREF="#45">validateStrategyOrder (OrderStruct, LegOrderEntryStructV2 [], OrderHandlingIn...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/47)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#46">waitForCompletion (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="l">1</TD><TD>package com.cboe.ohs.deprecated.oms;</TD></TR><TR><TD CLASS="l">2</TD><TD> </TD></TR><TR><TD CLASS="l">3</TD><TD>import java.util.HashMap;</TD></TR><TR><TD CLASS="l">4</TD><TD>import java.util.Iterator;</TD></TR><TR><TD CLASS="l">5</TD><TD>import java.util.Map;</TD></TR><TR><TD CLASS="l">6</TD><TD> </TD></TR><TR><TD CLASS="l">7</TD><TD>import com.cboe.domain.order.OrderHandlingInstructionImpl;</TD></TR><TR><TD CLASS="l">8</TD><TD>import com.cboe.domain.util.ExtensionsHelper;</TD></TR><TR><TD CLASS="l">9</TD><TD>import com.cboe.domain.util.PriceFactory;</TD></TR><TR><TD CLASS="l">10</TD><TD>import com.cboe.exceptions.AuthorizationException;</TD></TR><TR><TD CLASS="l">11</TD><TD>import com.cboe.exceptions.CommunicationException;</TD></TR><TR><TD CLASS="l">12</TD><TD>import com.cboe.exceptions.DataValidationException;</TD></TR><TR><TD CLASS="l">13</TD><TD>import com.cboe.exceptions.DuplicateOrderIDException;</TD></TR><TR><TD CLASS="l">14</TD><TD>import com.cboe.exceptions.NotAcceptedException;</TD></TR><TR><TD CLASS="l">15</TD><TD>import com.cboe.exceptions.NotFoundException;</TD></TR><TR><TD CLASS="l">16</TD><TD>import com.cboe.exceptions.SystemException;</TD></TR><TR><TD CLASS="l">17</TD><TD>import com.cboe.exceptions.TransactionFailedException;</TD></TR><TR><TD CLASS="l">18</TD><TD>import com.cboe.idl.cmiConstants.ContingencyTypes;</TD></TR><TR><TD CLASS="l">19</TD><TD>import com.cboe.idl.cmiConstants.OrderCancelTypes;</TD></TR><TR><TD CLASS="l">20</TD><TD>import com.cboe.idl.cmiConstants.PriceTypes;</TD></TR><TR><TD CLASS="l">21</TD><TD>import com.cboe.idl.cmiConstants.ProductStates;</TD></TR><TR><TD CLASS="l">22</TD><TD>import com.cboe.idl.cmiConstants.ProductTypes;</TD></TR><TR><TD CLASS="l">23</TD><TD>import com.cboe.idl.cmiConstants.Sources;</TD></TR><TR><TD CLASS="l">24</TD><TD>import com.cboe.idl.cmiErrorCodes.DataValidationCodes;</TD></TR><TR><TD CLASS="l">25</TD><TD>import com.cboe.idl.cmiErrorCodes.NotAcceptedCodes;</TD></TR><TR><TD CLASS="l">26</TD><TD>import com.cboe.idl.cmiErrorCodes.TransactionFailedCodes;</TD></TR><TR><TD CLASS="l">27</TD><TD>import com.cboe.idl.cmiOrder.CancelReportStruct;</TD></TR><TR><TD CLASS="l">28</TD><TD>import com.cboe.idl.cmiOrder.CancelRequestStruct;</TD></TR><TR><TD CLASS="l">29</TD><TD>import com.cboe.idl.cmiOrder.FilledReportStruct;</TD></TR><TR><TD CLASS="l">30</TD><TD>import com.cboe.idl.cmiOrder.LegOrderDetailStruct;</TD></TR><TR><TD CLASS="l">31</TD><TD>import com.cboe.idl.cmiOrder.LegOrderEntryStruct;</TD></TR><TR><TD CLASS="l">32</TD><TD>import com.cboe.idl.cmiOrder.LegOrderEntryStructV2;</TD></TR><TR><TD CLASS="l">33</TD><TD>import com.cboe.idl.cmiOrder.OrderIdStruct;</TD></TR><TR><TD CLASS="l">34</TD><TD>import com.cboe.idl.cmiOrder.OrderStruct;</TD></TR><TR><TD CLASS="l">35</TD><TD>import com.cboe.idl.cmiProduct.PendingAdjustmentStruct;</TD></TR><TR><TD CLASS="l">36</TD><TD>import com.cboe.idl.cmiProduct.ProductKeysStruct;</TD></TR><TR><TD CLASS="l">37</TD><TD>import com.cboe.idl.cmiUtil.CboeIdStruct;</TD></TR><TR><TD CLASS="l">38</TD><TD>import com.cboe.idl.cmiUtil.PriceStruct;</TD></TR><TR><TD CLASS="l">39</TD><TD>import com.cboe.idl.constants.OrderLocations;</TD></TR><TR><TD CLASS="l">40</TD><TD>import com.cboe.idl.order.InternalCancelReportStruct;</TD></TR><TR><TD CLASS="l">41</TD><TD>import com.cboe.idl.order.OrderHandlingInstructionStruct;</TD></TR><TR><TD CLASS="l">42</TD><TD>import com.cboe.idl.order.OrderRoutingParameterStruct;</TD></TR><TR><TD CLASS="l">43</TD><TD>import com.cboe.idl.util.RoutingParameterStruct;</TD></TR><TR><TD CLASS="l">44</TD><TD>import com.cboe.infrastructureServices.foundationFramework.exceptionHandling.FatalFoundationFrameworkException;</TD></TR><TR><TD CLASS="l">45</TD><TD>import com.cboe.infrastructureServices.foundationFramework.utilities.Transaction;</TD></TR><TR><TD CLASS="l">46</TD><TD>import com.cboe.interfaces.domain.HandlingInstruction;</TD></TR><TR><TD CLASS="l">47</TD><TD>import com.cboe.interfaces.domain.Price;</TD></TR><TR><TD CLASS="l">48</TD><TD>import com.cboe.interfaces.domain.routingProperty.common.OrderLocation;</TD></TR><TR><TD CLASS="l">49</TD><TD>import com.cboe.interfaces.internalBusinessServices.OrderMaintenanceServiceLocal;</TD></TR><TR><TD CLASS="l">50</TD><TD>import com.cboe.interfaces.internalBusinessServices.OrderMaintenanceServiceV2;</TD></TR><TR><TD CLASS="l">51</TD><TD>import com.cboe.interfaces.internalBusinessServices.TradableValidationContext;</TD></TR><TR><TD CLASS="l">52</TD><TD>import com.cboe.interfaces.internalBusinessServices.TradableValidationService;</TD></TR><TR><TD CLASS="l">53</TD><TD>import com.cboe.interfaces.productData.ProductData;</TD></TR><TR><TD CLASS="l">54</TD><TD>import com.cboe.interfaces.productData.ProductDataCache;</TD></TR><TR><TD CLASS="l">55</TD><TD>import com.cboe.ohs.domain.interfaces.LegOrderDetail;</TD></TR><TR><TD CLASS="l">56</TD><TD>import com.cboe.ohs.domain.interfaces.Order;</TD></TR><TR><TD CLASS="l">57</TD><TD>import com.cboe.ohs.domain.interfaces.OrderHome;</TD></TR><TR><TD CLASS="l">58</TD><TD>import com.cboe.ohs.interfaces.integration.OrderValidationStrategy;</TD></TR><TR><TD CLASS="l">59</TD><TD>import com.cboe.ohs.interfaces.integration.OrderValidationStrategyHome;</TD></TR><TR><TD CLASS="l">60</TD><TD>import com.cboe.ohs.interfaces.workflow.CancelContext;</TD></TR><TR><TD CLASS="l">61</TD><TD>import com.cboe.ohs.interfaces.workflow.CancelReplaceContext;</TD></TR><TR><TD CLASS="l">62</TD><TD>import com.cboe.ohs.interfaces.workflow.OrderContext;</TD></TR><TR><TD CLASS="l">63</TD><TD>import com.cboe.ohs.interfaces.workflow.WorkflowConstant;</TD></TR><TR><TD CLASS="l">64</TD><TD>import com.cboe.ohs.util.OMSV2NetworkInstrumentorHelper;</TD></TR><TR><TD CLASS="l">65</TD><TD>import com.cboe.server.logger.Logger;</TD></TR><TR><TD CLASS="l">66</TD><TD>import com.cboe.server.logger.MsgBuilder;</TD></TR><TR><TD CLASS="l">67</TD><TD>import com.cboe.server.util.PerformanceMetricsHandler;</TD></TR><TR><TD CLASS="l">68</TD><TD>import com.cboe.server.util.PerformanceMetricsHandlerFactory;</TD></TR><TR><TD CLASS="l">69</TD><TD>import com.cboe.server.util.PerformanceMetricsHandlerTypes;</TD></TR><TR><TD CLASS="l">70</TD><TD>import com.cboe.server.util.PerformanceMetricsTradeServerOrderHandler;</TD></TR><TR><TD CLASS="l">71</TD><TD>import com.cboe.server.workflow.BaseContext;</TD></TR><TR><TD CLASS="l">72</TD><TD>import com.cboe.server.workflow.IWorkflowEngine;</TD></TR><TR><TD CLASS="l">73</TD><TD>import com.cboe.server.workflow.IWorkflowExecutor;</TD></TR><TR><TD CLASS="l">74</TD><TD>import com.cboe.server.workflow.WorkflowHome;</TD></TR><TR><TD CLASS="l">75</TD><TD>import com.cboe.util.ExceptionBuilder;</TD></TR><TR><TD CLASS="l">76</TD><TD>import com.cboe.util.ReflectiveObjectWriter;</TD></TR><TR><TD CLASS="l">77</TD><TD> </TD></TR><TR><TD CLASS="l">78</TD><TD>/**</TD></TR><TR><TD CLASS="l">79</TD><TD> * This class is an implementation of interface OrderMaintenanceServiceV2</TD></TR><TR><TD CLASS="l">80</TD><TD> * </TD></TR><TR><TD CLASS="l">81</TD><TD> */</TD></TR><TR><TD CLASS="l">82</TD><TD> </TD></TR><TR><TD CLASS="l">83</TD><TD>public class TPFOrderMaintenanceServiceDelegateImpl implements  OrderMaintenanceServiceV2</TD></TR><TR><TD CLASS="l">84</TD><TD>{</TD></TR><TR><TD CLASS="l">85</TD><TD>    private OrderMaintenanceServiceLocal omsService;</TD></TR><TR><TD CLASS="l">86</TD><TD>    </TD></TR><TR><TD CLASS="l">87</TD><TD>    private OrderHome orderHome;</TD></TR><TR><TD CLASS="l">88</TD><TD>    private ProductDataCache productDataCache;</TD></TR><TR><TD CLASS="l">89</TD><TD>    private OrderValidationStrategyHome orderValidationStrategyHome;</TD></TR><TR><TD CLASS="l">90</TD><TD>    private PerformanceMetricsHandler theMetricsHandler;</TD></TR><TR><TD CLASS="l"><A NAME="0">91</A></TD><TD>    private Logger logger;</TD></TR><TR><TD CLASS="l">92</TD><TD>    </TD></TR><TR><TD CLASS="l">93</TD><TD>    private OMSV2NetworkInstrumentorHelper omsV2NetworkInstrumentorHelper;</TD></TR><TR><TD CLASS="l">94</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">95</TD><TD>    private static String HYBRID_INTERNAL = &#34;HybridInternal&#34;;</TD></TR><TR CLASS="z"><TD CLASS="l">96</TD><TD>    public final static OrderRoutingParameterStruct TPF_UNKNOWN_ROUTING_PARAM = new OrderRoutingParameterStruct(</TD></TR><TR><TD CLASS="l">97</TD><TD>            OrderLocations.TPF, OrderLocation.TPF.description, OrderLocations.UNSPECIFIED, &#34;&#34;);</TD></TR><TR><TD CLASS="l">98</TD><TD>    private static final String PDPM_EXT = &#34;PDPM=&#34;;</TD></TR><TR><TD CLASS="l">99</TD><TD>  </TD></TR><TR><TD CLASS="l">100</TD><TD>    private WorkflowHome wfHome;</TD></TR><TR><TD CLASS="l">101</TD><TD> </TD></TR><TR><TD CLASS="l">102</TD><TD>    private TradableValidationService tradableValidationService;</TD></TR><TR><TD CLASS="l">103</TD><TD>    </TD></TR><TR><TD CLASS="l">104</TD><TD>    private IWorkflowEngine&lt;OrderContext&gt; newOrderWorkflow;</TD></TR><TR><TD CLASS="l">105</TD><TD>    private IWorkflowEngine&lt;OrderContext&gt; orderRerouteWorkflow;</TD></TR><TR><TD CLASS="l">106</TD><TD>    private IWorkflowEngine&lt;CancelContext&gt; cxlRerouteWorkflow;</TD></TR><TR><TD CLASS="l">107</TD><TD>    private IWorkflowEngine&lt;CancelReplaceContext&gt; cxlReOrderWorkflow;</TD></TR><TR><TD CLASS="l">108</TD><TD>    private IWorkflowEngine&lt;CancelReplaceContext&gt; cxlReplaceRerouteWorkflow;</TD></TR><TR><TD CLASS="l">109</TD><TD> </TD></TR><TR><TD CLASS="l">110</TD><TD>    private final ThreadLocal&lt;IWorkflowExecutor&lt;OrderContext&gt;&gt; tlNewOrderExecutor;</TD></TR><TR><TD CLASS="l">111</TD><TD>    private final ThreadLocal&lt;IWorkflowExecutor&lt;OrderContext&gt;&gt; tlOrderRerouteExecutor;</TD></TR><TR><TD CLASS="l">112</TD><TD>    private final ThreadLocal&lt;IWorkflowExecutor&lt;CancelContext&gt;&gt; tlCxlRerouteExecutor;</TD></TR><TR><TD CLASS="l">113</TD><TD>    private final ThreadLocal&lt;IWorkflowExecutor&lt;CancelReplaceContext&gt;&gt; tlCxlReOrderExecutor;</TD></TR><TR><TD CLASS="l">114</TD><TD>    private final ThreadLocal&lt;IWorkflowExecutor&lt;CancelReplaceContext&gt;&gt; tlCxlReplaceRerouteWorkflow;</TD></TR><TR><TD CLASS="l">115</TD><TD> </TD></TR><TR><TD CLASS="l">116</TD><TD>    TPFOrderMaintenanceServiceDelegateImpl(OrderHome orderHome, ProductDataCache productDataCache, </TD></TR><TR><TD CLASS="l"><A NAME="2">117</A></TD><TD>                                           OrderValidationStrategyHome orderValidationStrategyHome, </TD></TR><TR><TD CLASS="l">118</TD><TD>                                           OrderMaintenanceServiceLocal omsService, WorkflowHome wfHome,</TD></TR><TR><TD CLASS="l">119</TD><TD>                                           Logger logger, OMSV2NetworkInstrumentorHelper omsV2NetworkInstrumentorHelper,</TD></TR><TR><TD CLASS="l">120</TD><TD>                                           TradableValidationService tradableValidationService)</TD></TR><TR CLASS="z"><TD CLASS="l">121</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">122</TD><TD>        this.orderHome = orderHome;</TD></TR><TR CLASS="z"><TD CLASS="l">123</TD><TD>        this.productDataCache = productDataCache;</TD></TR><TR CLASS="z"><TD CLASS="l">124</TD><TD>        this.orderValidationStrategyHome = orderValidationStrategyHome;</TD></TR><TR CLASS="z"><TD CLASS="l">125</TD><TD>        this.omsService = omsService;</TD></TR><TR CLASS="z"><TD CLASS="l">126</TD><TD>        this.wfHome = wfHome;</TD></TR><TR CLASS="z"><TD CLASS="l">127</TD><TD>        this.logger = logger;</TD></TR><TR CLASS="z"><TD CLASS="l">128</TD><TD>        this.omsV2NetworkInstrumentorHelper = omsV2NetworkInstrumentorHelper;</TD></TR><TR CLASS="z"><TD CLASS="l">129</TD><TD>        this.tradableValidationService = tradableValidationService;</TD></TR><TR><TD CLASS="l">130</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">131</TD><TD>        this.tlNewOrderExecutor = new ThreadLocal&lt;IWorkflowExecutor&lt;OrderContext&gt;&gt;();</TD></TR><TR CLASS="z"><TD CLASS="l">132</TD><TD>        this.tlOrderRerouteExecutor = new ThreadLocal&lt;IWorkflowExecutor&lt;OrderContext&gt;&gt;();</TD></TR><TR CLASS="z"><TD CLASS="l">133</TD><TD>        this.tlCxlRerouteExecutor = new ThreadLocal&lt;IWorkflowExecutor&lt;CancelContext&gt;&gt;();</TD></TR><TR CLASS="z"><TD CLASS="l">134</TD><TD>        this.tlCxlReOrderExecutor = new ThreadLocal&lt;IWorkflowExecutor&lt;CancelReplaceContext&gt;&gt;();</TD></TR><TR CLASS="z"><TD CLASS="l">135</TD><TD>        this.tlCxlReplaceRerouteWorkflow = new ThreadLocal&lt;IWorkflowExecutor&lt;CancelReplaceContext&gt;&gt;();</TD></TR><TR CLASS="z"><TD CLASS="l">136</TD><TD>        this.theMetricsHandler = PerformanceMetricsHandlerFactory</TD></TR><TR><TD CLASS="l">137</TD><TD>                .getPerformanceMetricsHandler(PerformanceMetricsHandlerTypes.TRADE_SERVER_ORDER);</TD></TR><TR><TD CLASS="l">138</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">139</TD><TD>        initWorkflows();</TD></TR><TR><TD CLASS="l">140</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">141</TD><TD>        assertNotNull(orderHome, &#34;OrderHome&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">142</TD><TD>        assertNotNull(orderValidationStrategyHome, &#34;OrderValidationStrategyHome&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">143</TD><TD>        assertNotNull(omsService, &#34;OrderMaintenanceServiceLocal&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">144</TD><TD>        assertNotNull(productDataCache, &#34;ProductData&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">145</TD><TD>        assertNotNull(omsV2NetworkInstrumentorHelper, &#34;OMSV2NetworkInstrumentorHelper&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">146</TD><TD>        assertNotNull(logger, &#34;Logger&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">147</TD><TD>    }</TD></TR><TR><TD CLASS="l">148</TD><TD> </TD></TR><TR><TD CLASS="l">149</TD><TD>    </TD></TR><TR><TD CLASS="l"><A NAME="2f">150</A></TD><TD> </TD></TR><TR><TD CLASS="l">151</TD><TD>    </TD></TR><TR><TD CLASS="l">152</TD><TD>    private Logger log()</TD></TR><TR><TD CLASS="l">153</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">154</TD><TD>        return logger;</TD></TR><TR><TD CLASS="l">155</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="2c">156</A></TD><TD>    </TD></TR><TR><TD CLASS="l">157</TD><TD>    </TD></TR><TR><TD CLASS="l">158</TD><TD>    private void initWorkflows()</TD></TR><TR><TD CLASS="l">159</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">160</TD><TD>        this.newOrderWorkflow = wfHome.getWorkflow(WorkflowConstant.ACCEPT_CMI_ORDER</TD></TR><TR><TD CLASS="l">161</TD><TD>                .verifyContextType(OrderContext.class), WorkflowConstant.ACCEPT_CMI_ORDER</TD></TR><TR><TD CLASS="l">162</TD><TD>                .getWorkflowName());</TD></TR><TR><TD CLASS="l">163</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">164</TD><TD>        this.orderRerouteWorkflow = wfHome.getWorkflow(WorkflowConstant.ACCEPT_REROUTE_ORDER</TD></TR><TR><TD CLASS="l">165</TD><TD>                .verifyContextType(OrderContext.class), WorkflowConstant.ACCEPT_REROUTE_ORDER</TD></TR><TR><TD CLASS="l">166</TD><TD>                .getWorkflowName());</TD></TR><TR><TD CLASS="l">167</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">168</TD><TD>        this.cxlRerouteWorkflow = wfHome.getWorkflow(WorkflowConstant.ACCEPT_CANCEL_REROUTE_ORDER</TD></TR><TR><TD CLASS="l">169</TD><TD>                .verifyContextType(CancelContext.class),</TD></TR><TR><TD CLASS="l">170</TD><TD>                WorkflowConstant.ACCEPT_CANCEL_REROUTE_ORDER.getWorkflowName());</TD></TR><TR><TD CLASS="l">171</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">172</TD><TD>        this.cxlReOrderWorkflow = wfHome.getWorkflow(WorkflowConstant.ACCEPT_CMI_CANCEL_REPLACE</TD></TR><TR><TD CLASS="l">173</TD><TD>                .verifyContextType(CancelReplaceContext.class),</TD></TR><TR><TD CLASS="l">174</TD><TD>                WorkflowConstant.ACCEPT_CMI_CANCEL_REPLACE.getWorkflowName());</TD></TR><TR><TD CLASS="l">175</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">176</TD><TD>        this.cxlReplaceRerouteWorkflow = wfHome.getWorkflow(</TD></TR><TR><TD CLASS="l">177</TD><TD>                WorkflowConstant.ACCEPT_CANCEL_REPLACE_REROUTE_ORDER</TD></TR><TR><TD CLASS="l">178</TD><TD>                        .verifyContextType(CancelReplaceContext.class),</TD></TR><TR><TD CLASS="l">179</TD><TD>                WorkflowConstant.ACCEPT_CANCEL_REPLACE_REROUTE_ORDER.getWorkflowName());</TD></TR><TR><TD CLASS="l">180</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">181</TD><TD>        assertNotNull(this.newOrderWorkflow, WorkflowConstant.ACCEPT_CMI_ORDER.name());</TD></TR><TR CLASS="z"><TD CLASS="l">182</TD><TD>        assertNotNull(this.orderRerouteWorkflow, WorkflowConstant.ACCEPT_REROUTE_ORDER.name());</TD></TR><TR CLASS="z"><TD CLASS="l">183</TD><TD>        assertNotNull(this.cxlRerouteWorkflow, WorkflowConstant.ACCEPT_CANCEL_REROUTE_ORDER.name());</TD></TR><TR CLASS="z"><TD CLASS="l">184</TD><TD>        assertNotNull(this.cxlRerouteWorkflow, WorkflowConstant.ACCEPT_CANCEL_REROUTE_ORDER.name());</TD></TR><TR CLASS="z"><TD CLASS="l">185</TD><TD>        assertNotNull(this.cxlReplaceRerouteWorkflow, WorkflowConstant.ACCEPT_CANCEL_REPLACE_REROUTE_ORDER.name());</TD></TR><TR CLASS="z"><TD CLASS="l">186</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="12">187</A></TD><TD> </TD></TR><TR><TD CLASS="l">188</TD><TD>    private void assertNotNull(final Object p_ref, final String p_name)</TD></TR><TR><TD CLASS="l">189</TD><TD>            throws FatalFoundationFrameworkException</TD></TR><TR><TD CLASS="l">190</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">191</TD><TD>        if (p_ref == null)</TD></TR><TR><TD CLASS="l">192</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">193</TD><TD>            throw new FatalFoundationFrameworkException(p_name + &#34; reference is null!&#34;);</TD></TR><TR><TD CLASS="l">194</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">195</TD><TD>    }</TD></TR><TR><TD CLASS="l">196</TD><TD> </TD></TR><TR><TD CLASS="l">197</TD><TD>    public void acceptCancel(String p_userId, CancelRequestStruct p_cancelRequest,</TD></TR><TR><TD CLASS="l"><A NAME="3">198</A></TD><TD>            ProductKeysStruct p_productKeys) throws SystemException, CommunicationException,</TD></TR><TR><TD CLASS="l">199</TD><TD>            DataValidationException, TransactionFailedException, NotAcceptedException,</TD></TR><TR><TD CLASS="l">200</TD><TD>            AuthorizationException</TD></TR><TR><TD CLASS="l">201</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">202</TD><TD>        omsV2NetworkInstrumentorHelper.incrementAcceptCancelReceived(1);</TD></TR><TR><TD CLASS="l">203</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">204</TD><TD>        this.processCancel(TPF_UNKNOWN_ROUTING_PARAM, p_userId, p_cancelRequest, p_productKeys);</TD></TR><TR><TD CLASS="l">205</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">206</TD><TD>        omsV2NetworkInstrumentorHelper.incrementAcceptCancelSent(1);</TD></TR><TR CLASS="z"><TD CLASS="l">207</TD><TD>    }</TD></TR><TR><TD CLASS="l">208</TD><TD> </TD></TR><TR><TD CLASS="l">209</TD><TD>    public OrderIdStruct acceptCancelReplace(CancelRequestStruct p_cancelRequest,</TD></TR><TR><TD CLASS="l"><A NAME="4">210</A></TD><TD>            OrderStruct p_anOrder) throws SystemException, CommunicationException,</TD></TR><TR><TD CLASS="l">211</TD><TD>            DataValidationException, TransactionFailedException, NotAcceptedException,</TD></TR><TR><TD CLASS="l">212</TD><TD>            AuthorizationException</TD></TR><TR><TD CLASS="l">213</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">214</TD><TD>        omsV2NetworkInstrumentorHelper.incrementAcceptCancelReplaceReceived(1);</TD></TR><TR><TD CLASS="l">215</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">216</TD><TD>        OrderIdStruct orderId = this.processCancelReplace(TPF_UNKNOWN_ROUTING_PARAM,</TD></TR><TR><TD CLASS="l">217</TD><TD>                p_cancelRequest, p_anOrder, null);</TD></TR><TR><TD CLASS="l">218</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">219</TD><TD>        omsV2NetworkInstrumentorHelper.incrementAcceptCancelReplaceSent(1);</TD></TR><TR CLASS="z"><TD CLASS="l">220</TD><TD>        return orderId;</TD></TR><TR><TD CLASS="l">221</TD><TD>    }</TD></TR><TR><TD CLASS="l">222</TD><TD> </TD></TR><TR><TD CLASS="l">223</TD><TD>    public OrderIdStruct acceptOrderWithInstructions(OrderStruct p_anOrder,</TD></TR><TR><TD CLASS="l">224</TD><TD>            OrderHandlingInstructionStruct p_handlingInstruction,</TD></TR><TR><TD CLASS="l"><A NAME="8">225</A></TD><TD>            PriceStruct p_oppositeSideBestOfRest) throws SystemException, CommunicationException,</TD></TR><TR><TD CLASS="l">226</TD><TD>            DataValidationException, TransactionFailedException, NotAcceptedException,</TD></TR><TR><TD CLASS="l">227</TD><TD>            AuthorizationException</TD></TR><TR><TD CLASS="l">228</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">229</TD><TD>        omsV2NetworkInstrumentorHelper.incrementAcceptOrderWithInstructionsReceived(1);</TD></TR><TR><TD CLASS="l">230</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">231</TD><TD>        OrderIdStruct orderId = this.processOrderWithInstructions(p_anOrder, p_handlingInstruction,</TD></TR><TR><TD CLASS="l">232</TD><TD>                p_oppositeSideBestOfRest);</TD></TR><TR><TD CLASS="l">233</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">234</TD><TD>        omsV2NetworkInstrumentorHelper.incrementAcceptOrderWithInstructionsSent(1);</TD></TR><TR CLASS="z"><TD CLASS="l">235</TD><TD>        return orderId;</TD></TR><TR><TD CLASS="l">236</TD><TD>    }</TD></TR><TR><TD CLASS="l">237</TD><TD> </TD></TR><TR><TD CLASS="l">238</TD><TD>    public OrderIdStruct acceptStrategyCancelReplace(CancelRequestStruct p_cancelRequest,</TD></TR><TR><TD CLASS="l"><A NAME="9">239</A></TD><TD>            OrderStruct p_anOrder, LegOrderEntryStruct[] p_legEntryDetails) throws SystemException,</TD></TR><TR><TD CLASS="l">240</TD><TD>            CommunicationException, DataValidationException, TransactionFailedException,</TD></TR><TR><TD CLASS="l">241</TD><TD>            NotAcceptedException, AuthorizationException</TD></TR><TR><TD CLASS="l">242</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">243</TD><TD>        omsV2NetworkInstrumentorHelper.incrementAcceptStrategyCancelReplaceReceived(1);</TD></TR><TR><TD CLASS="l">244</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">245</TD><TD>        LegOrderEntryStructV2[] p_legEntryDetailsV2 = convertLegOrderEntryStructsToV2(p_legEntryDetails);</TD></TR><TR CLASS="z"><TD CLASS="l">246</TD><TD>        OrderIdStruct orderId = this.processCancelReplace(TPF_UNKNOWN_ROUTING_PARAM,</TD></TR><TR><TD CLASS="l">247</TD><TD>                p_cancelRequest, p_anOrder, p_legEntryDetailsV2);</TD></TR><TR><TD CLASS="l">248</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">249</TD><TD>        omsV2NetworkInstrumentorHelper.incrementAcceptStrategyCancelReplaceSent(1);</TD></TR><TR CLASS="z"><TD CLASS="l">250</TD><TD>        return orderId;</TD></TR><TR><TD CLASS="l">251</TD><TD>    }</TD></TR><TR><TD CLASS="l">252</TD><TD> </TD></TR><TR><TD CLASS="l">253</TD><TD>    public OrderIdStruct acceptStrategyOrder(OrderStruct p_anOrder,</TD></TR><TR><TD CLASS="l">254</TD><TD>            LegOrderEntryStruct[] p_legEntryDetails) throws SystemException,</TD></TR><TR><TD CLASS="l"><A NAME="c">255</A></TD><TD>            CommunicationException, DataValidationException, TransactionFailedException,</TD></TR><TR><TD CLASS="l">256</TD><TD>            NotAcceptedException, AuthorizationException</TD></TR><TR><TD CLASS="l">257</TD><TD>    {</TD></TR><TR><TD CLASS="l">258</TD><TD>        // obsolete method, should not be called anymore</TD></TR><TR CLASS="z"><TD CLASS="l">259</TD><TD>        throw ExceptionBuilder.systemException(</TD></TR><TR><TD CLASS="l">260</TD><TD>                &#34;OrderMaintenanceServiceV2.acceptStrategyOrder is not supported anymore&#34;, 0);</TD></TR><TR><TD CLASS="l">261</TD><TD>    }</TD></TR><TR><TD CLASS="l">262</TD><TD> </TD></TR><TR><TD CLASS="l">263</TD><TD>    public OrderIdStruct acceptStrategyOrderWithInstruction(OrderStruct p_anOrder,</TD></TR><TR><TD CLASS="l">264</TD><TD>            LegOrderEntryStruct[] p_legEntryDetails,</TD></TR><TR><TD CLASS="l">265</TD><TD>            OrderHandlingInstructionStruct p_handlingInstruction) throws SystemException,</TD></TR><TR><TD CLASS="l"><A NAME="d">266</A></TD><TD>            CommunicationException, DataValidationException, TransactionFailedException,</TD></TR><TR><TD CLASS="l">267</TD><TD>            NotAcceptedException, AuthorizationException</TD></TR><TR><TD CLASS="l">268</TD><TD>    {</TD></TR><TR><TD CLASS="l">269</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">270</TD><TD>        omsV2NetworkInstrumentorHelper.incrementAcceptStrategyOrderWithInstructionReceived(1);</TD></TR><TR><TD CLASS="l">271</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">272</TD><TD>        if (p_anOrder.sessionNames != null &amp;&amp; p_anOrder.sessionNames.length &gt; 0)</TD></TR><TR><TD CLASS="l">273</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">274</TD><TD>            p_anOrder.activeSession = p_anOrder.sessionNames[0];</TD></TR><TR><TD CLASS="l">275</TD><TD>        }</TD></TR><TR><TD CLASS="l">276</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">277</TD><TD>        LegOrderEntryStructV2[] p_legEntryDetailsV2 = convertLegOrderEntryStructsToV2(p_legEntryDetails);</TD></TR><TR CLASS="z"><TD CLASS="l">278</TD><TD>        OrderIdStruct orderId = processOrderWithInstruction(p_anOrder, p_legEntryDetailsV2,</TD></TR><TR><TD CLASS="l">279</TD><TD>                p_handlingInstruction, new PriceStruct(PriceTypes.NO_PRICE, 0, 0));</TD></TR><TR><TD CLASS="l">280</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">281</TD><TD>        omsV2NetworkInstrumentorHelper.incrementAcceptStrategyOrderWithInstructionSent(1);</TD></TR><TR CLASS="z"><TD CLASS="l">282</TD><TD>        return orderId;</TD></TR><TR><TD CLASS="l">283</TD><TD>    }</TD></TR><TR><TD CLASS="l">284</TD><TD> </TD></TR><TR><TD CLASS="l">285</TD><TD>    </TD></TR><TR><TD CLASS="l">286</TD><TD>    /**</TD></TR><TR><TD CLASS="l">287</TD><TD>     * This method accepts a Cancel Request from TPF</TD></TR><TR><TD CLASS="l">288</TD><TD>     * </TD></TR><TR><TD CLASS="l">289</TD><TD>     * It verifies that the original order exists and has remaining quantity and passes it on to the</TD></TR><TR><TD CLASS="l">290</TD><TD>     * TE [ORD]</TD></TR><TR><TD CLASS="l">291</TD><TD>     * </TD></TR><TR><TD CLASS="l">292</TD><TD>     */</TD></TR><TR><TD CLASS="l">293</TD><TD>    public void processCancel(final OrderRoutingParameterStruct p_orderRouting,</TD></TR><TR><TD CLASS="l">294</TD><TD>            final String p_userId, final CancelRequestStruct p_cancelRequest,</TD></TR><TR><TD CLASS="l">295</TD><TD>            final ProductKeysStruct p_productKeys) throws CommunicationException, SystemException,</TD></TR><TR><TD CLASS="l"><A NAME="37">296</A></TD><TD>            AuthorizationException, DataValidationException, NotAcceptedException,</TD></TR><TR><TD CLASS="l">297</TD><TD>            TransactionFailedException</TD></TR><TR><TD CLASS="l">298</TD><TD>    {</TD></TR><TR><TD CLASS="l">299</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">300</TD><TD>        final long id = this.theMetricsHandler.generateOrderMetricId(p_cancelRequest.orderId,</TD></TR><TR><TD CLASS="l">301</TD><TD>                p_cancelRequest.sessionName);</TD></TR><TR><TD CLASS="l">302</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">303</TD><TD>        this.theMetricsHandler</TD></TR><TR><TD CLASS="l">304</TD><TD>                .sendMethodEvent(</TD></TR><TR><TD CLASS="l">305</TD><TD>                        PerformanceMetricsTradeServerOrderHandler.OMS_CANCEL_ORDER_COLLECTOR_VALIDATION_TYPE,</TD></TR><TR><TD CLASS="l">306</TD><TD>                        id, 0);</TD></TR><TR><TD CLASS="l">307</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">308</TD><TD>        validateOrderId(p_cancelRequest.orderId);</TD></TR><TR CLASS="z"><TD CLASS="l">309</TD><TD>        validateProductState(p_cancelRequest.sessionName, p_productKeys.productKey);</TD></TR><TR><TD CLASS="l">310</TD><TD>   </TD></TR><TR><TD CLASS="l">311</TD><TD>        try</TD></TR><TR><TD CLASS="l">312</TD><TD>        {</TD></TR><TR><TD CLASS="l">313</TD><TD>            Order order;</TD></TR><TR CLASS="z"><TD CLASS="l">314</TD><TD>            order = findOrderByOrderId(p_cancelRequest.orderId);</TD></TR><TR CLASS="z"><TD CLASS="l">315</TD><TD>            setPreviousLocationAndLocationType(order, p_orderRouting);</TD></TR><TR CLASS="z"><TD CLASS="l">316</TD><TD>            if (p_cancelRequest.orderId.highCboeId == 0)</TD></TR><TR><TD CLASS="l">317</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">318</TD><TD>                p_cancelRequest.orderId = order.getOrderId();</TD></TR><TR><TD CLASS="l">319</TD><TD>            }</TD></TR><TR><TD CLASS="l">320</TD><TD> </TD></TR><TR><TD CLASS="l">321</TD><TD>            // order.getLock().lock();</TD></TR><TR><TD CLASS="l">322</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">323</TD><TD>            int quantity = p_cancelRequest.quantity;</TD></TR><TR CLASS="z"><TD CLASS="l">324</TD><TD>            int cancelType = p_cancelRequest.cancelType;</TD></TR><TR CLASS="z"><TD CLASS="l">325</TD><TD>            if (!(cancelType == OrderCancelTypes.CANCEL_ALL_QUANTITY</TD></TR><TR><TD CLASS="l">326</TD><TD>                    || cancelType == OrderCancelTypes.DESIRED_CANCEL_QUANTITY || cancelType == OrderCancelTypes.DESIRED_REMAINING_QUANTITY))</TD></TR><TR><TD CLASS="l">327</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">328</TD><TD>                throw ExceptionBuilder.dataValidationException(&#34;Invalid cancel type in request: &#34;</TD></TR><TR><TD CLASS="l">329</TD><TD>                        + cancelType, DataValidationCodes.INVALID_CANCEL_REQUEST);</TD></TR><TR><TD CLASS="l">330</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">331</TD><TD>            if (quantity &lt; 0</TD></TR><TR><TD CLASS="l">332</TD><TD>                    || (cancelType == OrderCancelTypes.DESIRED_CANCEL_QUANTITY &amp;&amp; quantity == 0))</TD></TR><TR><TD CLASS="l">333</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">334</TD><TD>                throw ExceptionBuilder.notAcceptedException(msg().add(</TD></TR><TR><TD CLASS="l">335</TD><TD>                        &#34;Cannot cancel order. Specified quantity&#34;, quantity).add(&#34;:cancelType &#34;,</TD></TR><TR><TD CLASS="l">336</TD><TD>                        cancelType).add(&#34; is not correct&#34;).end(), NotAcceptedCodes.INVALID_REQUEST);</TD></TR><TR><TD CLASS="l">337</TD><TD>            }</TD></TR><TR><TD CLASS="l">338</TD><TD> </TD></TR><TR><TD CLASS="l">339</TD><TD>            // If Firm Order throw an exception</TD></TR><TR CLASS="z"><TD CLASS="l">340</TD><TD>            if (order.isFirmMatchOrder())</TD></TR><TR><TD CLASS="l">341</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">342</TD><TD>                throw ExceptionBuilder.notAcceptedException(msg().add(</TD></TR><TR><TD CLASS="l">343</TD><TD>                        &#34;Cancel Request for Match Side of Internalized Orders are not allowed.&#34;)</TD></TR><TR><TD CLASS="l">344</TD><TD>                        .add(&#34;orderId&#34;, p_cancelRequest.orderId).end(),</TD></TR><TR><TD CLASS="l">345</TD><TD>                        NotAcceptedCodes.INVALID_REQUEST);</TD></TR><TR><TD CLASS="l">346</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">347</TD><TD>            this.theMetricsHandler</TD></TR><TR><TD CLASS="l">348</TD><TD>                    .sendMethodEvent(</TD></TR><TR><TD CLASS="l">349</TD><TD>                            PerformanceMetricsTradeServerOrderHandler.OMS_CANCEL_ORDER_COLLECTOR_VALIDATION_TYPE,</TD></TR><TR><TD CLASS="l">350</TD><TD>                            id, 1);</TD></TR><TR><TD CLASS="l">351</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">352</TD><TD>            this.theMetricsHandler</TD></TR><TR><TD CLASS="l">353</TD><TD>                    .sendMethodEvent(</TD></TR><TR><TD CLASS="l">354</TD><TD>                            PerformanceMetricsTradeServerOrderHandler.OMS_CANCEL_ORDER_COLLECTOR_PROCESSING_TYPE,</TD></TR><TR><TD CLASS="l">355</TD><TD>                            id, 0);</TD></TR><TR><TD CLASS="l">356</TD><TD> </TD></TR><TR><TD CLASS="l">357</TD><TD>            // pass it on to the workflow for processing</TD></TR><TR CLASS="z"><TD CLASS="l">358</TD><TD>            CancelRequestStruct formattedCancelRequest = createCancelRequestStructWithTypeCheck(order, p_cancelRequest.cancelType, p_cancelRequest.quantity, p_cancelRequest);</TD></TR><TR CLASS="z"><TD CLASS="l">359</TD><TD>            executeCxlRerouteWorkflow(order, p_userId, formattedCancelRequest, p_productKeys);</TD></TR><TR><TD CLASS="l">360</TD><TD>        }</TD></TR><TR><TD CLASS="l">361</TD><TD>        finally</TD></TR><TR CLASS="z"><TD CLASS="l">362</TD><TD>        {</TD></TR><TR><TD CLASS="l">363</TD><TD>            // order.getLock().unlock();</TD></TR><TR><TD CLASS="l">364</TD><TD>            // orderLockManagerHome.findOrderLockManager().unLockOrderOperation(p_cancelRequest.orderId);</TD></TR><TR><TD CLASS="l">365</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">366</TD><TD>        }</TD></TR><TR><TD CLASS="l">367</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">368</TD><TD>        this.theMetricsHandler</TD></TR><TR><TD CLASS="l">369</TD><TD>                .sendMethodEvent(</TD></TR><TR><TD CLASS="l">370</TD><TD>                        PerformanceMetricsTradeServerOrderHandler.OMS_CANCEL_ORDER_COLLECTOR_PROCESSING_TYPE,</TD></TR><TR><TD CLASS="l">371</TD><TD>                        id, 1);</TD></TR><TR CLASS="z"><TD CLASS="l">372</TD><TD>    }</TD></TR><TR><TD CLASS="l">373</TD><TD> </TD></TR><TR><TD CLASS="l">374</TD><TD>    /*</TD></TR><TR><TD CLASS="l">375</TD><TD>     * Convert LegOrderEntryStruct to LegOrderEntryStructV2</TD></TR><TR><TD CLASS="l">376</TD><TD>     * </TD></TR><TR><TD CLASS="l">377</TD><TD>     * Since this class is already deprecated, this method only services </TD></TR><TR><TD CLASS="l">378</TD><TD>     * to make code compiled. For this reason, we do not bother to set the</TD></TR><TR><TD CLASS="l">379</TD><TD>     * side indicator of LegOrderEntryStructV2</TD></TR><TR><TD CLASS="l">380</TD><TD>     */</TD></TR><TR><TD CLASS="l"><A NAME="15">381</A></TD><TD>    private  LegOrderEntryStructV2[] convertLegOrderEntryStructsToV2(</TD></TR><TR><TD CLASS="l">382</TD><TD>            final LegOrderEntryStruct[] legEntries)</TD></TR><TR><TD CLASS="l">383</TD><TD>        throws DataValidationException, SystemException</TD></TR><TR><TD CLASS="l">384</TD><TD>    { </TD></TR><TR CLASS="z"><TD CLASS="l">385</TD><TD>        LegOrderEntryStructV2[] legEntriesV2 = new LegOrderEntryStructV2[legEntries.length];</TD></TR><TR CLASS="z"><TD CLASS="l">386</TD><TD>        for (int i = 0; i &lt; legEntries.length; i++)</TD></TR><TR><TD CLASS="l">387</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">388</TD><TD>            legEntriesV2[i] = new LegOrderEntryStructV2();</TD></TR><TR CLASS="z"><TD CLASS="l">389</TD><TD>            legEntriesV2[i].legOrderEntry = legEntries[i];</TD></TR><TR><TD CLASS="l">390</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">391</TD><TD>        return legEntriesV2;</TD></TR><TR><TD CLASS="l">392</TD><TD>    }</TD></TR><TR><TD CLASS="l">393</TD><TD>    </TD></TR><TR><TD CLASS="l">394</TD><TD> </TD></TR><TR><TD CLASS="l">395</TD><TD>    /**</TD></TR><TR><TD CLASS="l">396</TD><TD>     * handle cancel replace request for both regular and strategy orders</TD></TR><TR><TD CLASS="l">397</TD><TD>     * </TD></TR><TR><TD CLASS="l">398</TD><TD>     * Note: No validation being done for replacement order. The replacement order is just carried</TD></TR><TR><TD CLASS="l">399</TD><TD>     * through</TD></TR><TR><TD CLASS="l">400</TD><TD>     * </TD></TR><TR><TD CLASS="l">401</TD><TD>     */</TD></TR><TR><TD CLASS="l">402</TD><TD>    private OrderIdStruct processCancelReplace(OrderRoutingParameterStruct routingParam,</TD></TR><TR><TD CLASS="l">403</TD><TD>            CancelRequestStruct p_cancelRequest, OrderStruct p_replacementOrder,</TD></TR><TR><TD CLASS="l">404</TD><TD>            LegOrderEntryStructV2[] p_legEntryDetails) throws SystemException,</TD></TR><TR><TD CLASS="l"><A NAME="38">405</A></TD><TD>            DataValidationException, NotAcceptedException, TransactionFailedException,</TD></TR><TR><TD CLASS="l">406</TD><TD>            AuthorizationException, CommunicationException</TD></TR><TR><TD CLASS="l">407</TD><TD>    {</TD></TR><TR><TD CLASS="l">408</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">409</TD><TD>        validateOrderId(p_cancelRequest.orderId);</TD></TR><TR CLASS="z"><TD CLASS="l">410</TD><TD>        validateProductState(p_replacementOrder.activeSession, p_replacementOrder.productKey);</TD></TR><TR><TD CLASS="l">411</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">412</TD><TD>        Order originalOrder = findOrderByOrderId(p_cancelRequest.orderId);</TD></TR><TR><TD CLASS="l">413</TD><TD>       </TD></TR><TR><TD CLASS="l">414</TD><TD>      </TD></TR><TR CLASS="z"><TD CLASS="l">415</TD><TD>        if (originalOrder == null)</TD></TR><TR><TD CLASS="l">416</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">417</TD><TD>            MsgBuilder msg = msg().add(&#34;Order not found in CBOEDirect to cancel and replace : &#34;).add</TD></TR><TR><TD CLASS="l">418</TD><TD>            (&#34;orderId&#34;, p_cancelRequest.orderId);</TD></TR><TR CLASS="z"><TD CLASS="l">419</TD><TD>            log().alarm(msg);</TD></TR><TR CLASS="z"><TD CLASS="l">420</TD><TD>            throw ExceptionBuilder.dataValidationException(</TD></TR><TR><TD CLASS="l">421</TD><TD>                            msg.end(),</TD></TR><TR><TD CLASS="l">422</TD><TD>                    DataValidationCodes.INVALID_ORDER_STATE);</TD></TR><TR><TD CLASS="l">423</TD><TD>        }</TD></TR><TR><TD CLASS="l">424</TD><TD>               </TD></TR><TR><TD CLASS="l">425</TD><TD>        /*</TD></TR><TR><TD CLASS="l">426</TD><TD>         * Hack to check for the source since TpfAdapter does not</TD></TR><TR><TD CLASS="l">427</TD><TD>         * flip the price for stp order/stp_lmt/stp_loss</TD></TR><TR><TD CLASS="l">428</TD><TD>         */</TD></TR><TR CLASS="z"><TD CLASS="l">429</TD><TD>        if(originalOrder.getProductType() != ProductTypes.STRATEGY) {</TD></TR><TR CLASS="z"><TD CLASS="l">430</TD><TD>            if (p_replacementOrder.contingency.type == ContingencyTypes.STP ||</TD></TR><TR><TD CLASS="l">431</TD><TD>                    p_replacementOrder.contingency.type == ContingencyTypes.STP_LOSS || p_replacementOrder.contingency.type == ContingencyTypes.STP_LIMIT) {</TD></TR><TR CLASS="z"><TD CLASS="l">432</TD><TD>                if(originalOrder.getSource() == Sources.TPF) {</TD></TR><TR CLASS="z"><TD CLASS="l">433</TD><TD>                    overridePriceBasedOnContingency(p_replacementOrder);</TD></TR><TR><TD CLASS="l">434</TD><TD>                }</TD></TR><TR><TD CLASS="l">435</TD><TD>            }</TD></TR><TR><TD CLASS="l">436</TD><TD>        }            </TD></TR><TR><TD CLASS="l">437</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">438</TD><TD>        CancelReplaceContext repOrderContext = new CancelReplaceContext();</TD></TR><TR CLASS="z"><TD CLASS="l">439</TD><TD>        Order replacementOrder = getReplacementOrder(p_replacementOrder);</TD></TR><TR><TD CLASS="l">440</TD><TD>        </TD></TR><TR><TD CLASS="l">441</TD><TD>        try </TD></TR><TR><TD CLASS="l">442</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">443</TD><TD>            repOrderContext.startTransaction();</TD></TR><TR><TD CLASS="l">444</TD><TD>            // orderLockManagerHome.findOrderLockManager().lockOrderOperation(replacementOrder.getOrderId());</TD></TR><TR CLASS="z"><TD CLASS="l">445</TD><TD>            CancelRequestStruct formattedCancelRequest = createCancelRequestStructWithTypeCheck(originalOrder, p_cancelRequest.cancelType, p_cancelRequest.quantity, p_cancelRequest);</TD></TR><TR><TD CLASS="l">446</TD><TD>            </TD></TR><TR CLASS="z"><TD CLASS="l">447</TD><TD>            if (replacementOrder == null)</TD></TR><TR><TD CLASS="l">448</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">449</TD><TD>                TradableValidationContext validationContext = new TradableValidationContext(p_legEntryDetails==null?0:p_legEntryDetails.length, false, false);</TD></TR><TR><TD CLASS="l">450</TD><TD>                // New Cxl/Re request from TPF</TD></TR><TR><TD CLASS="l">451</TD><TD>                // set default leg clearing firm if it's not provided</TD></TR><TR CLASS="z"><TD CLASS="l">452</TD><TD>                replacementOrder = createNewOrder(p_replacementOrder, p_legEntryDetails, false);</TD></TR><TR CLASS="z"><TD CLASS="l">453</TD><TD>                executeCancelReplace(routingParam, formattedCancelRequest, originalOrder, p_replacementOrder,</TD></TR><TR><TD CLASS="l">454</TD><TD>                        replacementOrder, p_legEntryDetails, repOrderContext, validationContext, false); // false</TD></TR><TR><TD CLASS="l">455</TD><TD>                                                                                        // indicates not</TD></TR><TR><TD CLASS="l">456</TD><TD>                                                                                        // a rerouted</TD></TR><TR><TD CLASS="l">457</TD><TD>                                                                                        // cxl/re</TD></TR><TR><TD CLASS="l">458</TD><TD>                                                                                        // request</TD></TR><TR CLASS="z"><TD CLASS="l">459</TD><TD>            }</TD></TR><TR><TD CLASS="l">460</TD><TD>            else</TD></TR><TR><TD CLASS="l">461</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">462</TD><TD>                validateExistingStrategyOrderLegFirm(replacementOrder);</TD></TR><TR CLASS="z"><TD CLASS="l">463</TD><TD>                TradableValidationContext validationContext = new TradableValidationContext(p_legEntryDetails==null?0:p_legEntryDetails.length, false, false);</TD></TR><TR><TD CLASS="l">464</TD><TD>                // Rerouted Cxl/Re from TPF.</TD></TR><TR CLASS="z"><TD CLASS="l">465</TD><TD>                executeCancelReplace(routingParam, formattedCancelRequest, originalOrder, p_replacementOrder,</TD></TR><TR><TD CLASS="l">466</TD><TD>                        replacementOrder, p_legEntryDetails, repOrderContext, validationContext, true); // true</TD></TR><TR><TD CLASS="l">467</TD><TD>                                                                                        // indicates a</TD></TR><TR><TD CLASS="l">468</TD><TD>                                                                                        // rerouted</TD></TR><TR><TD CLASS="l">469</TD><TD>                                                                                        // cxl/re</TD></TR><TR><TD CLASS="l">470</TD><TD>                                                                                        // request</TD></TR><TR><TD CLASS="l">471</TD><TD>            };</TD></TR><TR><TD CLASS="l">472</TD><TD>                                                                                        // indicates not</TD></TR><TR><TD CLASS="l">473</TD><TD>                                                                                        // a rerouted</TD></TR><TR><TD CLASS="l">474</TD><TD>                                                                                        // cxl/re</TD></TR><TR><TD CLASS="l">475</TD><TD>                                                                                        // request</TD></TR><TR CLASS="z"><TD CLASS="l">476</TD><TD>            setPreviousLocationAndLocationType(replacementOrder, routingParam);</TD></TR><TR CLASS="z"><TD CLASS="l">477</TD><TD>            setPreviousLocationAndLocationType(originalOrder, routingParam);</TD></TR><TR><TD CLASS="l">478</TD><TD>        }</TD></TR><TR><TD CLASS="l">479</TD><TD>        finally</TD></TR><TR><TD CLASS="l">480</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">481</TD><TD>            if (Transaction.inTransaction())</TD></TR><TR><TD CLASS="l">482</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">483</TD><TD>                log().alarm(</TD></TR><TR><TD CLASS="l">484</TD><TD>                        msg().add(&#34;Rolling back transaction in cxl/re reroute&#34;).add(&#34;order&#34;,</TD></TR><TR><TD CLASS="l">485</TD><TD>                                originalOrder.getOrderId()));</TD></TR><TR CLASS="z"><TD CLASS="l">486</TD><TD>                Transaction.rollback();</TD></TR><TR><TD CLASS="l">487</TD><TD>            }</TD></TR><TR><TD CLASS="l">488</TD><TD> </TD></TR><TR><TD CLASS="l">489</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">490</TD><TD>        return replacementOrder.getOrderId();</TD></TR><TR><TD CLASS="l">491</TD><TD>    }</TD></TR><TR><TD CLASS="l">492</TD><TD> </TD></TR><TR><TD CLASS="l">493</TD><TD>    /*</TD></TR><TR><TD CLASS="l">494</TD><TD>     * Processes Order returned order from TPF with Instruction Pass the HandlingInstruction to OES,</TD></TR><TR><TD CLASS="l">495</TD><TD>     * the Order needs to be updated with the HI, once the order had been created in the database in</TD></TR><TR><TD CLASS="l">496</TD><TD>     * OES...</TD></TR><TR><TD CLASS="l">497</TD><TD>     */</TD></TR><TR><TD CLASS="l">498</TD><TD>    private OrderIdStruct processOrderWithInstructions(OrderStruct p_anOrder,</TD></TR><TR><TD CLASS="l">499</TD><TD>            OrderHandlingInstructionStruct p_handlingInstruction,</TD></TR><TR><TD CLASS="l"><A NAME="3a">500</A></TD><TD>            PriceStruct p_oppositeSideBestOfRest) throws SystemException, CommunicationException,</TD></TR><TR><TD CLASS="l">501</TD><TD>            DataValidationException, TransactionFailedException, NotAcceptedException,</TD></TR><TR><TD CLASS="l">502</TD><TD>            AuthorizationException</TD></TR><TR><TD CLASS="l">503</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">504</TD><TD>        return processOrderWithInstruction(p_anOrder, null, p_handlingInstruction,</TD></TR><TR><TD CLASS="l">505</TD><TD>                p_oppositeSideBestOfRest);</TD></TR><TR><TD CLASS="l">506</TD><TD>    }</TD></TR><TR><TD CLASS="l">507</TD><TD> </TD></TR><TR><TD CLASS="l">508</TD><TD>    /*</TD></TR><TR><TD CLASS="l">509</TD><TD>     * Processes order returned order from TPF with Instruction Pass the HandlingInstruction to OES,</TD></TR><TR><TD CLASS="l">510</TD><TD>     * the Order needs to be updated with the HI, once the order had been created in the database in</TD></TR><TR><TD CLASS="l">511</TD><TD>     * OES...</TD></TR><TR><TD CLASS="l">512</TD><TD>     */</TD></TR><TR><TD CLASS="l">513</TD><TD>    private OrderIdStruct processOrderWithInstruction(OrderStruct p_anOrder,</TD></TR><TR><TD CLASS="l">514</TD><TD>            LegOrderEntryStructV2[] p_legEntryDetails,</TD></TR><TR><TD CLASS="l">515</TD><TD>            OrderHandlingInstructionStruct p_handlingInstruction,</TD></TR><TR><TD CLASS="l"><A NAME="39">516</A></TD><TD>            PriceStruct p_oppositeSideBestOfRest) throws SystemException, CommunicationException,</TD></TR><TR><TD CLASS="l">517</TD><TD>            DataValidationException, TransactionFailedException, NotAcceptedException,</TD></TR><TR><TD CLASS="l">518</TD><TD>            AuthorizationException</TD></TR><TR><TD CLASS="l">519</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">520</TD><TD>        Order foundOrder = findOrderAndCheckSource(p_anOrder);</TD></TR><TR CLASS="z"><TD CLASS="l">521</TD><TD>        validateOrderId(p_anOrder.orderId);</TD></TR><TR CLASS="z"><TD CLASS="l">522</TD><TD>        LegOrderEntryStructV2[] legEntryDetails = p_legEntryDetails;</TD></TR><TR CLASS="z"><TD CLASS="l">523</TD><TD>        if (p_legEntryDetails == null)</TD></TR><TR><TD CLASS="l">524</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">525</TD><TD>            validateOrder(p_anOrder, p_handlingInstruction);</TD></TR><TR CLASS="z"><TD CLASS="l">526</TD><TD>            validateProductState(p_anOrder.productKey, p_anOrder);</TD></TR><TR><TD CLASS="l">527</TD><TD>        }</TD></TR><TR><TD CLASS="l">528</TD><TD>        else</TD></TR><TR><TD CLASS="l">529</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">530</TD><TD>            TradableValidationContext validationContext = new TradableValidationContext(p_legEntryDetails==null?0:p_legEntryDetails.length, false, false);</TD></TR><TR CLASS="z"><TD CLASS="l">531</TD><TD>            if (foundOrder!=null)</TD></TR><TR><TD CLASS="l">532</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">533</TD><TD>                validateExistingStrategyOrderLegFirm(foundOrder);</TD></TR><TR><TD CLASS="l">534</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">535</TD><TD>                if (tradableValidationService.isCrossProduct(foundOrder.getProductKey()))</TD></TR><TR><TD CLASS="l">536</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">537</TD><TD>                    legEntryDetails = createLegEntryDetailsFromFoundOrder(foundOrder);</TD></TR><TR><TD CLASS="l">538</TD><TD>                }</TD></TR><TR><TD CLASS="l">539</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">540</TD><TD>            validateStrategyOrder(p_anOrder, legEntryDetails, p_handlingInstruction, validationContext);</TD></TR><TR><TD CLASS="l">541</TD><TD>            //if order is found and leg firm is blank, the order is rejected to TPF</TD></TR><TR><TD CLASS="l">542</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">543</TD><TD>            if (p_handlingInstruction.maximumExecutionVolume == 0)</TD></TR><TR><TD CLASS="l">544</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">545</TD><TD>                p_handlingInstruction.maximumExecutionVolume = p_anOrder.originalQuantity;</TD></TR><TR><TD CLASS="l">546</TD><TD>            }</TD></TR><TR><TD CLASS="l">547</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">548</TD><TD>        return executeOrderWithInstructions(p_anOrder, p_legEntryDetails, foundOrder, p_handlingInstruction,</TD></TR><TR><TD CLASS="l">549</TD><TD>                p_oppositeSideBestOfRest);</TD></TR><TR><TD CLASS="l">550</TD><TD>    }</TD></TR><TR><TD CLASS="l">551</TD><TD> </TD></TR><TR><TD CLASS="l">552</TD><TD>    /**</TD></TR><TR><TD CLASS="l">553</TD><TD>     * Cross product orders are required to have a stock leg clearing firm specified by the time they</TD></TR><TR><TD CLASS="l">554</TD><TD>     * are being returned by TPF.  Existing code ends up attempting to validate this by using the</TD></TR><TR><TD CLASS="l">555</TD><TD>     * LegOrderEntryDetail from TPFAdapter, which is always blank.  To keep executing our validation</TD></TR><TR><TD CLASS="l">556</TD><TD>     * strategies when the order is already in our system, we will recreate the LegOrderEntryDetail</TD></TR><TR><TD CLASS="l">557</TD><TD>     * from the found Order object, for validation purposes.</TD></TR><TR><TD CLASS="l">558</TD><TD>     * </TD></TR><TR><TD CLASS="l">559</TD><TD>     * @param foundOrder</TD></TR><TR><TD CLASS="l">560</TD><TD>     * @return</TD></TR><TR><TD CLASS="l">561</TD><TD>     */</TD></TR><TR><TD CLASS="l">562</TD><TD>    private LegOrderEntryStructV2[] createLegEntryDetailsFromFoundOrder(Order foundOrder)</TD></TR><TR><TD CLASS="l">563</TD><TD>    {</TD></TR><TR><TD CLASS="l">564</TD><TD>        // 5941 (PITS 9192) - cross product leg firm validation error</TD></TR><TR><TD CLASS="l">565</TD><TD>        //</TD></TR><TR><TD CLASS="l">566</TD><TD>        // (this method was introduced to address this leg firm validation problem)</TD></TR><TR><TD CLASS="l"><A NAME="17">567</A></TD><TD>        //</TD></TR><TR><TD CLASS="l">568</TD><TD>        // Sinclair 3/19/2008</TD></TR><TR><TD CLASS="l">569</TD><TD>        //</TD></TR><TR><TD CLASS="l">570</TD><TD>        LegOrderEntryStructV2[] legEntryDetails;</TD></TR><TR CLASS="z"><TD CLASS="l">571</TD><TD>        OrderStruct orderStruct = foundOrder.getStruct();</TD></TR><TR CLASS="z"><TD CLASS="l">572</TD><TD>        legEntryDetails = new LegOrderEntryStructV2[orderStruct.legOrderDetails.length];</TD></TR><TR CLASS="z"><TD CLASS="l">573</TD><TD>        for(int i=0; i &lt; orderStruct.legOrderDetails.length; i++)</TD></TR><TR><TD CLASS="l">574</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">575</TD><TD>            legEntryDetails[i] = new LegOrderEntryStructV2();</TD></TR><TR CLASS="z"><TD CLASS="l">576</TD><TD>            legEntryDetails[i].legOrderEntry = new LegOrderEntryStruct();</TD></TR><TR CLASS="z"><TD CLASS="l">577</TD><TD>            legEntryDetails[i].legOrderEntry .clearingFirm = orderStruct.legOrderDetails[i].clearingFirm;</TD></TR><TR CLASS="z"><TD CLASS="l">578</TD><TD>            legEntryDetails[i].legOrderEntry .coverage = orderStruct.legOrderDetails[i].coverage;</TD></TR><TR CLASS="z"><TD CLASS="l">579</TD><TD>            legEntryDetails[i].legOrderEntry .mustUsePrice = orderStruct.legOrderDetails[i].mustUsePrice;</TD></TR><TR CLASS="z"><TD CLASS="l">580</TD><TD>            legEntryDetails[i].legOrderEntry .positionEffect = orderStruct.legOrderDetails[i].positionEffect;</TD></TR><TR CLASS="z"><TD CLASS="l">581</TD><TD>            legEntryDetails[i].legOrderEntry .productKey = orderStruct.legOrderDetails[i].productKey;</TD></TR><TR CLASS="z"><TD CLASS="l">582</TD><TD>            legEntryDetails[i].side = orderStruct.legOrderDetails[i].side;</TD></TR><TR><TD CLASS="l">583</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">584</TD><TD>        return legEntryDetails;</TD></TR><TR><TD CLASS="l">585</TD><TD>    }</TD></TR><TR><TD CLASS="l">586</TD><TD>    </TD></TR><TR><TD CLASS="l">587</TD><TD>    /**</TD></TR><TR><TD CLASS="l">588</TD><TD>     * This is a hack that bypasses validation strategy, but blindly check if a leg firm is blank for a cross-product order</TD></TR><TR><TD CLASS="l">589</TD><TD>     * Coupled with the way we check and set default leg firm in OES that we blank out any inferred firm on the equity leg if it's not valid but pass on to TPF</TD></TR><TR><TD CLASS="l">590</TD><TD>     *    It would be better if we set some flag on the new order to TPF in this case that TPF should not route the order back</TD></TR><TR><TD CLASS="l">591</TD><TD>     *       but there is no such mechanism between CD and TPF</TD></TR><TR><TD CLASS="l"><A NAME="40">592</A></TD><TD>     * So, here we check if an existing crossproduct order has a blank leg firm, then we raise exception and reject it to TPF</TD></TR><TR><TD CLASS="l">593</TD><TD>     */    </TD></TR><TR><TD CLASS="l">594</TD><TD>    private void validateExistingStrategyOrderLegFirm(Order order) throws DataValidationException, SystemException</TD></TR><TR><TD CLASS="l">595</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">596</TD><TD>        boolean isCP = tradableValidationService.isCrossProduct(order.getProductKey());</TD></TR><TR CLASS="z"><TD CLASS="l">597</TD><TD>        if (!isCP) return;</TD></TR><TR CLASS="z"><TD CLASS="l">598</TD><TD>        LegOrderDetail[] legDetails = order.getLegOrderDetails();</TD></TR><TR CLASS="z"><TD CLASS="l">599</TD><TD>        for (int i=0; i&lt;legDetails.length;i++)</TD></TR><TR><TD CLASS="l">600</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">601</TD><TD>            if (legDetails[i].getClearingFirm().exchange.equals(&#34;&#34;) || legDetails[i].getClearingFirm().firmNumber.equals(&#34;&#34;))</TD></TR><TR><TD CLASS="l">602</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">603</TD><TD>                MsgBuilder msg = msg();</TD></TR><TR CLASS="z"><TD CLASS="l">604</TD><TD>                log().debug(msg.add(&#34;Existing cross product order in cache has blank clearing firm for leg #&#34;+i+&#34;; reject to TPF&#34;));</TD></TR><TR CLASS="z"><TD CLASS="l">605</TD><TD>                throw ExceptionBuilder.dataValidationException(msg.end(), DataValidationCodes.INVALID_CLEARING_FIRM);</TD></TR><TR><TD CLASS="l">606</TD><TD>            }</TD></TR><TR><TD CLASS="l">607</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">608</TD><TD>    }</TD></TR><TR><TD CLASS="l">609</TD><TD> </TD></TR><TR><TD CLASS="l">610</TD><TD>    /**</TD></TR><TR><TD CLASS="l">611</TD><TD>     * @throw SystemException if there was any trouble finding the product information.</TD></TR><TR><TD CLASS="l">612</TD><TD>     * @throw NotAcceptedException if the product is in a suspended state.</TD></TR><TR><TD CLASS="l">613</TD><TD>     */</TD></TR><TR><TD CLASS="l">614</TD><TD>    private void validateProductState(final String sessName, final int productKey)</TD></TR><TR><TD CLASS="l">615</TD><TD>            throws SystemException, NotAcceptedException</TD></TR><TR><TD CLASS="l"><A NAME="43">616</A></TD><TD>    {</TD></TR><TR><TD CLASS="l">617</TD><TD>        ProductData prodData;</TD></TR><TR><TD CLASS="l">618</TD><TD>        try</TD></TR><TR><TD CLASS="l">619</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">620</TD><TD>            prodData = this.productDataCache.getProductData(productKey);</TD></TR><TR><TD CLASS="l">621</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">622</TD><TD>        catch (NotFoundException e)</TD></TR><TR><TD CLASS="l">623</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">624</TD><TD>            final MsgBuilder msg = msg().add(&#34;Unknown productKey&#34;, productKey).add(</TD></TR><TR><TD CLASS="l">625</TD><TD>                    &#34;has invalid branch sequence number&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">626</TD><TD>            throw ExceptionBuilder.systemException(msg.end(), 0);</TD></TR><TR CLASS="z"><TD CLASS="l">627</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">628</TD><TD>        if (prodData.getState(sessName) == ProductStates.SUSPENDED)</TD></TR><TR><TD CLASS="l">629</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">630</TD><TD>            final MsgBuilder msg = msg().add(&#34;Product &#34;, productKey).add(</TD></TR><TR><TD CLASS="l">631</TD><TD>                    &#34; is SUSPENDED for session &#34;, sessName);</TD></TR><TR CLASS="z"><TD CLASS="l">632</TD><TD>            throw ExceptionBuilder.systemException(msg.end(), NotAcceptedCodes.INVALID_STATE);</TD></TR><TR><TD CLASS="l">633</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">634</TD><TD>    }</TD></TR><TR><TD CLASS="l">635</TD><TD> </TD></TR><TR><TD CLASS="l">636</TD><TD> </TD></TR><TR><TD CLASS="l">637</TD><TD>    /**</TD></TR><TR><TD CLASS="l">638</TD><TD>     * Validate product state checks for OPEN and FAST_MARKET and Allowed Contingencies on</TD></TR><TR><TD CLASS="l">639</TD><TD>     * strategies, so check before sending to WorkFlo. Throw NotAccepted exception if the product is</TD></TR><TR><TD CLASS="l">640</TD><TD>     * in a suspended state.</TD></TR><TR><TD CLASS="l">641</TD><TD>     */</TD></TR><TR><TD CLASS="l">642</TD><TD>    protected void validateProductState(int productKey, OrderStruct theOrder)</TD></TR><TR><TD CLASS="l">643</TD><TD>            throws SystemException, NotAcceptedException</TD></TR><TR><TD CLASS="l"><A NAME="44">644</A></TD><TD>    {</TD></TR><TR><TD CLASS="l">645</TD><TD>        ProductData prodData;</TD></TR><TR><TD CLASS="l">646</TD><TD>        try</TD></TR><TR><TD CLASS="l">647</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">648</TD><TD>            prodData = this.productDataCache.getProductData(productKey);</TD></TR><TR><TD CLASS="l">649</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">650</TD><TD>        catch (NotFoundException e)</TD></TR><TR><TD CLASS="l">651</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">652</TD><TD>            throw ExceptionBuilder.systemException(&#34;Unknown productKey &#34; + productKey, 0);</TD></TR><TR CLASS="z"><TD CLASS="l">653</TD><TD>        }</TD></TR><TR><TD CLASS="l">654</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">655</TD><TD>        if ((prodData.getState(theOrder.activeSession) != ProductStates.OPEN)</TD></TR><TR><TD CLASS="l">656</TD><TD>                &amp;&amp; (prodData.getState(theOrder.activeSession) != ProductStates.FAST_MARKET))</TD></TR><TR><TD CLASS="l">657</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">658</TD><TD>            if (theOrder != null)</TD></TR><TR><TD CLASS="l">659</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">660</TD><TD>                if (theOrder.productType == ProductTypes.STRATEGY</TD></TR><TR><TD CLASS="l">661</TD><TD>                        &amp;&amp; theOrder.contingency.type == ContingencyTypes.IOC)</TD></TR><TR><TD CLASS="l">662</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">663</TD><TD>                    throw ExceptionBuilder</TD></TR><TR><TD CLASS="l">664</TD><TD>                            .notAcceptedException(</TD></TR><TR><TD CLASS="l">665</TD><TD>                                    msg()</TD></TR><TR><TD CLASS="l">666</TD><TD>                                            .add(&#34;Product&#34;, productKey)</TD></TR><TR><TD CLASS="l">667</TD><TD>                                            .add(</TD></TR><TR><TD CLASS="l">668</TD><TD>                                                    &#34;is currently not OPEN/FAST: IOC Strategy order is NOT permitted,&#34;)</TD></TR><TR><TD CLASS="l">669</TD><TD>                                            .add(&#34;orderId&#34;, theOrder.orderId).end(),</TD></TR><TR><TD CLASS="l">670</TD><TD>                                    NotAcceptedCodes.INVALID_STATE);</TD></TR><TR><TD CLASS="l">671</TD><TD>                }</TD></TR><TR><TD CLASS="l">672</TD><TD>            }</TD></TR><TR><TD CLASS="l">673</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">674</TD><TD>    }</TD></TR><TR><TD CLASS="l">675</TD><TD> </TD></TR><TR><TD CLASS="l">676</TD><TD>    </TD></TR><TR><TD CLASS="l">677</TD><TD>    /**</TD></TR><TR><TD CLASS="l">678</TD><TD>     * Validates order id struct before it is used to query for order.</TD></TR><TR><TD CLASS="l">679</TD><TD>     */</TD></TR><TR><TD CLASS="l">680</TD><TD>    protected void validateOrderId(OrderIdStruct orderId) throws DataValidationException</TD></TR><TR><TD CLASS="l"><A NAME="42">681</A></TD><TD>    {</TD></TR><TR><TD CLASS="l">682</TD><TD>        // if databaseid is not given, then zero sequence number is invalid and could end up with</TD></TR><TR><TD CLASS="l">683</TD><TD>        // multiple orders being</TD></TR><TR><TD CLASS="l">684</TD><TD>        // found because of way JGrinder does query by example</TD></TR><TR CLASS="z"><TD CLASS="l">685</TD><TD>        if ((orderId.highCboeId == 0 || orderId.lowCboeId == 0)</TD></TR><TR><TD CLASS="l">686</TD><TD>                &amp;&amp; orderId.branchSequenceNumber == 0)</TD></TR><TR><TD CLASS="l">687</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">688</TD><TD>            final MsgBuilder msg = msg().add(&#34;orderId&#34;, orderId).add(</TD></TR><TR><TD CLASS="l">689</TD><TD>                    &#34;has invalid branch sequence number&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">690</TD><TD>            if (log().isDebugOn())</TD></TR><TR><TD CLASS="l">691</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">692</TD><TD>                log().debug(msg);</TD></TR><TR><TD CLASS="l">693</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">694</TD><TD>            throw ExceptionBuilder.dataValidationException(msg.end(),</TD></TR><TR><TD CLASS="l">695</TD><TD>                    DataValidationCodes.INVALID_BRANCH_SEQUENCE_NUMBER);</TD></TR><TR><TD CLASS="l">696</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">697</TD><TD>    }</TD></TR><TR><TD CLASS="l">698</TD><TD> </TD></TR><TR><TD CLASS="l">699</TD><TD>    </TD></TR><TR><TD CLASS="l">700</TD><TD>    /**</TD></TR><TR><TD CLASS="l">701</TD><TD>     * ask the order home to find an order by the order id</TD></TR><TR><TD CLASS="l"><A NAME="23">702</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">703</TD><TD>    private Order findOrderByOrderId(final OrderIdStruct anOrderId) throws DataValidationException,</TD></TR><TR><TD CLASS="l">704</TD><TD>            SystemException, TransactionFailedException</TD></TR><TR><TD CLASS="l">705</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">706</TD><TD>        Order order = null;</TD></TR><TR><TD CLASS="l">707</TD><TD>        try</TD></TR><TR><TD CLASS="l">708</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">709</TD><TD>            order = orderHome.findOrder(anOrderId, false);</TD></TR><TR><TD CLASS="l">710</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">711</TD><TD>        catch (final NotFoundException e)</TD></TR><TR><TD CLASS="l">712</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">713</TD><TD>            MsgBuilder msg = msg().add(&#34;orderId&#34;, anOrderId).add(&#34;not found&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">714</TD><TD>            throw ExceptionBuilder.dataValidationException(msg.end(),</TD></TR><TR><TD CLASS="l">715</TD><TD>                    DataValidationCodes.INVALID_ORDER_ID);</TD></TR><TR><TD CLASS="l">716</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">717</TD><TD>        catch (final DuplicateOrderIDException e)</TD></TR><TR><TD CLASS="l">718</TD><TD>        { // this should never happen if the DB schema is correct</TD></TR><TR CLASS="z"><TD CLASS="l">719</TD><TD>            MsgBuilder msg = msg().add(&#34;orderId&#34;, anOrderId).add(&#34;not found&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">720</TD><TD>            log().alarm(msg().add(&#34;duplicate OrderId found, change DB config! &#34;).add(msg));</TD></TR><TR CLASS="z"><TD CLASS="l">721</TD><TD>            throw ExceptionBuilder.dataValidationException(msg.end(),</TD></TR><TR><TD CLASS="l">722</TD><TD>                    DataValidationCodes.DUPLICATE_ID);</TD></TR><TR CLASS="z"><TD CLASS="l">723</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">724</TD><TD>        return order;</TD></TR><TR><TD CLASS="l">725</TD><TD>    }</TD></TR><TR><TD CLASS="l">726</TD><TD> </TD></TR><TR><TD CLASS="l">727</TD><TD> </TD></TR><TR><TD CLASS="l">728</TD><TD>    /*</TD></TR><TR><TD CLASS="l">729</TD><TD>     * Return replacement order.</TD></TR><TR><TD CLASS="l">730</TD><TD>     */</TD></TR><TR><TD CLASS="l"><A NAME="2b">731</A></TD><TD>    private Order getReplacementOrder(OrderStruct p_replacementOrder)</TD></TR><TR><TD CLASS="l">732</TD><TD>    {</TD></TR><TR><TD CLASS="l">733</TD><TD>        try</TD></TR><TR><TD CLASS="l">734</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">735</TD><TD>            return findOrderByOrderId(p_replacementOrder.orderId);</TD></TR><TR><TD CLASS="l">736</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">737</TD><TD>        catch (DataValidationException e)</TD></TR><TR><TD CLASS="l">738</TD><TD>        {</TD></TR><TR><TD CLASS="l">739</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">740</TD><TD>        catch (SystemException e)</TD></TR><TR><TD CLASS="l">741</TD><TD>        {</TD></TR><TR><TD CLASS="l">742</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">743</TD><TD>        catch (TransactionFailedException e)</TD></TR><TR><TD CLASS="l">744</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">745</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">746</TD><TD>        return null;</TD></TR><TR><TD CLASS="l">747</TD><TD>    }</TD></TR><TR><TD CLASS="l">748</TD><TD> </TD></TR><TR><TD CLASS="l">749</TD><TD> </TD></TR><TR><TD CLASS="l">750</TD><TD>    private void executeCxlRerouteWorkflow(Order order, String p_userId,</TD></TR><TR><TD CLASS="l"><A NAME="1e">751</A></TD><TD>            CancelRequestStruct p_cancelRequest, ProductKeysStruct p_productKeys)</TD></TR><TR><TD CLASS="l">752</TD><TD>            throws CommunicationException, SystemException, AuthorizationException,</TD></TR><TR><TD CLASS="l">753</TD><TD>            DataValidationException, TransactionFailedException, NotAcceptedException</TD></TR><TR><TD CLASS="l">754</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">755</TD><TD>        short state = order.getState();</TD></TR><TR CLASS="z"><TD CLASS="l">756</TD><TD>        short locationType = order.getLocationType();</TD></TR><TR><TD CLASS="l">757</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">758</TD><TD>        IWorkflowExecutor&lt;CancelContext&gt; executor = getCxlRerouteExecutor(order, p_userId,</TD></TR><TR><TD CLASS="l">759</TD><TD>                p_cancelRequest, p_productKeys);</TD></TR><TR CLASS="z"><TD CLASS="l">760</TD><TD>        executor.autoExecute();</TD></TR><TR CLASS="z"><TD CLASS="l">761</TD><TD>        if (executor.getContext().getException() != null)</TD></TR><TR><TD CLASS="l">762</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">763</TD><TD>            maybeThrow(executor.getContext());</TD></TR><TR><TD CLASS="l">764</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">765</TD><TD>        executor.reset(null);</TD></TR><TR CLASS="z"><TD CLASS="l">766</TD><TD>    }</TD></TR><TR><TD CLASS="l">767</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="1d">768</A></TD><TD>    private void executeCxlReplaceRerouteWorkflow(CancelReplaceContext p_context)</TD></TR><TR><TD CLASS="l">769</TD><TD>            throws CommunicationException, SystemException, AuthorizationException,</TD></TR><TR><TD CLASS="l">770</TD><TD>            DataValidationException, TransactionFailedException, NotAcceptedException</TD></TR><TR><TD CLASS="l">771</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">772</TD><TD>        Order replacedOrder = p_context.getReplacementOrder();</TD></TR><TR CLASS="z"><TD CLASS="l">773</TD><TD>        short originalState = replacedOrder.getState();</TD></TR><TR CLASS="z"><TD CLASS="l">774</TD><TD>        short originalLocationType = replacedOrder.getLocationType();</TD></TR><TR><TD CLASS="l">775</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">776</TD><TD>        IWorkflowExecutor&lt;CancelReplaceContext&gt; executor = getCxlReRerouteExecutor(p_context);</TD></TR><TR CLASS="z"><TD CLASS="l">777</TD><TD>        executor.autoExecute();</TD></TR><TR CLASS="z"><TD CLASS="l">778</TD><TD>        if (executor.getContext().getException() != null)</TD></TR><TR><TD CLASS="l">779</TD><TD>        {</TD></TR><TR><TD CLASS="l">780</TD><TD> </TD></TR><TR><TD CLASS="l">781</TD><TD>            try</TD></TR><TR><TD CLASS="l">782</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">783</TD><TD>                if (p_context.inTransaction())</TD></TR><TR CLASS="z"><TD CLASS="l">784</TD><TD>                    p_context.rollbackTransaction();</TD></TR><TR><TD CLASS="l">785</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">786</TD><TD>                p_context.startTransaction();</TD></TR><TR CLASS="z"><TD CLASS="l">787</TD><TD>                replacedOrder.changeToState(originalState);</TD></TR><TR CLASS="z"><TD CLASS="l">788</TD><TD>                replacedOrder.setLocationType(originalLocationType);</TD></TR><TR CLASS="z"><TD CLASS="l">789</TD><TD>                p_context.commitTransaction();</TD></TR><TR><TD CLASS="l">790</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">791</TD><TD>            catch (Exception e)</TD></TR><TR><TD CLASS="l">792</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">793</TD><TD>                log().alarm(msg().add(&#34;Failed to set the State and Location Type for the Order, Order ID: &#34;)</TD></TR><TR><TD CLASS="l">794</TD><TD>                                 .add(replacedOrder.getOrderIdString()));</TD></TR><TR CLASS="z"><TD CLASS="l">795</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">796</TD><TD>            maybeThrow(executor.getContext());</TD></TR><TR><TD CLASS="l">797</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">798</TD><TD>        executor.reset(null);</TD></TR><TR CLASS="z"><TD CLASS="l">799</TD><TD>    }</TD></TR><TR><TD CLASS="l">800</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="1f">801</A></TD><TD>    private void executeNewOrderWorkflow(OrderContext p_context) throws CommunicationException,</TD></TR><TR><TD CLASS="l">802</TD><TD>            SystemException, AuthorizationException, DataValidationException,</TD></TR><TR><TD CLASS="l">803</TD><TD>            TransactionFailedException, NotAcceptedException</TD></TR><TR><TD CLASS="l">804</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">805</TD><TD>        IWorkflowExecutor&lt;OrderContext&gt; executor = getNewOrderExecutor(p_context);</TD></TR><TR CLASS="z"><TD CLASS="l">806</TD><TD>        executor.autoExecute();</TD></TR><TR CLASS="z"><TD CLASS="l">807</TD><TD>        if (executor.getContext().getException() != null)</TD></TR><TR><TD CLASS="l">808</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">809</TD><TD>            Order newOrder = p_context.getOrder();</TD></TR><TR><TD CLASS="l">810</TD><TD>            try</TD></TR><TR><TD CLASS="l">811</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">812</TD><TD>                if (p_context.inTransaction())</TD></TR><TR CLASS="z"><TD CLASS="l">813</TD><TD>                    p_context.rollbackTransaction();</TD></TR><TR><TD CLASS="l">814</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">815</TD><TD>                OrderHome orderHome = newOrder.getMyHome();</TD></TR><TR CLASS="z"><TD CLASS="l">816</TD><TD>                orderHome.delete(newOrder);</TD></TR><TR><TD CLASS="l">817</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">818</TD><TD>            catch (Exception e)</TD></TR><TR><TD CLASS="l">819</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">820</TD><TD>                log().alarm(</TD></TR><TR><TD CLASS="l">821</TD><TD>                        msg().add(&#34;Failed to delete the Order, Order ID: &#34;).add(</TD></TR><TR><TD CLASS="l">822</TD><TD>                                newOrder.getOrderIdString()));</TD></TR><TR CLASS="z"><TD CLASS="l">823</TD><TD>            }</TD></TR><TR><TD CLASS="l">824</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">825</TD><TD>            maybeThrow(executor.getContext());</TD></TR><TR><TD CLASS="l">826</TD><TD> </TD></TR><TR><TD CLASS="l">827</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">828</TD><TD>        executor.reset(null);</TD></TR><TR CLASS="z"><TD CLASS="l">829</TD><TD>    }</TD></TR><TR><TD CLASS="l">830</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="1c">831</A></TD><TD>    private void executeCxlReplaceOrderWorkflow(CancelReplaceContext p_context)</TD></TR><TR><TD CLASS="l">832</TD><TD>            throws CommunicationException, SystemException, AuthorizationException,</TD></TR><TR><TD CLASS="l">833</TD><TD>            DataValidationException, TransactionFailedException, NotAcceptedException</TD></TR><TR><TD CLASS="l">834</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">835</TD><TD>        IWorkflowExecutor&lt;CancelReplaceContext&gt; executor = getCxlReOrderExecutor(p_context);</TD></TR><TR CLASS="z"><TD CLASS="l">836</TD><TD>        executor.autoExecute();</TD></TR><TR CLASS="z"><TD CLASS="l">837</TD><TD>        if (executor.getContext().getException() != null)</TD></TR><TR><TD CLASS="l">838</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">839</TD><TD>            if (p_context.inTransaction())</TD></TR><TR CLASS="z"><TD CLASS="l">840</TD><TD>                p_context.rollbackTransaction();</TD></TR><TR><TD CLASS="l">841</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">842</TD><TD>            Order replacedOrder = p_context.getReplacementOrder();</TD></TR><TR><TD CLASS="l">843</TD><TD>            try</TD></TR><TR><TD CLASS="l">844</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">845</TD><TD>                OrderHome orderHome = replacedOrder.getMyHome();</TD></TR><TR CLASS="z"><TD CLASS="l">846</TD><TD>                orderHome.delete(replacedOrder);</TD></TR><TR><TD CLASS="l">847</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">848</TD><TD>            catch (Exception e)</TD></TR><TR><TD CLASS="l">849</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">850</TD><TD>                log().alarm(</TD></TR><TR><TD CLASS="l">851</TD><TD>                        msg().add(&#34;Failed to delete the Replaced Order, Order ID: &#34;).add(</TD></TR><TR><TD CLASS="l">852</TD><TD>                                replacedOrder.getOrderIdString()));</TD></TR><TR CLASS="z"><TD CLASS="l">853</TD><TD>            }</TD></TR><TR><TD CLASS="l">854</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">855</TD><TD>            maybeThrow(executor.getContext());</TD></TR><TR><TD CLASS="l">856</TD><TD> </TD></TR><TR><TD CLASS="l">857</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">858</TD><TD>        executor.reset(null);</TD></TR><TR><TD CLASS="l">859</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="29">860</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">861</TD><TD> </TD></TR><TR><TD CLASS="l">862</TD><TD>    private IWorkflowExecutor&lt;OrderContext&gt; getOrderRerouteExecutor(OrderContext p_context)</TD></TR><TR><TD CLASS="l">863</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">864</TD><TD>        IWorkflowExecutor&lt;OrderContext&gt; executor = this.tlOrderRerouteExecutor.get();</TD></TR><TR CLASS="z"><TD CLASS="l">865</TD><TD>        if (executor == null)</TD></TR><TR><TD CLASS="l">866</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">867</TD><TD>            executor = this.orderRerouteWorkflow.createExecutor(p_context, false);</TD></TR><TR CLASS="z"><TD CLASS="l">868</TD><TD>            tlOrderRerouteExecutor.set(executor);</TD></TR><TR><TD CLASS="l">869</TD><TD>        }</TD></TR><TR><TD CLASS="l">870</TD><TD>        else</TD></TR><TR><TD CLASS="l">871</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">872</TD><TD>            executor.reset(p_context);</TD></TR><TR><TD CLASS="l">873</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">874</TD><TD>        return executor;</TD></TR><TR><TD CLASS="l">875</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="26">876</A></TD><TD> </TD></TR><TR><TD CLASS="l">877</TD><TD>    private IWorkflowExecutor&lt;CancelContext&gt; getCxlRerouteExecutor(Order order, String p_userId,</TD></TR><TR><TD CLASS="l">878</TD><TD>            CancelRequestStruct p_cancelRequest, ProductKeysStruct p_productKeys)</TD></TR><TR><TD CLASS="l">879</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">880</TD><TD>        IWorkflowExecutor&lt;CancelContext&gt; executor = tlCxlRerouteExecutor.get();</TD></TR><TR CLASS="z"><TD CLASS="l">881</TD><TD>        CancelContext context = new CancelContext(p_userId, p_cancelRequest, p_productKeys);</TD></TR><TR CLASS="z"><TD CLASS="l">882</TD><TD>        context.setOrder(order);</TD></TR><TR CLASS="z"><TD CLASS="l">883</TD><TD>        context.setRoutingParams(TPF_UNKNOWN_ROUTING_PARAM);</TD></TR><TR CLASS="z"><TD CLASS="l">884</TD><TD>        if (executor == null)</TD></TR><TR><TD CLASS="l">885</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">886</TD><TD>            executor = cxlRerouteWorkflow.createExecutor(context, false);</TD></TR><TR CLASS="z"><TD CLASS="l">887</TD><TD>            tlCxlRerouteExecutor.set(executor);</TD></TR><TR><TD CLASS="l">888</TD><TD>        }</TD></TR><TR><TD CLASS="l">889</TD><TD>        else</TD></TR><TR><TD CLASS="l">890</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">891</TD><TD>            executor.reset(context);</TD></TR><TR><TD CLASS="l">892</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">893</TD><TD>        return executor;</TD></TR><TR><TD CLASS="l">894</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="25">895</A></TD><TD> </TD></TR><TR><TD CLASS="l">896</TD><TD>    private IWorkflowExecutor&lt;CancelReplaceContext&gt; getCxlReRerouteExecutor(</TD></TR><TR><TD CLASS="l">897</TD><TD>            CancelReplaceContext p_context)</TD></TR><TR><TD CLASS="l">898</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">899</TD><TD>        IWorkflowExecutor&lt;CancelReplaceContext&gt; executor = tlCxlReplaceRerouteWorkflow.get();</TD></TR><TR CLASS="z"><TD CLASS="l">900</TD><TD>        if (executor == null)</TD></TR><TR><TD CLASS="l">901</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">902</TD><TD>            executor = cxlReplaceRerouteWorkflow.createExecutor(p_context, false);</TD></TR><TR CLASS="z"><TD CLASS="l">903</TD><TD>            tlCxlReplaceRerouteWorkflow.set(executor);</TD></TR><TR><TD CLASS="l">904</TD><TD>        }</TD></TR><TR><TD CLASS="l">905</TD><TD>        else</TD></TR><TR><TD CLASS="l">906</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">907</TD><TD>            executor.reset(p_context);</TD></TR><TR><TD CLASS="l">908</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">909</TD><TD>        return executor;</TD></TR><TR><TD CLASS="l"><A NAME="28">910</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">911</TD><TD> </TD></TR><TR><TD CLASS="l">912</TD><TD>    private IWorkflowExecutor&lt;OrderContext&gt; getNewOrderExecutor(OrderContext p_context)</TD></TR><TR><TD CLASS="l">913</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">914</TD><TD>        IWorkflowExecutor&lt;OrderContext&gt; executor = tlNewOrderExecutor.get();</TD></TR><TR CLASS="z"><TD CLASS="l">915</TD><TD>        if (executor == null)</TD></TR><TR><TD CLASS="l">916</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">917</TD><TD>            executor = newOrderWorkflow.createExecutor(p_context, false);</TD></TR><TR CLASS="z"><TD CLASS="l">918</TD><TD>            tlNewOrderExecutor.set(executor);</TD></TR><TR><TD CLASS="l">919</TD><TD>        }</TD></TR><TR><TD CLASS="l">920</TD><TD>        else</TD></TR><TR><TD CLASS="l">921</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">922</TD><TD>            executor.reset(p_context);</TD></TR><TR><TD CLASS="l">923</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">924</TD><TD>        return executor;</TD></TR><TR><TD CLASS="l">925</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="24">926</A></TD><TD> </TD></TR><TR><TD CLASS="l">927</TD><TD>    private IWorkflowExecutor&lt;CancelReplaceContext&gt; getCxlReOrderExecutor(</TD></TR><TR><TD CLASS="l">928</TD><TD>            CancelReplaceContext p_context)</TD></TR><TR><TD CLASS="l">929</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">930</TD><TD>        IWorkflowExecutor&lt;CancelReplaceContext&gt; executor = tlCxlReOrderExecutor.get();</TD></TR><TR CLASS="z"><TD CLASS="l">931</TD><TD>        if (executor == null)</TD></TR><TR><TD CLASS="l">932</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">933</TD><TD>            executor = cxlReOrderWorkflow.createExecutor(p_context, false);</TD></TR><TR CLASS="z"><TD CLASS="l">934</TD><TD>            tlCxlReOrderExecutor.set(executor);</TD></TR><TR><TD CLASS="l">935</TD><TD>        }</TD></TR><TR><TD CLASS="l">936</TD><TD>        else</TD></TR><TR><TD CLASS="l">937</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">938</TD><TD>            executor.reset(p_context);</TD></TR><TR><TD CLASS="l">939</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">940</TD><TD>        return executor;</TD></TR><TR><TD CLASS="l">941</TD><TD>    }</TD></TR><TR><TD CLASS="l">942</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="30">943</A></TD><TD>    private void maybeThrow(BaseContext p_context) throws CommunicationException, SystemException,</TD></TR><TR><TD CLASS="l">944</TD><TD>            AuthorizationException, DataValidationException, TransactionFailedException,</TD></TR><TR><TD CLASS="l">945</TD><TD>            NotAcceptedException</TD></TR><TR><TD CLASS="l">946</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">947</TD><TD>        p_context.maybeThrowCommSysAuth();</TD></TR><TR CLASS="z"><TD CLASS="l">948</TD><TD>        p_context.maybeThrowException(DataValidationException.class);</TD></TR><TR CLASS="z"><TD CLASS="l">949</TD><TD>        p_context.maybeThrowException(TransactionFailedException.class);</TD></TR><TR><TD CLASS="l">950</TD><TD>        </TD></TR><TR><TD CLASS="l">951</TD><TD>        //This is a specail case handling for TPF. When TE throws the NotAccepted Exception</TD></TR><TR><TD CLASS="l">952</TD><TD>        //then we check if it is not accepted because of Server not available then we throw</TD></TR><TR><TD CLASS="l">953</TD><TD>        //System exception else we rethrow the not accepted exception as is.</TD></TR><TR CLASS="z"><TD CLASS="l">954</TD><TD>        final Throwable ex = p_context.getException();</TD></TR><TR CLASS="z"><TD CLASS="l">955</TD><TD>        if (ex != null &amp;&amp; ex.getClass() == NotAcceptedException.class)</TD></TR><TR><TD CLASS="l">956</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">957</TD><TD>            NotAcceptedException naException = (NotAcceptedException) ex; </TD></TR><TR CLASS="z"><TD CLASS="l">958</TD><TD>            if( naException.details.error == NotAcceptedCodes.SERVER_NOT_AVAILABLE)</TD></TR><TR><TD CLASS="l">959</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">960</TD><TD>                throw new SystemException(naException.details);</TD></TR><TR><TD CLASS="l">961</TD><TD>            }</TD></TR><TR><TD CLASS="l">962</TD><TD>            else</TD></TR><TR><TD CLASS="l">963</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">964</TD><TD>                throw naException;</TD></TR><TR><TD CLASS="l">965</TD><TD>            }</TD></TR><TR><TD CLASS="l">966</TD><TD>        }</TD></TR><TR><TD CLASS="l">967</TD><TD>//        p_context.maybeThrowException(NotAcceptedException.class); This is done above so no need to verify again</TD></TR><TR CLASS="z"><TD CLASS="l">968</TD><TD>        p_context.maybeThrowAsRuntimeOrError();</TD></TR><TR CLASS="z"><TD CLASS="l">969</TD><TD>    }</TD></TR><TR><TD CLASS="l">970</TD><TD> </TD></TR><TR><TD CLASS="l">971</TD><TD>    </TD></TR><TR><TD CLASS="l">972</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="20">973</A></TD><TD>    private void executeOrderRerouteWorkflow(OrderContext p_context) throws CommunicationException,</TD></TR><TR><TD CLASS="l">974</TD><TD>            SystemException, AuthorizationException, DataValidationException,</TD></TR><TR><TD CLASS="l">975</TD><TD>            TransactionFailedException, NotAcceptedException</TD></TR><TR><TD CLASS="l">976</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">977</TD><TD>        Order reRoutedOrder = p_context.getOrder();</TD></TR><TR CLASS="z"><TD CLASS="l">978</TD><TD>        short currentState = reRoutedOrder.getState();</TD></TR><TR CLASS="z"><TD CLASS="l">979</TD><TD>        short currentLocationType = reRoutedOrder.getLocationType();</TD></TR><TR><TD CLASS="l">980</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">981</TD><TD>        IWorkflowExecutor&lt;OrderContext&gt; executor = getOrderRerouteExecutor(p_context);</TD></TR><TR CLASS="z"><TD CLASS="l">982</TD><TD>        executor.autoExecute();</TD></TR><TR CLASS="z"><TD CLASS="l">983</TD><TD>        if (executor.getContext().getException() != null)</TD></TR><TR><TD CLASS="l">984</TD><TD>        {</TD></TR><TR><TD CLASS="l">985</TD><TD>            try</TD></TR><TR><TD CLASS="l">986</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">987</TD><TD>                if (p_context.inTransaction())</TD></TR><TR CLASS="z"><TD CLASS="l">988</TD><TD>                    p_context.rollbackTransaction();</TD></TR><TR><TD CLASS="l">989</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">990</TD><TD>                p_context.startTransaction();</TD></TR><TR CLASS="z"><TD CLASS="l">991</TD><TD>                reRoutedOrder.changeToState(currentState);</TD></TR><TR CLASS="z"><TD CLASS="l">992</TD><TD>                reRoutedOrder.setLocationType(currentLocationType);</TD></TR><TR CLASS="z"><TD CLASS="l">993</TD><TD>                p_context.commitTransaction();</TD></TR><TR><TD CLASS="l">994</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">995</TD><TD>            catch (Exception e)</TD></TR><TR><TD CLASS="l">996</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">997</TD><TD>                log()</TD></TR><TR><TD CLASS="l">998</TD><TD>                        .alarm(</TD></TR><TR><TD CLASS="l">999</TD><TD>                                msg()</TD></TR><TR><TD CLASS="l">1000</TD><TD>                                        .add(</TD></TR><TR><TD CLASS="l">1001</TD><TD>                                                &#34;Failed to set the State and Location Type for the Order, Order ID: &#34;)</TD></TR><TR><TD CLASS="l">1002</TD><TD>                                        .add(reRoutedOrder.getOrderIdString()));</TD></TR><TR CLASS="z"><TD CLASS="l">1003</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">1004</TD><TD>            maybeThrow(executor.getContext());</TD></TR><TR><TD CLASS="l">1005</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1006</TD><TD>        executor.reset(null);</TD></TR><TR CLASS="z"><TD CLASS="l">1007</TD><TD>    }</TD></TR><TR><TD CLASS="l">1008</TD><TD> </TD></TR><TR><TD CLASS="l">1009</TD><TD> </TD></TR><TR><TD CLASS="l">1010</TD><TD>    /*</TD></TR><TR><TD CLASS="l">1011</TD><TD>     * Execute the cancel/re WorkFlow.</TD></TR><TR><TD CLASS="l">1012</TD><TD>     */</TD></TR><TR><TD CLASS="l">1013</TD><TD>    private void executeCancelReplace(OrderRoutingParameterStruct routingParam,</TD></TR><TR><TD CLASS="l">1014</TD><TD>            CancelRequestStruct p_cancelRequest, final Order originalOrder,</TD></TR><TR><TD CLASS="l">1015</TD><TD>            OrderStruct p_replacementOrder, final Order replacementOrder,</TD></TR><TR><TD CLASS="l">1016</TD><TD>            LegOrderEntryStructV2[] p_legEntryDetails, CancelReplaceContext repOrderContext,</TD></TR><TR><TD CLASS="l">1017</TD><TD>            TradableValidationContext validationContext,</TD></TR><TR><TD CLASS="l">1018</TD><TD>            boolean reroutedCancelRe) throws TransactionFailedException, DataValidationException,</TD></TR><TR><TD CLASS="l"><A NAME="1b">1019</A></TD><TD>            SystemException, CommunicationException, AuthorizationException, NotAcceptedException</TD></TR><TR><TD CLASS="l">1020</TD><TD>    {</TD></TR><TR><TD CLASS="l">1021</TD><TD>        try</TD></TR><TR><TD CLASS="l">1022</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1023</TD><TD>            replacementOrder.setOrsId(p_replacementOrder.orsId);</TD></TR><TR><TD CLASS="l">1024</TD><TD>            </TD></TR><TR CLASS="z"><TD CLASS="l">1025</TD><TD>            if (p_cancelRequest.orderId.highCboeId == 0)</TD></TR><TR><TD CLASS="l">1026</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1027</TD><TD>                p_cancelRequest.orderId = originalOrder.getOrderId();</TD></TR><TR><TD CLASS="l">1028</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">1029</TD><TD>            if (p_replacementOrder.orderId.highCboeId == 0)</TD></TR><TR><TD CLASS="l">1030</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1031</TD><TD>                p_replacementOrder.orderId = replacementOrder.getOrderId();</TD></TR><TR><TD CLASS="l">1032</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">1033</TD><TD>            validateCancelReplace(p_cancelRequest, p_replacementOrder, p_legEntryDetails,</TD></TR><TR><TD CLASS="l">1034</TD><TD>                    originalOrder, validationContext, true);</TD></TR><TR><TD CLASS="l">1035</TD><TD>                       </TD></TR><TR CLASS="z"><TD CLASS="l">1036</TD><TD>            repOrderContext.setOrder(originalOrder);</TD></TR><TR CLASS="z"><TD CLASS="l">1037</TD><TD>            repOrderContext.setRoutingParams(routingParam);</TD></TR><TR CLASS="z"><TD CLASS="l">1038</TD><TD>            repOrderContext.setCancelRequest(p_cancelRequest);</TD></TR><TR CLASS="z"><TD CLASS="l">1039</TD><TD>            repOrderContext.setReplacementOrder(replacementOrder);</TD></TR><TR><TD CLASS="l">1040</TD><TD> </TD></TR><TR><TD CLASS="l">1041</TD><TD>            // execute cxl/re workflow</TD></TR><TR CLASS="z"><TD CLASS="l">1042</TD><TD>            if (reroutedCancelRe)</TD></TR><TR><TD CLASS="l">1043</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1044</TD><TD>                executeCxlReplaceRerouteWorkflow(repOrderContext); // TXN Committed in WF</TD></TR><TR><TD CLASS="l">1045</TD><TD>            }</TD></TR><TR><TD CLASS="l">1046</TD><TD>            else</TD></TR><TR><TD CLASS="l">1047</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1048</TD><TD>                executeCxlReplaceOrderWorkflow(repOrderContext);</TD></TR><TR><TD CLASS="l">1049</TD><TD>            }</TD></TR><TR><TD CLASS="l">1050</TD><TD>        }</TD></TR><TR><TD CLASS="l">1051</TD><TD>        finally</TD></TR><TR CLASS="z"><TD CLASS="l">1052</TD><TD>        {</TD></TR><TR><TD CLASS="l">1053</TD><TD>            //Just an empty block.</TD></TR><TR CLASS="z"><TD CLASS="l">1054</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1055</TD><TD>    }</TD></TR><TR><TD CLASS="l">1056</TD><TD> </TD></TR><TR><TD CLASS="l">1057</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1058</TD><TD>     * </TD></TR><TR><TD CLASS="l">1059</TD><TD>     * Enter an order into permanent storage and set the state as active or inactive. Should get an</TD></TR><TR><TD CLASS="l">1060</TD><TD>     * exception if duplicate order.</TD></TR><TR><TD CLASS="l">1061</TD><TD>     * </TD></TR><TR><TD CLASS="l">1062</TD><TD>     * @param orderStruct OrderStruct</TD></TR><TR><TD CLASS="l">1063</TD><TD>     * @param active boolean</TD></TR><TR><TD CLASS="l">1064</TD><TD>     * @return Order</TD></TR><TR><TD CLASS="l">1065</TD><TD>     */</TD></TR><TR><TD CLASS="l">1066</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="19">1067</A></TD><TD>    private Order createNewOrder(final OrderStruct orderStruct,</TD></TR><TR><TD CLASS="l">1068</TD><TD>            final LegOrderEntryStructV2[] legEntries, final boolean active)</TD></TR><TR><TD CLASS="l">1069</TD><TD>            throws TransactionFailedException, DataValidationException, SystemException</TD></TR><TR><TD CLASS="l">1070</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1071</TD><TD>        return createNewOrder(orderStruct, legEntries, null, null, true);</TD></TR><TR><TD CLASS="l">1072</TD><TD>    }</TD></TR><TR><TD CLASS="l">1073</TD><TD> </TD></TR><TR><TD CLASS="l">1074</TD><TD>    private Order createNewOrder(final OrderStruct orderStruct,</TD></TR><TR><TD CLASS="l">1075</TD><TD>            final LegOrderEntryStructV2[] legEntries,</TD></TR><TR><TD CLASS="l">1076</TD><TD>            final OrderHandlingInstructionStruct handlingInstruction,</TD></TR><TR><TD CLASS="l">1077</TD><TD>            PriceStruct oppositeSideBestOfRest, final boolean active)</TD></TR><TR><TD CLASS="l"><A NAME="18">1078</A></TD><TD>            throws TransactionFailedException, DataValidationException, SystemException</TD></TR><TR><TD CLASS="l">1079</TD><TD>    {</TD></TR><TR><TD CLASS="l">1080</TD><TD>        Order newOrder;</TD></TR><TR><TD CLASS="l">1081</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1082</TD><TD>        if (orderStruct.sessionNames != null &amp;&amp; orderStruct.sessionNames.length &gt; 0)</TD></TR><TR><TD CLASS="l">1083</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1084</TD><TD>            orderStruct.activeSession = orderStruct.sessionNames[0];</TD></TR><TR><TD CLASS="l">1085</TD><TD>        }</TD></TR><TR><TD CLASS="l">1086</TD><TD>        try</TD></TR><TR><TD CLASS="l">1087</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1088</TD><TD>            if (orderStruct.productType == ProductTypes.STRATEGY)</TD></TR><TR><TD CLASS="l">1089</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1090</TD><TD>                newOrder = orderHome.create(orderStruct, legEntries);</TD></TR><TR><TD CLASS="l">1091</TD><TD>            }</TD></TR><TR><TD CLASS="l">1092</TD><TD>            else</TD></TR><TR><TD CLASS="l">1093</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1094</TD><TD>                newOrder = orderHome.create(orderStruct);</TD></TR><TR><TD CLASS="l">1095</TD><TD>            }</TD></TR><TR><TD CLASS="l">1096</TD><TD> </TD></TR><TR><TD CLASS="l">1097</TD><TD>            // set the orsid, irrespective of received HI</TD></TR><TR CLASS="z"><TD CLASS="l">1098</TD><TD>            newOrder.setOrsId(orderStruct.orsId);</TD></TR><TR><TD CLASS="l">1099</TD><TD>            </TD></TR><TR><TD CLASS="l">1100</TD><TD>            // Mark STP and STP_LOSS orders that are traded on SBT as inactive initially. Order</TD></TR><TR><TD CLASS="l">1101</TD><TD>            // will be made active when stop condition is met. Stop condition will be checked when</TD></TR><TR><TD CLASS="l">1102</TD><TD>            // order is processed by Broker.</TD></TR><TR CLASS="z"><TD CLASS="l">1103</TD><TD>            if (handlingInstruction != null)</TD></TR><TR><TD CLASS="l">1104</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1105</TD><TD>                updateOrderWithHandlingInstruction(orderStruct, newOrder, handlingInstruction,</TD></TR><TR><TD CLASS="l">1106</TD><TD>                        oppositeSideBestOfRest, false);</TD></TR><TR><TD CLASS="l">1107</TD><TD>            }</TD></TR><TR><TD CLASS="l">1108</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1109</TD><TD>        catch (final SystemException e)</TD></TR><TR><TD CLASS="l">1110</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1111</TD><TD>            log().alarm(</TD></TR><TR><TD CLASS="l">1112</TD><TD>                    msg().add(&#34;Creating order failed (orderStruct dump sent to stdout) &#34;).add(e));</TD></TR><TR CLASS="z"><TD CLASS="l">1113</TD><TD>            ReflectiveObjectWriter.writeObject(orderStruct, &#34;(failed/SystemException)OrderStruct&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1114</TD><TD>            throw ExceptionBuilder.systemException(&#34;Unable to get OrderHome: &#34;,</TD></TR><TR><TD CLASS="l">1115</TD><TD>                    TransactionFailedCodes.CREATE_FAILED);</TD></TR><TR><TD CLASS="l">1116</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1117</TD><TD>        catch (final DataValidationException e)</TD></TR><TR><TD CLASS="l">1118</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1119</TD><TD>            log()</TD></TR><TR><TD CLASS="l">1120</TD><TD>                    .alarm(</TD></TR><TR><TD CLASS="l">1121</TD><TD>                            msg().add(&#34;Creating order failed (orderStruct dump sent to stdout)&#34;)</TD></TR><TR><TD CLASS="l">1122</TD><TD>                                    .add(e));</TD></TR><TR CLASS="z"><TD CLASS="l">1123</TD><TD>            ReflectiveObjectWriter.writeObject(orderStruct,</TD></TR><TR><TD CLASS="l">1124</TD><TD>                    &#34;(failed/TransactionFailedException)OrderStruct&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1125</TD><TD>            throw e;</TD></TR><TR><TD CLASS="l">1126</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1127</TD><TD>        catch (final TransactionFailedException pe)</TD></TR><TR><TD CLASS="l">1128</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1129</TD><TD>            log().alarm(</TD></TR><TR><TD CLASS="l">1130</TD><TD>                    msg().add(&#34;Creating order failed (orderStruct dump sent to stdout)&#34;).add(pe));</TD></TR><TR CLASS="z"><TD CLASS="l">1131</TD><TD>            ReflectiveObjectWriter.writeObject(orderStruct,</TD></TR><TR><TD CLASS="l">1132</TD><TD>                    &#34;(failed/TransactionFailedException)OrderStruct&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1133</TD><TD>            throw ExceptionBuilder.transactionFailedException(msg().add(</TD></TR><TR><TD CLASS="l">1134</TD><TD>                    &#34;TransactionFailedException for&#34;).add(&#34;orderId&#34;, orderStruct.orderId).end(),</TD></TR><TR><TD CLASS="l">1135</TD><TD>                    TransactionFailedCodes.CREATE_FAILED);</TD></TR><TR><TD CLASS="l">1136</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1137</TD><TD>        catch (final DuplicateOrderIDException de)</TD></TR><TR><TD CLASS="l">1138</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1139</TD><TD>            log().alarm(</TD></TR><TR><TD CLASS="l">1140</TD><TD>                    msg().add(&#34;Creating order failed (orderStruct dump sent to stdout)&#34;).add(de));</TD></TR><TR CLASS="z"><TD CLASS="l">1141</TD><TD>            ReflectiveObjectWriter.writeObject(orderStruct,</TD></TR><TR><TD CLASS="l">1142</TD><TD>                    &#34;(failed/DuplicateOrderIDException)OrderStruct&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1143</TD><TD>            throw ExceptionBuilder.dataValidationException(msg().add(</TD></TR><TR><TD CLASS="l">1144</TD><TD>                    &#34;DuplicateOrderID.  Unable to create new order: &#34;).add(&#34;orderId&#34;,</TD></TR><TR><TD CLASS="l">1145</TD><TD>                    orderStruct.orderId).end(), DataValidationCodes.DUPLICATE_ID);</TD></TR><TR><TD CLASS="l">1146</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1147</TD><TD>        catch (final Exception e)</TD></TR><TR><TD CLASS="l">1148</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1149</TD><TD>            log()</TD></TR><TR><TD CLASS="l">1150</TD><TD>                    .alarm(</TD></TR><TR><TD CLASS="l">1151</TD><TD>                            msg().add(&#34;Creating order faided (orderStruct dump sent to stdout)&#34;)</TD></TR><TR><TD CLASS="l">1152</TD><TD>                                    .add(e));</TD></TR><TR CLASS="z"><TD CLASS="l">1153</TD><TD>            ReflectiveObjectWriter.writeObject(orderStruct, &#34;(failed/Exception)OrderStruct&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1154</TD><TD>            throw ExceptionBuilder.systemException(msg().add(&#34;Internal error:&#34;).add(e, true).add(</TD></TR><TR><TD CLASS="l">1155</TD><TD>                    &#34;  Unable to create new order: &#34;).add(&#34;orderId&#34;, orderStruct.orderId).end(), 0);</TD></TR><TR CLASS="z"><TD CLASS="l">1156</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1157</TD><TD>        return newOrder;</TD></TR><TR><TD CLASS="l">1158</TD><TD>    }</TD></TR><TR><TD CLASS="l">1159</TD><TD> </TD></TR><TR><TD CLASS="l">1160</TD><TD> </TD></TR><TR><TD CLASS="l">1161</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1162</TD><TD>     * Try to find the order. If the order exists, the certain values of the OrderStruct will have</TD></TR><TR><TD CLASS="l">1163</TD><TD>     * to be modified, because when order routed back from TPF, the followinig attributes are</TD></TR><TR><TD CLASS="l">1164</TD><TD>     * defaulted to a default value. The original values will be lost if not updated.</TD></TR><TR><TD CLASS="l">1165</TD><TD>     * </TD></TR><TR><TD CLASS="l">1166</TD><TD>     * 1. source 2. userid 3. userAcronym 4. executingOrGiveupFirm 5. originator</TD></TR><TR><TD CLASS="l"><A NAME="22">1167</A></TD><TD>     * @throws DataValidationException </TD></TR><TR><TD CLASS="l">1168</TD><TD>     */</TD></TR><TR><TD CLASS="l">1169</TD><TD>    private Order findOrderAndCheckSource(OrderStruct orderStruct) throws DataValidationException</TD></TR><TR><TD CLASS="l">1170</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1171</TD><TD>        Order order = null;</TD></TR><TR><TD CLASS="l">1172</TD><TD>        try</TD></TR><TR><TD CLASS="l">1173</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1174</TD><TD>            order =  orderHome.findOrder(orderStruct.orderId, false); //do not log Alarm this might be a order created &#34;away&#34;</TD></TR><TR CLASS="z"><TD CLASS="l">1175</TD><TD>            orderStruct.source = order.getSource();</TD></TR><TR CLASS="z"><TD CLASS="l">1176</TD><TD>            orderStruct.userId = order.getUserId();</TD></TR><TR CLASS="z"><TD CLASS="l">1177</TD><TD>            orderStruct.userAcronym = order.getUserAcronym();</TD></TR><TR CLASS="z"><TD CLASS="l">1178</TD><TD>            orderStruct.orderId.executingOrGiveUpFirm = order.getExecutingOrGiveUpFirmStruct();</TD></TR><TR CLASS="z"><TD CLASS="l">1179</TD><TD>            orderStruct.originator = order.getOriginatorAcronym();</TD></TR><TR><TD CLASS="l">1180</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1181</TD><TD>        catch (final NotFoundException e)</TD></TR><TR><TD CLASS="l">1182</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1183</TD><TD>            return null;</TD></TR><TR><TD CLASS="l">1184</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1185</TD><TD>        catch (final DuplicateOrderIDException e)</TD></TR><TR><TD CLASS="l">1186</TD><TD>        { </TD></TR><TR><TD CLASS="l">1187</TD><TD>            //   this should never happen if the DB schema is correct</TD></TR><TR CLASS="z"><TD CLASS="l">1188</TD><TD>            MsgBuilder msg = msg().add(&#34;orderId&#34;, order).add(&#34;not found&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1189</TD><TD>            log().alarm(msg().add(&#34;duplicate OrderId found, change DB config! &#34;).add(msg));</TD></TR><TR CLASS="z"><TD CLASS="l">1190</TD><TD>            throw ExceptionBuilder.dataValidationException(msg.end(),</TD></TR><TR><TD CLASS="l">1191</TD><TD>                    DataValidationCodes.DUPLICATE_ID);</TD></TR><TR><TD CLASS="l">1192</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1193</TD><TD>        catch (TransactionFailedException e)</TD></TR><TR><TD CLASS="l">1194</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1195</TD><TD>            return null;</TD></TR><TR CLASS="z"><TD CLASS="l">1196</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1197</TD><TD>        return order;</TD></TR><TR><TD CLASS="l">1198</TD><TD>    }</TD></TR><TR><TD CLASS="l">1199</TD><TD> </TD></TR><TR><TD CLASS="l">1200</TD><TD> </TD></TR><TR><TD CLASS="l">1201</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1202</TD><TD>     * Validate the order and instruction</TD></TR><TR><TD CLASS="l">1203</TD><TD>     */</TD></TR><TR><TD CLASS="l"><A NAME="41">1204</A></TD><TD>    private void validateOrder(OrderStruct anOrderStruct,</TD></TR><TR><TD CLASS="l">1205</TD><TD>            OrderHandlingInstructionStruct handlingInstruction) throws DataValidationException,</TD></TR><TR><TD CLASS="l">1206</TD><TD>            AuthorizationException, CommunicationException, SystemException</TD></TR><TR><TD CLASS="l">1207</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1208</TD><TD>        if (anOrderStruct.sessionNames.length != 1)</TD></TR><TR><TD CLASS="l">1209</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1210</TD><TD>            throw ExceptionBuilder.dataValidationException(</TD></TR><TR><TD CLASS="l">1211</TD><TD>                    &#34;Only one session name currently allowed on orders&#34;,</TD></TR><TR><TD CLASS="l">1212</TD><TD>                    DataValidationCodes.INVALID_SESSION);</TD></TR><TR><TD CLASS="l">1213</TD><TD>        }</TD></TR><TR><TD CLASS="l">1214</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1215</TD><TD>        anOrderStruct.activeSession = anOrderStruct.sessionNames[0];</TD></TR><TR><TD CLASS="l">1216</TD><TD> </TD></TR><TR><TD CLASS="l">1217</TD><TD>        // will use the internal as the session name to get the internal strategy other than the cmi</TD></TR><TR><TD CLASS="l">1218</TD><TD>        // incoming validation strategy</TD></TR><TR CLASS="z"><TD CLASS="l">1219</TD><TD>        OrderValidationStrategy strategy = getOrderValidationStrategy(HYBRID_INTERNAL);</TD></TR><TR><TD CLASS="l">1220</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1221</TD><TD>        if (handlingInstruction == null)</TD></TR><TR><TD CLASS="l">1222</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1223</TD><TD>            strategy.validateOrder(anOrderStruct, false); // false indicates zero qantity order is</TD></TR><TR><TD CLASS="l">1224</TD><TD>                                                            // not allowed</TD></TR><TR><TD CLASS="l">1225</TD><TD>        }</TD></TR><TR><TD CLASS="l">1226</TD><TD>        else</TD></TR><TR><TD CLASS="l">1227</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1228</TD><TD>            strategy.validateOrder(anOrderStruct, false, handlingInstruction);</TD></TR><TR><TD CLASS="l">1229</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1230</TD><TD>    }</TD></TR><TR><TD CLASS="l">1231</TD><TD> </TD></TR><TR><TD CLASS="l">1232</TD><TD>    </TD></TR><TR><TD CLASS="l">1233</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1234</TD><TD>     * Validate the strategy order</TD></TR><TR><TD CLASS="l">1235</TD><TD>     */</TD></TR><TR><TD CLASS="l">1236</TD><TD>    private void validateStrategyOrder(OrderStruct anOrderStruct,</TD></TR><TR><TD CLASS="l">1237</TD><TD>            LegOrderEntryStructV2[] legEntryDetails, </TD></TR><TR><TD CLASS="l">1238</TD><TD>            OrderHandlingInstructionStruct instruction,</TD></TR><TR><TD CLASS="l"><A NAME="45">1239</A></TD><TD>            TradableValidationContext validationContext)</TD></TR><TR><TD CLASS="l">1240</TD><TD>            throws DataValidationException, AuthorizationException, CommunicationException,</TD></TR><TR><TD CLASS="l">1241</TD><TD>            SystemException</TD></TR><TR><TD CLASS="l">1242</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1243</TD><TD>        if (anOrderStruct.sessionNames.length != 1)</TD></TR><TR><TD CLASS="l">1244</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1245</TD><TD>            throw ExceptionBuilder.dataValidationException(</TD></TR><TR><TD CLASS="l">1246</TD><TD>                    &#34;Only one session name currently allowed on orders&#34;,</TD></TR><TR><TD CLASS="l">1247</TD><TD>                    DataValidationCodes.INVALID_SESSION);</TD></TR><TR><TD CLASS="l">1248</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1249</TD><TD>        anOrderStruct.activeSession = anOrderStruct.sessionNames[0];</TD></TR><TR CLASS="z"><TD CLASS="l">1250</TD><TD>        OrderValidationStrategy strategy = getOrderValidationStrategy(HYBRID_INTERNAL);</TD></TR><TR><TD CLASS="l">1251</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">1252</TD><TD>        tradableValidationService.checkAndSetDefaultLegClearingFirms(anOrderStruct, legEntryDetails, validationContext);</TD></TR><TR><TD CLASS="l">1253</TD><TD>        try</TD></TR><TR><TD CLASS="l">1254</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1255</TD><TD>            strategy.validateStrategyOrder(anOrderStruct, false, legEntryDetails, instruction, validationContext);</TD></TR><TR><TD CLASS="l">1256</TD><TD>        }</TD></TR><TR><TD CLASS="l">1257</TD><TD>        finally</TD></TR><TR><TD CLASS="l">1258</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1259</TD><TD>            tradableValidationService.verifyDefaultLegClearingFirms(legEntryDetails, validationContext);</TD></TR><TR CLASS="z"><TD CLASS="l">1260</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1261</TD><TD>    }</TD></TR><TR><TD CLASS="l">1262</TD><TD> </TD></TR><TR><TD CLASS="l">1263</TD><TD>    private OrderIdStruct executeOrderWithInstructions(OrderStruct p_anOrder, LegOrderEntryStructV2[] legEntryDetails, Order foundOrder,</TD></TR><TR><TD CLASS="l">1264</TD><TD>            OrderHandlingInstructionStruct p_handlingInstruction,</TD></TR><TR><TD CLASS="l">1265</TD><TD>            PriceStruct p_oppositeSideBestOfRest) throws CommunicationException, SystemException,</TD></TR><TR><TD CLASS="l"><A NAME="21">1266</A></TD><TD>            AuthorizationException, DataValidationException, TransactionFailedException,</TD></TR><TR><TD CLASS="l">1267</TD><TD>            NotAcceptedException</TD></TR><TR><TD CLASS="l">1268</TD><TD>    {</TD></TR><TR><TD CLASS="l">1269</TD><TD>        OrderIdStruct orderId;</TD></TR><TR CLASS="z"><TD CLASS="l">1270</TD><TD>        OrderContext context = new OrderContext();</TD></TR><TR><TD CLASS="l">1271</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1272</TD><TD>        if (foundOrder == null)</TD></TR><TR><TD CLASS="l">1273</TD><TD>        {</TD></TR><TR><TD CLASS="l">1274</TD><TD>            try</TD></TR><TR><TD CLASS="l">1275</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1276</TD><TD>                context.startTransaction();</TD></TR><TR><TD CLASS="l">1277</TD><TD>                </TD></TR><TR><TD CLASS="l">1278</TD><TD>                // execute new order WF</TD></TR><TR CLASS="z"><TD CLASS="l">1279</TD><TD>                foundOrder = createNewOrder(p_anOrder, legEntryDetails, p_handlingInstruction,</TD></TR><TR><TD CLASS="l">1280</TD><TD>                        p_oppositeSideBestOfRest, true);</TD></TR><TR CLASS="z"><TD CLASS="l">1281</TD><TD>                if (log().isDebugOn())</TD></TR><TR><TD CLASS="l">1282</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">1283</TD><TD>                    log().debug(msg().add(&#34;order&#34;, p_anOrder.orderId).add(&#34;created successfully&#34;));</TD></TR><TR><TD CLASS="l">1284</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1285</TD><TD>                context.setOrder(foundOrder);</TD></TR><TR><TD CLASS="l">1286</TD><TD> </TD></TR><TR><TD CLASS="l">1287</TD><TD>                // context.getOrder().getLock().lock();</TD></TR><TR CLASS="z"><TD CLASS="l">1288</TD><TD>                context.setRoutingParams(TPF_UNKNOWN_ROUTING_PARAM);</TD></TR><TR><TD CLASS="l">1289</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1290</TD><TD>                executeNewOrderWorkflow(context);</TD></TR><TR><TD CLASS="l">1291</TD><TD>            }</TD></TR><TR><TD CLASS="l">1292</TD><TD>            finally</TD></TR><TR><TD CLASS="l">1293</TD><TD>            {</TD></TR><TR><TD CLASS="l">1294</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1295</TD><TD>                if (context.inTransaction())</TD></TR><TR><TD CLASS="l">1296</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">1297</TD><TD>                    log()</TD></TR><TR><TD CLASS="l">1298</TD><TD>                            .alarm(</TD></TR><TR><TD CLASS="l">1299</TD><TD>                                    msg()</TD></TR><TR><TD CLASS="l">1300</TD><TD>                                            .add(</TD></TR><TR><TD CLASS="l">1301</TD><TD>                                                    &#34;Still in transaction after createOrder [from TPF] workflow - rollback&#34;));</TD></TR><TR CLASS="z"><TD CLASS="l">1302</TD><TD>                    context.rollbackTransaction();</TD></TR><TR><TD CLASS="l">1303</TD><TD>                }</TD></TR><TR><TD CLASS="l">1304</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">1305</TD><TD>            orderId = context.getOrder().getOrderId();</TD></TR><TR><TD CLASS="l">1306</TD><TD>        }</TD></TR><TR><TD CLASS="l">1307</TD><TD>        else</TD></TR><TR><TD CLASS="l">1308</TD><TD>        {</TD></TR><TR><TD CLASS="l">1309</TD><TD>            try</TD></TR><TR><TD CLASS="l">1310</TD><TD>            {</TD></TR><TR><TD CLASS="l">1311</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1312</TD><TD>                context.startTransaction();</TD></TR><TR><TD CLASS="l">1313</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1314</TD><TD>                if (p_anOrder.orderId.highCboeId == 0)</TD></TR><TR><TD CLASS="l">1315</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">1316</TD><TD>                    p_anOrder.orderId = foundOrder.getOrderId();</TD></TR><TR><TD CLASS="l">1317</TD><TD>                }</TD></TR><TR><TD CLASS="l">1318</TD><TD> </TD></TR><TR><TD CLASS="l">1319</TD><TD>                // Order exists just update the values...</TD></TR><TR CLASS="z"><TD CLASS="l">1320</TD><TD>                if (!foundOrder.hasRoutedAway())</TD></TR><TR><TD CLASS="l">1321</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">1322</TD><TD>                    MsgBuilder msg = </TD></TR><TR><TD CLASS="l">1323</TD><TD>                        msg().add(&#34;Could not accept order which is already in CBOEDirect: &#34;,</TD></TR><TR><TD CLASS="l">1324</TD><TD>                            foundOrder.orderIdToString());</TD></TR><TR CLASS="z"><TD CLASS="l">1325</TD><TD>                    log().alarm(msg);</TD></TR><TR CLASS="z"><TD CLASS="l">1326</TD><TD>                    throw ExceptionBuilder.dataValidationException(msg.end(),</TD></TR><TR><TD CLASS="l">1327</TD><TD>                            DataValidationCodes.INVALID_ORDER_STATE);</TD></TR><TR><TD CLASS="l">1328</TD><TD>                }</TD></TR><TR><TD CLASS="l">1329</TD><TD>                </TD></TR><TR><TD CLASS="l">1330</TD><TD>                // Now route Order as New to TE...</TD></TR><TR CLASS="z"><TD CLASS="l">1331</TD><TD>                context.setRoutingParams(TPF_UNKNOWN_ROUTING_PARAM);</TD></TR><TR><TD CLASS="l">1332</TD><TD> </TD></TR><TR><TD CLASS="l">1333</TD><TD>                // Mark STP and STP_LOSS orders that are traded on SBT as inactive initially. Order</TD></TR><TR><TD CLASS="l">1334</TD><TD>                // will be made active when stop condition is met. Stop condition will be checked</TD></TR><TR><TD CLASS="l">1335</TD><TD>                // when</TD></TR><TR><TD CLASS="l">1336</TD><TD>                // order is processed by Broker. Need to set HI before passing to ORD...</TD></TR><TR CLASS="z"><TD CLASS="l">1337</TD><TD>                updateOrderWithHandlingInstruction(p_anOrder, foundOrder, p_handlingInstruction,</TD></TR><TR><TD CLASS="l">1338</TD><TD>                        p_oppositeSideBestOfRest, true);</TD></TR><TR CLASS="z"><TD CLASS="l">1339</TD><TD>                context.setOrder(foundOrder);</TD></TR><TR CLASS="z"><TD CLASS="l">1340</TD><TD>                executeOrderRerouteWorkflow(context); // TXN committed in WFStepOrder...</TD></TR><TR><TD CLASS="l">1341</TD><TD>            }</TD></TR><TR><TD CLASS="l">1342</TD><TD>            finally</TD></TR><TR><TD CLASS="l">1343</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1344</TD><TD>                if (context.inTransaction())</TD></TR><TR><TD CLASS="l">1345</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">1346</TD><TD>                    log().alarm(msg().add(&#34;Still in transaction after reroute: rolling back&#34;));</TD></TR><TR CLASS="z"><TD CLASS="l">1347</TD><TD>                    context.rollbackTransaction();</TD></TR><TR><TD CLASS="l">1348</TD><TD>                }</TD></TR><TR><TD CLASS="l">1349</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">1350</TD><TD>            orderId = foundOrder.getOrderId();</TD></TR><TR><TD CLASS="l">1351</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1352</TD><TD>        return orderId;</TD></TR><TR><TD CLASS="l">1353</TD><TD>    }</TD></TR><TR><TD CLASS="l">1354</TD><TD> </TD></TR><TR><TD CLASS="l">1355</TD><TD> </TD></TR><TR><TD CLASS="l">1356</TD><TD> </TD></TR><TR><TD CLASS="l">1357</TD><TD>    private void validateCancelReplace(CancelRequestStruct p_cancelRequest,</TD></TR><TR><TD CLASS="l">1358</TD><TD>            OrderStruct p_replacementOrder, LegOrderEntryStructV2[] p_legEntryDetails,</TD></TR><TR><TD CLASS="l">1359</TD><TD>            Order originalOrder, TradableValidationContext validationContext,</TD></TR><TR><TD CLASS="l"><A NAME="3f">1360</A></TD><TD>            boolean rebuildLegDetails)</TD></TR><TR><TD CLASS="l">1361</TD><TD>    throws NotAcceptedException, DataValidationException, AuthorizationException,</TD></TR><TR><TD CLASS="l">1362</TD><TD>           CommunicationException, SystemException</TD></TR><TR><TD CLASS="l">1363</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1364</TD><TD>        if (p_cancelRequest.quantity &lt; 0</TD></TR><TR><TD CLASS="l">1365</TD><TD>                || ((p_cancelRequest.cancelType == OrderCancelTypes.DESIRED_CANCEL_QUANTITY) &amp;&amp; (p_cancelRequest.quantity == 0)))</TD></TR><TR><TD CLASS="l">1366</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1367</TD><TD>            MsgBuilder msg = msg().add(&#34;Cannot cancel order. Specified quantity&#34;,</TD></TR><TR><TD CLASS="l">1368</TD><TD>                    p_cancelRequest.quantity).add(&#34;:cancelType &#34;, p_cancelRequest.cancelType).add(</TD></TR><TR><TD CLASS="l">1369</TD><TD>                    &#34; is not correct&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1370</TD><TD>            log().alarm(msg);</TD></TR><TR CLASS="z"><TD CLASS="l">1371</TD><TD>            throw ExceptionBuilder.notAcceptedException(msg().end(),</TD></TR><TR><TD CLASS="l">1372</TD><TD>                    NotAcceptedCodes.INVALID_REQUEST);</TD></TR><TR><TD CLASS="l">1373</TD><TD>        }</TD></TR><TR><TD CLASS="l">1374</TD><TD> </TD></TR><TR><TD CLASS="l">1375</TD><TD>        // Update replaced orders leg details with leg entries ...</TD></TR><TR CLASS="z"><TD CLASS="l">1376</TD><TD>        if (p_legEntryDetails != null)</TD></TR><TR><TD CLASS="l">1377</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1378</TD><TD>            validateStrategyOrder(p_replacementOrder, p_legEntryDetails, null, validationContext);</TD></TR><TR><TD CLASS="l">1379</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1380</TD><TD>            if (rebuildLegDetails)</TD></TR><TR><TD CLASS="l">1381</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1382</TD><TD>            final LegOrderDetailStruct[] detailStructs = new LegOrderDetailStruct[p_legEntryDetails.length];</TD></TR><TR CLASS="z"><TD CLASS="l">1383</TD><TD>            for (int i = 0; i &lt; p_legEntryDetails.length; i++)</TD></TR><TR><TD CLASS="l">1384</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1385</TD><TD>                detailStructs[i] = buildLegDetailBasedOnNewValue(originalOrder,</TD></TR><TR><TD CLASS="l">1386</TD><TD>                        p_legEntryDetails[i]);</TD></TR><TR><TD CLASS="l">1387</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">1388</TD><TD>            p_replacementOrder.legOrderDetails = detailStructs;</TD></TR><TR><TD CLASS="l">1389</TD><TD>            }</TD></TR><TR><TD CLASS="l">1390</TD><TD>        }</TD></TR><TR><TD CLASS="l">1391</TD><TD>//        else</TD></TR><TR><TD CLASS="l">1392</TD><TD>//        {</TD></TR><TR><TD CLASS="l">1393</TD><TD>//            validateOrder(p_replacementOrder, null);</TD></TR><TR><TD CLASS="l">1394</TD><TD>//        }</TD></TR><TR><TD CLASS="l">1395</TD><TD>        </TD></TR><TR><TD CLASS="l">1396</TD><TD>        // If Firm Order throw an exception</TD></TR><TR CLASS="z"><TD CLASS="l">1397</TD><TD>        if (originalOrder.isFirmMatchOrder())</TD></TR><TR><TD CLASS="l">1398</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1399</TD><TD>            throw ExceptionBuilder.notAcceptedException(</TD></TR><TR><TD CLASS="l">1400</TD><TD>                    &#34;CancelReplace Request for Match Side of Internalized Orders are not allowed. Order ID =&#34;</TD></TR><TR><TD CLASS="l">1401</TD><TD>                            + originalOrder.orderIdToString(), NotAcceptedCodes.INVALID_REQUEST);</TD></TR><TR><TD CLASS="l">1402</TD><TD>        }</TD></TR><TR><TD CLASS="l">1403</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1404</TD><TD>    }</TD></TR><TR><TD CLASS="l">1405</TD><TD> </TD></TR><TR><TD CLASS="l">1406</TD><TD> </TD></TR><TR><TD CLASS="l">1407</TD><TD>    /*</TD></TR><TR><TD CLASS="l">1408</TD><TD>     * Once Order had been added to database, then update order with HandlingInstruction.</TD></TR><TR><TD CLASS="l">1409</TD><TD>     */</TD></TR><TR><TD CLASS="l"><A NAME="3d">1410</A></TD><TD>    private void updateOrderWithHandlingInstruction(OrderStruct anOrder, Order order,</TD></TR><TR><TD CLASS="l">1411</TD><TD>            OrderHandlingInstructionStruct handlingInstruction, PriceStruct oppositeSideBOTR,</TD></TR><TR><TD CLASS="l">1412</TD><TD>            boolean updateOrder)</TD></TR><TR><TD CLASS="l">1413</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1414</TD><TD>        if (handlingInstruction != null)</TD></TR><TR><TD CLASS="l">1415</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1416</TD><TD>            HandlingInstruction instruction = new OrderHandlingInstructionImpl();</TD></TR><TR><TD CLASS="l">1417</TD><TD>            ;</TD></TR><TR CLASS="z"><TD CLASS="l">1418</TD><TD>            instruction.updateFrom(handlingInstruction, oppositeSideBOTR, order</TD></TR><TR><TD CLASS="l">1419</TD><TD>                    .getOriginalQuantity());</TD></TR><TR><TD CLASS="l">1420</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1421</TD><TD>            if (updateOrder)</TD></TR><TR><TD CLASS="l">1422</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1423</TD><TD>                order.setExtensions(getExtensions(anOrder.extensions, order.getExtensions()));</TD></TR><TR CLASS="z"><TD CLASS="l">1424</TD><TD>                order.setQuantity(anOrder.originalQuantity, false); // false: quantity change not</TD></TR><TR><TD CLASS="l">1425</TD><TD>                                                                    // due to price adjustment</TD></TR><TR CLASS="z"><TD CLASS="l">1426</TD><TD>                Price newPrice = PriceFactory.create(anOrder.price);</TD></TR><TR CLASS="z"><TD CLASS="l">1427</TD><TD>                if (!newPrice.equals(order.getPrice()))</TD></TR><TR><TD CLASS="l">1428</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">1429</TD><TD>                    order.setAdjustedPrice(newPrice);</TD></TR><TR><TD CLASS="l">1430</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1431</TD><TD>                order.setOrsId(anOrder.orsId);</TD></TR><TR><TD CLASS="l">1432</TD><TD>            }</TD></TR><TR><TD CLASS="l">1433</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1434</TD><TD>            order.setHandlingInstruction(instruction);</TD></TR><TR CLASS="z"><TD CLASS="l">1435</TD><TD>            order.setOrderHandlingInstruction(instruction.toPersistenceString());</TD></TR><TR><TD CLASS="l">1436</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1437</TD><TD>    }</TD></TR><TR><TD CLASS="l">1438</TD><TD> </TD></TR><TR><TD CLASS="l">1439</TD><TD> </TD></TR><TR><TD CLASS="l">1440</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1441</TD><TD>     * Return appropriate order validation strategy</TD></TR><TR><TD CLASS="l">1442</TD><TD>     * </TD></TR><TR><TD CLASS="l">1443</TD><TD>     * @throws DataValidationException</TD></TR><TR><TD CLASS="l"><A NAME="2a">1444</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">1445</TD><TD>    private OrderValidationStrategy getOrderValidationStrategy(String sessionName)</TD></TR><TR><TD CLASS="l">1446</TD><TD>            throws DataValidationException</TD></TR><TR><TD CLASS="l">1447</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1448</TD><TD>        OrderValidationStrategy strategy = null;</TD></TR><TR><TD CLASS="l">1449</TD><TD>        try</TD></TR><TR><TD CLASS="l">1450</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1451</TD><TD>            strategy = orderValidationStrategyHome.find(sessionName);</TD></TR><TR><TD CLASS="l">1452</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1453</TD><TD>        catch (Exception e)</TD></TR><TR><TD CLASS="l">1454</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1455</TD><TD>            MsgBuilder msg = msg().add(&#34;No strategy was found to validate order &#34;).add(&#34;session&#34;,</TD></TR><TR><TD CLASS="l">1456</TD><TD>                    sessionName).add(e);</TD></TR><TR CLASS="z"><TD CLASS="l">1457</TD><TD>            throw ExceptionBuilder.dataValidationException(msg.end(),</TD></TR><TR><TD CLASS="l">1458</TD><TD>                    DataValidationCodes.INVALID_SESSION);</TD></TR><TR CLASS="z"><TD CLASS="l">1459</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1460</TD><TD>        return strategy;</TD></TR><TR><TD CLASS="l">1461</TD><TD>    }</TD></TR><TR><TD CLASS="l">1462</TD><TD> </TD></TR><TR><TD CLASS="l">1463</TD><TD>    /*</TD></TR><TR><TD CLASS="l">1464</TD><TD>     * Below code pulled from OT3 done in Broker command on order update...</TD></TR><TR><TD CLASS="l">1465</TD><TD>     */</TD></TR><TR><TD CLASS="l">1466</TD><TD>    private String getExtensions(String newExtensions, String oldExtensions)</TD></TR><TR><TD CLASS="l"><A NAME="27">1467</A></TD><TD>    {</TD></TR><TR><TD CLASS="l">1468</TD><TD>        // newExtensions are from TPF Adapter</TD></TR><TR><TD CLASS="l">1469</TD><TD>        // oldExtensions are from original order</TD></TR><TR><TD CLASS="l">1470</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1471</TD><TD>        if (!isPdpmExtension(newExtensions))</TD></TR><TR CLASS="z"><TD CLASS="l">1472</TD><TD>            return oldExtensions;</TD></TR><TR><TD CLASS="l">1473</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1474</TD><TD>        if (isEmpty(oldExtensions))</TD></TR><TR CLASS="z"><TD CLASS="l">1475</TD><TD>            return newExtensions;</TD></TR><TR><TD CLASS="l">1476</TD><TD> </TD></TR><TR><TD CLASS="l">1477</TD><TD>        // New Extensions &amp; Old extensions both contain PDPM data that may need to be combined</TD></TR><TR CLASS="z"><TD CLASS="l">1478</TD><TD>        if (isPdpmExtension(oldExtensions))</TD></TR><TR CLASS="z"><TD CLASS="l">1479</TD><TD>            return mergedExtensions(newExtensions, oldExtensions);</TD></TR><TR><TD CLASS="l">1480</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1481</TD><TD>        return newExtensions + ExtensionsHelper.DEFAULT_FIELD_DELIMITER + oldExtensions;</TD></TR><TR><TD CLASS="l">1482</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="32">1483</A></TD><TD> </TD></TR><TR><TD CLASS="l">1484</TD><TD> </TD></TR><TR><TD CLASS="l">1485</TD><TD>    private String mergedExtensions(String newExtensions, String oldExtensions)</TD></TR><TR><TD CLASS="l">1486</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1487</TD><TD>        StringBuffer extensionBuffer = new StringBuffer();</TD></TR><TR CLASS="z"><TD CLASS="l">1488</TD><TD>        Map&lt;String, String&gt; pdpmMap = new HashMap&lt;String, String&gt;();</TD></TR><TR><TD CLASS="l">1489</TD><TD> </TD></TR><TR><TD CLASS="l">1490</TD><TD>        // Strip Pdpm from newExtensions &amp; oldExtensions</TD></TR><TR CLASS="z"><TD CLASS="l">1491</TD><TD>        extensionBuffer.append(mergeExtension(pdpmMap, oldExtensions, false));</TD></TR><TR CLASS="z"><TD CLASS="l">1492</TD><TD>        extensionBuffer.append(mergeExtension(pdpmMap, newExtensions, true));</TD></TR><TR><TD CLASS="l">1493</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1494</TD><TD>        StringBuffer pdpmExtensionBuffer = new StringBuffer();</TD></TR><TR><TD CLASS="l">1495</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1496</TD><TD>        Iterator it = pdpmMap.keySet().iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">1497</TD><TD>        while (it.hasNext())</TD></TR><TR><TD CLASS="l">1498</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1499</TD><TD>            String pdpm = (String) it.next();</TD></TR><TR CLASS="z"><TD CLASS="l">1500</TD><TD>            pdpmExtensionBuffer.append(pdpm);</TD></TR><TR CLASS="z"><TD CLASS="l">1501</TD><TD>        }</TD></TR><TR><TD CLASS="l">1502</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1503</TD><TD>        extensionBuffer.append(PDPM_EXT);</TD></TR><TR CLASS="z"><TD CLASS="l">1504</TD><TD>        String pdpm = pdpmExtensionBuffer.toString();</TD></TR><TR CLASS="z"><TD CLASS="l">1505</TD><TD>        if (pdpm.length() &gt; 15)</TD></TR><TR CLASS="z"><TD CLASS="l">1506</TD><TD>            extensionBuffer.append(pdpm.substring(0, 15));</TD></TR><TR><TD CLASS="l">1507</TD><TD>        else</TD></TR><TR CLASS="z"><TD CLASS="l">1508</TD><TD>            extensionBuffer.append(pdpm);</TD></TR><TR><TD CLASS="l">1509</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1510</TD><TD>        return extensionBuffer.toString();</TD></TR><TR><TD CLASS="l"><A NAME="31">1511</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1512</TD><TD> </TD></TR><TR><TD CLASS="l">1513</TD><TD>    private String mergeExtension(Map&lt;String, String&gt; pdpmMap, String extension, boolean isNew)</TD></TR><TR><TD CLASS="l">1514</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1515</TD><TD>        String[] extTable = extension.split(ExtensionsHelper.DEFAULT_FIELD_DELIMITER);</TD></TR><TR><TD CLASS="l">1516</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1517</TD><TD>        StringBuffer extensionBuffer = new StringBuffer();</TD></TR><TR CLASS="z"><TD CLASS="l">1518</TD><TD>        extensionBuffer.append(&#34;&#34;);</TD></TR><TR><TD CLASS="l">1519</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1520</TD><TD>        for (int i = 0; i &lt; extTable.length; i++)</TD></TR><TR><TD CLASS="l">1521</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1522</TD><TD>            if (isPdpmExtension(extTable[i]))</TD></TR><TR><TD CLASS="l">1523</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1524</TD><TD>                String ext = extTable[i].replaceAll(PDPM_EXT, &#34;&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">1525</TD><TD>                pdpmMap.put(ext, ext);</TD></TR><TR CLASS="z"><TD CLASS="l">1526</TD><TD>            }</TD></TR><TR><TD CLASS="l">1527</TD><TD>            else</TD></TR><TR><TD CLASS="l">1528</TD><TD>            {</TD></TR><TR CLASS="z"><TD CLASS="l">1529</TD><TD>                extensionBuffer.append(extTable[i]);</TD></TR><TR CLASS="z"><TD CLASS="l">1530</TD><TD>                extensionBuffer.append(ExtensionsHelper.DEFAULT_FIELD_DELIMITER);</TD></TR><TR CLASS="z"><TD CLASS="l">1531</TD><TD>                if (isNew)</TD></TR><TR><TD CLASS="l">1532</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">1533</TD><TD>                    log().alarm(</TD></TR><TR><TD CLASS="l">1534</TD><TD>                            msg().add(&#34;Extensions field from TPF contains non-PDPM information, &#34;)</TD></TR><TR><TD CLASS="l">1535</TD><TD>                                    .add(&#34;unknown data and could produce duplicate entry: &#34;).add(</TD></TR><TR><TD CLASS="l">1536</TD><TD>                                            &#34;field&#34;, extTable[i]));</TD></TR><TR><TD CLASS="l">1537</TD><TD>                }</TD></TR><TR><TD CLASS="l">1538</TD><TD>            }</TD></TR><TR><TD CLASS="l">1539</TD><TD>        }</TD></TR><TR><TD CLASS="l">1540</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1541</TD><TD>        return extensionBuffer.toString();</TD></TR><TR><TD CLASS="l"><A NAME="2d">1542</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1543</TD><TD> </TD></TR><TR><TD CLASS="l">1544</TD><TD>    private boolean isEmpty(String field)</TD></TR><TR><TD CLASS="l">1545</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1546</TD><TD>        if (field == null)</TD></TR><TR CLASS="z"><TD CLASS="l">1547</TD><TD>            return true;</TD></TR><TR CLASS="z"><TD CLASS="l">1548</TD><TD>        if (field.length() &lt;= 0)</TD></TR><TR CLASS="z"><TD CLASS="l">1549</TD><TD>            return true;</TD></TR><TR CLASS="z"><TD CLASS="l">1550</TD><TD>        if (field.trim().length() &lt;= 0)</TD></TR><TR CLASS="z"><TD CLASS="l">1551</TD><TD>            return true;</TD></TR><TR CLASS="z"><TD CLASS="l">1552</TD><TD>        return false;</TD></TR><TR><TD CLASS="l"><A NAME="2e">1553</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1554</TD><TD> </TD></TR><TR><TD CLASS="l">1555</TD><TD>    private boolean isPdpmExtension(String field)</TD></TR><TR><TD CLASS="l">1556</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1557</TD><TD>        return (field.indexOf(PDPM_EXT) &gt;= 0);</TD></TR><TR><TD CLASS="l">1558</TD><TD>    }</TD></TR><TR><TD CLASS="l">1559</TD><TD> </TD></TR><TR><TD CLASS="l">1560</TD><TD> </TD></TR><TR><TD CLASS="l">1561</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1562</TD><TD>     * populate with leg details with appropriate values supplied</TD></TR><TR><TD CLASS="l">1563</TD><TD>     * </TD></TR><TR><TD CLASS="l">1564</TD><TD>     * @param OrderStruct existingOrder, the leg details of which is going to be populated</TD></TR><TR><TD CLASS="l">1565</TD><TD>     * @param LegOrderEntryStruct legEnty, the detail values of a leg</TD></TR><TR><TD CLASS="l"><A NAME="13">1566</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">1567</TD><TD>    private LegOrderDetailStruct buildLegDetailBasedOnNewValue(final Order existingOrder,</TD></TR><TR><TD CLASS="l">1568</TD><TD>            final LegOrderEntryStructV2 legEntry)</TD></TR><TR><TD CLASS="l">1569</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1570</TD><TD>        final LegOrderDetailStruct detailStruct = new LegOrderDetailStruct();</TD></TR><TR><TD CLASS="l">1571</TD><TD>        try</TD></TR><TR><TD CLASS="l">1572</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1573</TD><TD>            final LegOrderDetail legDetail = existingOrder</TD></TR><TR><TD CLASS="l">1574</TD><TD>                    .findOrderDetailForLeg(legEntry.legOrderEntry.productKey);</TD></TR><TR CLASS="z"><TD CLASS="l">1575</TD><TD>            final LegOrderDetailStruct legStruct = legDetail.toStruct();</TD></TR><TR CLASS="z"><TD CLASS="l">1576</TD><TD>            detailStruct.productKey = legEntry.legOrderEntry.productKey;</TD></TR><TR CLASS="z"><TD CLASS="l">1577</TD><TD>            detailStruct.mustUsePrice = legEntry.legOrderEntry.mustUsePrice;</TD></TR><TR CLASS="z"><TD CLASS="l">1578</TD><TD>            detailStruct.clearingFirm = legEntry.legOrderEntry.clearingFirm;</TD></TR><TR CLASS="z"><TD CLASS="l">1579</TD><TD>            detailStruct.coverage = legEntry.legOrderEntry.coverage;</TD></TR><TR CLASS="z"><TD CLASS="l">1580</TD><TD>            detailStruct.positionEffect = legEntry.legOrderEntry.positionEffect;</TD></TR><TR CLASS="z"><TD CLASS="l">1581</TD><TD>            detailStruct.side = legStruct.side;</TD></TR><TR CLASS="z"><TD CLASS="l">1582</TD><TD>            detailStruct.originalQuantity = legStruct.originalQuantity;</TD></TR><TR CLASS="z"><TD CLASS="l">1583</TD><TD>            detailStruct.tradedQuantity = legStruct.tradedQuantity;</TD></TR><TR CLASS="z"><TD CLASS="l">1584</TD><TD>            detailStruct.cancelledQuantity = legStruct.cancelledQuantity;</TD></TR><TR CLASS="z"><TD CLASS="l">1585</TD><TD>            detailStruct.leavesQuantity = legStruct.leavesQuantity;</TD></TR><TR><TD CLASS="l">1586</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1587</TD><TD>        catch (final Exception e)</TD></TR><TR><TD CLASS="l">1588</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1589</TD><TD>            log().alarm(msg().add(e));</TD></TR><TR CLASS="z"><TD CLASS="l">1590</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1591</TD><TD>        return detailStruct;</TD></TR><TR><TD CLASS="l">1592</TD><TD>    }</TD></TR><TR><TD CLASS="l">1593</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="6">1594</A></TD><TD>    public void acceptFillReport(ProductKeysStruct p_productKeys, OrderIdStruct p_orderId, </TD></TR><TR><TD CLASS="l">1595</TD><TD>            PriceStruct p_orderExecutingPrice, FilledReportStruct p_fillReport, boolean p_possibleResend) </TD></TR><TR><TD CLASS="l">1596</TD><TD>    throws SystemException, CommunicationException, DataValidationException, AuthorizationException</TD></TR><TR><TD CLASS="l">1597</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1598</TD><TD>        omsService.acceptFillReport(p_productKeys, p_orderId, p_orderExecutingPrice, p_fillReport, p_possibleResend);</TD></TR><TR CLASS="z"><TD CLASS="l">1599</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="7">1600</A></TD><TD>    </TD></TR><TR><TD CLASS="l">1601</TD><TD>    public void acceptNothingDone(ProductKeysStruct p_productKeys, OrderIdStruct p_orderId, boolean p_possibleResend) </TD></TR><TR><TD CLASS="l">1602</TD><TD>    throws SystemException, CommunicationException, DataValidationException, AuthorizationException</TD></TR><TR><TD CLASS="l">1603</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1604</TD><TD>        omsService.acceptNothingDone(p_productKeys, p_orderId, p_possibleResend); </TD></TR><TR CLASS="z"><TD CLASS="l">1605</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="f">1606</A></TD><TD>    </TD></TR><TR><TD CLASS="l">1607</TD><TD>    public void applyOrderCancel(int p_adjustedProduct, OrderIdStruct p_orderId, int p_cancelledQuantity) </TD></TR><TR><TD CLASS="l">1608</TD><TD>    throws SystemException, CommunicationException, DataValidationException, AuthorizationException</TD></TR><TR><TD CLASS="l">1609</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1610</TD><TD>        omsService.applyOrderCancel(p_adjustedProduct, p_orderId, p_cancelledQuantity);</TD></TR><TR CLASS="z"><TD CLASS="l">1611</TD><TD>    }</TD></TR><TR><TD CLASS="l">1612</TD><TD>    </TD></TR><TR><TD CLASS="l"><A NAME="10">1613</A></TD><TD>    public void applyOrderUpdate(int p_adjustedProduct, OrderIdStruct p_orderId, PriceStruct p_updatedPrice,</TD></TR><TR><TD CLASS="l">1614</TD><TD>                int p_updatedQuantity)</TD></TR><TR><TD CLASS="l">1615</TD><TD>    throws SystemException, CommunicationException, DataValidationException, AuthorizationException</TD></TR><TR><TD CLASS="l">1616</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1617</TD><TD>        omsService.applyOrderUpdate(p_adjustedProduct, p_orderId, p_updatedPrice, p_updatedQuantity);</TD></TR><TR CLASS="z"><TD CLASS="l">1618</TD><TD>    }</TD></TR><TR><TD CLASS="l">1619</TD><TD>    </TD></TR><TR><TD CLASS="l">1620</TD><TD>    public void applyOrderUpdateWithContingency(int p_adjustedProduct, OrderIdStruct p_orderId,</TD></TR><TR><TD CLASS="l"><A NAME="11">1621</A></TD><TD>                               PriceStruct p_updatedPrice, PriceStruct p_updatedContingencyPrice,</TD></TR><TR><TD CLASS="l">1622</TD><TD>                               int p_updatedQuantity)</TD></TR><TR><TD CLASS="l">1623</TD><TD>    throws SystemException, CommunicationException, DataValidationException, AuthorizationException</TD></TR><TR><TD CLASS="l">1624</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1625</TD><TD>        omsService.applyOrderUpdateWithContingency(p_adjustedProduct, p_orderId, p_updatedPrice, </TD></TR><TR><TD CLASS="l">1626</TD><TD>                                  p_updatedContingencyPrice, p_updatedQuantity);</TD></TR><TR><TD CLASS="l">1627</TD><TD>    </TD></TR><TR CLASS="z"><TD CLASS="l">1628</TD><TD>    }</TD></TR><TR><TD CLASS="l">1629</TD><TD>    </TD></TR><TR><TD CLASS="l">1630</TD><TD>    public void deleteOrderFromBook(String p_userId, CancelRequestStruct p_cancelRequest, </TD></TR><TR><TD CLASS="l"><A NAME="1a">1631</A></TD><TD>                   ProductKeysStruct p_productKeys) </TD></TR><TR><TD CLASS="l">1632</TD><TD>    throws SystemException, CommunicationException, DataValidationException, TransactionFailedException, </TD></TR><TR><TD CLASS="l">1633</TD><TD>    NotAcceptedException, AuthorizationException</TD></TR><TR><TD CLASS="l">1634</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1635</TD><TD>        omsService.deleteOrderFromBook(p_userId, p_cancelRequest, p_productKeys);</TD></TR><TR CLASS="z"><TD CLASS="l">1636</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="34">1637</A></TD><TD>    </TD></TR><TR><TD CLASS="l">1638</TD><TD>    public void orderAccepted(ProductKeysStruct p_productKeys, OrderIdStruct p_orderIdi, boolean p_possibleResend)</TD></TR><TR><TD CLASS="l">1639</TD><TD>    throws SystemException, CommunicationException, DataValidationException, AuthorizationException</TD></TR><TR><TD CLASS="l">1640</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1641</TD><TD>        omsService.orderAccepted(p_productKeys, p_orderIdi, p_possibleResend);</TD></TR><TR CLASS="z"><TD CLASS="l">1642</TD><TD>    }</TD></TR><TR><TD CLASS="l">1643</TD><TD>    </TD></TR><TR><TD CLASS="l">1644</TD><TD>    public void processReinstateOrder(int p_productKey, CboeIdStruct p_orderKey, CboeIdStruct p_tradeId, </TD></TR><TR><TD CLASS="l"><A NAME="3b">1645</A></TD><TD>                     int p_quantityReinstated) </TD></TR><TR><TD CLASS="l">1646</TD><TD>    throws SystemException, CommunicationException, DataValidationException, </TD></TR><TR><TD CLASS="l">1647</TD><TD>    NotAcceptedException, AuthorizationException</TD></TR><TR><TD CLASS="l">1648</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1649</TD><TD>        omsService.processReinstateOrder(p_productKey, p_orderKey, p_tradeId, p_quantityReinstated);</TD></TR><TR CLASS="z"><TD CLASS="l">1650</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="3e">1651</A></TD><TD>    </TD></TR><TR><TD CLASS="l">1652</TD><TD>    public boolean userHasOrders(String p_userid) </TD></TR><TR><TD CLASS="l">1653</TD><TD>    throws SystemException, CommunicationException, AuthorizationException, NotFoundException</TD></TR><TR><TD CLASS="l">1654</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1655</TD><TD>        return omsService.userHasOrders(p_userid);</TD></TR><TR><TD CLASS="l">1656</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="46">1657</A></TD><TD>    </TD></TR><TR><TD CLASS="l">1658</TD><TD>    public void waitForCompletion() </TD></TR><TR><TD CLASS="l">1659</TD><TD>    throws SystemException, CommunicationException, DataValidationException, AuthorizationException</TD></TR><TR><TD CLASS="l">1660</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1661</TD><TD>        omsService.waitForCompletion();</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="e">1662</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1663</TD><TD>    </TD></TR><TR><TD CLASS="l">1664</TD><TD>    public void allAdjustmentsAppliedNotice() throws SystemException</TD></TR><TR><TD CLASS="l">1665</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1666</TD><TD>        omsService.allAdjustmentsAppliedNotice();</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="36">1667</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1668</TD><TD>    </TD></TR><TR><TD CLASS="l">1669</TD><TD>    public void priceAdjustmentAppliedNotice(PendingAdjustmentStruct p_appliedAdjustment) throws SystemException</TD></TR><TR><TD CLASS="l">1670</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1671</TD><TD>        omsService.priceAdjustmentAppliedNotice(p_appliedAdjustment);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="5">1672</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1673</TD><TD> </TD></TR><TR><TD CLASS="l">1674</TD><TD>    public void acceptCancelReport(ProductKeysStruct p_productKeys, InternalCancelReportStruct[] p_cancelReports, boolean p_possibleResend) throws SystemException, CommunicationException, DataValidationException, AuthorizationException</TD></TR><TR><TD CLASS="l">1675</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1676</TD><TD>        omsService.acceptCancelReport(p_productKeys, p_cancelReports, p_possibleResend);</TD></TR><TR CLASS="z"><TD CLASS="l">1677</TD><TD>    }</TD></TR><TR><TD CLASS="l">1678</TD><TD> </TD></TR><TR><TD CLASS="l">1679</TD><TD>    </TD></TR><TR><TD CLASS="l">1680</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1681</TD><TD>     * </TD></TR><TR><TD CLASS="l"><A NAME="33">1682</A></TD><TD>     * @return</TD></TR><TR><TD CLASS="l">1683</TD><TD>     */</TD></TR><TR><TD CLASS="l">1684</TD><TD>    private MsgBuilder msg()</TD></TR><TR><TD CLASS="l">1685</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="14">1686</A></TD><TD>        return MsgBuilder.get().add(&#34;TPFOrderMaintenanceService&#34;,this).add(&#34;: &#34;);</TD></TR><TR><TD CLASS="l">1687</TD><TD>    }</TD></TR><TR><TD CLASS="l">1688</TD><TD>    </TD></TR><TR><TD CLASS="l">1689</TD><TD>    private int calculateCancelQuantity(Order order, int cancelType, int quantity){</TD></TR><TR CLASS="z"><TD CLASS="l">1690</TD><TD>        int finalQ = 0;</TD></TR><TR CLASS="z"><TD CLASS="l">1691</TD><TD>        switch (cancelType)</TD></TR><TR><TD CLASS="l">1692</TD><TD>        {</TD></TR><TR><TD CLASS="l">1693</TD><TD>            case OrderCancelTypes.DESIRED_CANCEL_QUANTITY:</TD></TR><TR CLASS="z"><TD CLASS="l">1694</TD><TD>                finalQ = quantity;</TD></TR><TR CLASS="z"><TD CLASS="l">1695</TD><TD>                break;</TD></TR><TR><TD CLASS="l">1696</TD><TD>            case OrderCancelTypes.DESIRED_REMAINING_QUANTITY:</TD></TR><TR CLASS="z"><TD CLASS="l">1697</TD><TD>                finalQ = order.getRemainingQuantity() - quantity;</TD></TR><TR CLASS="z"><TD CLASS="l">1698</TD><TD>                break;</TD></TR><TR><TD CLASS="l">1699</TD><TD>            case OrderCancelTypes.CANCEL_ALL_QUANTITY:</TD></TR><TR CLASS="z"><TD CLASS="l">1700</TD><TD>                finalQ = order.getRemainingQuantity();</TD></TR><TR CLASS="z"><TD CLASS="l">1701</TD><TD>                break;</TD></TR><TR><TD CLASS="l">1702</TD><TD>            default:</TD></TR><TR><TD CLASS="l">1703</TD><TD>                //It never be here. Cancel type was validated when cancel request was accepted.</TD></TR><TR><TD CLASS="l">1704</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1705</TD><TD>        return finalQ;</TD></TR><TR><TD CLASS="l"><A NAME="16">1706</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1707</TD><TD>    </TD></TR><TR><TD CLASS="l">1708</TD><TD>    private CancelRequestStruct createCancelRequestStructWithTypeCheck(Order p_order, int p_cancelType, int p_quantity, CancelRequestStruct p_cancelRequest)</TD></TR><TR><TD CLASS="l">1709</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1710</TD><TD>        if (log().isDebugOn())</TD></TR><TR><TD CLASS="l">1711</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1712</TD><TD>            log().debug( msg().add(&#34;In the Incoming Cancel Struct: &#34;).add(&#34;Order id: &#34;, p_order.getOrderIdString()));</TD></TR><TR CLASS="z"><TD CLASS="l">1713</TD><TD>            log().debug( msg().add(&#34;In the Incoming Cancel Struct: &#34;).add(&#34;Cancel Type: &#34;, p_cancelType));</TD></TR><TR CLASS="z"><TD CLASS="l">1714</TD><TD>            log().debug( msg().add(&#34;In the Incoming Cancel Struct: &#34;).add(&#34;Quantity: &#34;, p_quantity));</TD></TR><TR><TD CLASS="l">1715</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1716</TD><TD>        p_cancelRequest.cancelType = OrderCancelTypes.DESIRED_CANCEL_QUANTITY;</TD></TR><TR CLASS="z"><TD CLASS="l">1717</TD><TD>        p_cancelRequest.quantity = calculateCancelQuantity(p_order, p_cancelType, p_quantity);</TD></TR><TR CLASS="z"><TD CLASS="l">1718</TD><TD>        if (log().isDebugOn())</TD></TR><TR><TD CLASS="l">1719</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1720</TD><TD>            log().debug( msg().add(&#34;Reformatted cancel struct: &#34;).add(&#34;Order id: &#34;, p_order.getOrderIdString()));</TD></TR><TR CLASS="z"><TD CLASS="l">1721</TD><TD>            log().debug( msg().add(&#34;Reformatted cancel struct: &#34;).add(&#34;Cancel Type: &#34;, p_cancelRequest.cancelType));</TD></TR><TR CLASS="z"><TD CLASS="l">1722</TD><TD>            log().debug( msg().add(&#34;Reformatted cancel struct: &#34;).add(&#34;Quantity: &#34;, p_cancelRequest.quantity));</TD></TR><TR><TD CLASS="l">1723</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1724</TD><TD>        return p_cancelRequest;</TD></TR><TR><TD CLASS="l"><A NAME="35">1725</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1726</TD><TD>    </TD></TR><TR><TD CLASS="l">1727</TD><TD>    private void overridePriceBasedOnContingency(OrderStruct orderStruct)</TD></TR><TR><TD CLASS="l">1728</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1729</TD><TD>        if (orderStruct.contingency.type == ContingencyTypes.STP ||</TD></TR><TR><TD CLASS="l">1730</TD><TD>            orderStruct.contingency.type == ContingencyTypes.STP_LOSS) // there is a stop or stop loss contingency.</TD></TR><TR><TD CLASS="l">1731</TD><TD>        {</TD></TR><TR CLASS="z"><TD CLASS="l">1732</TD><TD>            orderStruct.contingency.volume = 0;</TD></TR><TR CLASS="z"><TD CLASS="l">1733</TD><TD>            orderStruct.contingency.price = orderStruct.price;</TD></TR><TR CLASS="z"><TD CLASS="l">1734</TD><TD>            orderStruct.contingency.price.type = PriceTypes.VALUED;</TD></TR><TR CLASS="z"><TD CLASS="l">1735</TD><TD>            orderStruct.price = PriceFactory.create(Price.MARKET_STRING).toStruct();</TD></TR><TR><TD CLASS="l">1736</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1737</TD><TD>        else if(orderStruct.contingency.type == ContingencyTypes.STP_LIMIT)</TD></TR><TR><TD CLASS="l">1738</TD><TD>        {</TD></TR><TR><TD CLASS="l">1739</TD><TD>            //for COATS 5A stop limit orders will also have contingency price.(the limit price of orders)</TD></TR><TR CLASS="z"><TD CLASS="l">1740</TD><TD>            orderStruct.contingency.volume = 0;</TD></TR><TR CLASS="z"><TD CLASS="l">1741</TD><TD>            PriceStruct temp = orderStruct.contingency.price;</TD></TR><TR CLASS="z"><TD CLASS="l">1742</TD><TD>            orderStruct.contingency.price = orderStruct.price;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3c">1743</A></TD><TD>            orderStruct.price = temp;</TD></TR><TR><TD CLASS="l">1744</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1745</TD><TD>    } </TD></TR><TR><TD CLASS="l">1746</TD><TD>    private void setPreviousLocationAndLocationType(Order p_order, OrderRoutingParameterStruct p_orderRoutingStruct) {</TD></TR><TR CLASS="z"><TD CLASS="l">1747</TD><TD>        if(p_order != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1748</TD><TD>            p_order.setPreviousLocation(p_orderRoutingStruct.source);</TD></TR><TR CLASS="z"><TD CLASS="l">1749</TD><TD>            p_order.setPreviousLocationType(p_orderRoutingStruct.sourceType);</TD></TR><TR><TD CLASS="l">1750</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">1751</TD><TD>    }</TD></TR><TR><TD CLASS="l">1752</TD><TD>    </TD></TR><TR><TD CLASS="l">1753</TD><TD>    public void acceptStrategyLegOrderFillReport(RoutingParameterStruct routingParameter, OrderIdStruct orderId,</TD></TR><TR><TD CLASS="l"><A NAME="b">1754</A></TD><TD>            FilledReportStruct[] filledReportStruct) </TD></TR><TR><TD CLASS="l">1755</TD><TD>            throws SystemException, CommunicationException, </TD></TR><TR><TD CLASS="l">1756</TD><TD>            DataValidationException, AuthorizationException</TD></TR><TR><TD CLASS="l">1757</TD><TD>    {                        </TD></TR><TR CLASS="z"><TD CLASS="l">1758</TD><TD>    }</TD></TR><TR><TD CLASS="l">1759</TD><TD> </TD></TR><TR><TD CLASS="l">1760</TD><TD>    public void acceptStrategyLegOrderCancelReport(RoutingParameterStruct routingParameter, OrderIdStruct orderId,</TD></TR><TR><TD CLASS="l"><A NAME="a">1761</A></TD><TD>             CancelReportStruct[] cancelReportStruct) </TD></TR><TR><TD CLASS="l">1762</TD><TD>             throws SystemException, CommunicationException, </TD></TR><TR><TD CLASS="l">1763</TD><TD>             DataValidationException, AuthorizationException</TD></TR><TR><TD CLASS="l">1764</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">1765</TD><TD>    }</TD></TR><TR><TD CLASS="l">1766</TD><TD> </TD></TR><TR><TD CLASS="l">1767</TD><TD>}</TD></TR><TR><TD CLASS="l">1768</TD><TD> </TD></TR><TR><TD CLASS="l">1769</TD><TD> </TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../coverage.html">all classes</A>][<A HREF="1.html">com.cboe.ohs.deprecated.oms</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://sourceforge.net/projects/emma">EMMA 2.0.5312</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>