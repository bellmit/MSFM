<HTML><HEAD><META CONTENT="text/html; charset=UTF-8" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://www.eclemma.org/">EMMA</A> Coverage Report (generated Mon Aug 01 05:29:56 CDT 2011)</TH></TR><TR><TD CLASS="nv">[<A HREF="../Coverage.html">all classes</A>][<A HREF="12d.html">com.cboe.businessServices.tradingSessionService</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">TradingSessionTpfEOBDStrategyImpl.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>TradingSessionTpfEOBDStrategyImpl.java</TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/169)</TD><TD CLASS="h">0%   (0/22)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">TradingSessionTpfEOBDStrategyImpl</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/169)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR><TD CLASS="f"><A HREF="#0">&lt;static initializer&gt;</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/87)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">TradingSessionTpfEOBDStrategyImpl (String, TradingSessionService): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#3">performEndOfBusinessDay (boolean, String [], String []): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/36)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">purge (boolean, String [], String []): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/36)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#5">toStruct (): TradingSessionStrategyDescriptionStruct</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="l">1</TD><TD>package com.cboe.businessServices.tradingSessionService;</TD></TR><TR><TD CLASS="l">2</TD><TD> </TD></TR><TR><TD CLASS="l">3</TD><TD>// java classes</TD></TR><TR><TD CLASS="l">4</TD><TD>import java.util.Vector;</TD></TR><TR><TD CLASS="l">5</TD><TD> </TD></TR><TR><TD CLASS="l">6</TD><TD>// cboe classes</TD></TR><TR><TD CLASS="l">7</TD><TD>import com.cboe.idl.session.*;</TD></TR><TR><TD CLASS="l">8</TD><TD>import com.cboe.exceptions.*;</TD></TR><TR><TD CLASS="l">9</TD><TD>import com.cboe.idl.cmiConstants.TradingSessionStates;</TD></TR><TR><TD CLASS="l">10</TD><TD>import com.cboe.interfaces.businessServices.TradingSessionService;</TD></TR><TR><TD CLASS="l">11</TD><TD>import com.cboe.interfaces.businessServices.TradingSessionEventType;</TD></TR><TR><TD CLASS="l">12</TD><TD>import com.cboe.infrastructureServices.foundationFramework.utilities.Log;</TD></TR><TR><TD CLASS="l">13</TD><TD> </TD></TR><TR><TD CLASS="l">14</TD><TD>/** </TD></TR><TR><TD CLASS="l">15</TD><TD> * This strategy relies on certain events to be triggered by TPF.</TD></TR><TR><TD CLASS="l">16</TD><TD> * 1. TPF starts of by telling us that pricee adjustments have been completed.</TD></TR><TR><TD CLASS="l">17</TD><TD> *    That triggers the end of day processing here.</TD></TR><TR><TD CLASS="l">18</TD><TD> * 2. After we apply the adjustments we tell tpf we are done.</TD></TR><TR><TD CLASS="l">19</TD><TD> * 3. Then tpf sends us order adjustments.</TD></TR><TR><TD CLASS="l">20</TD><TD> * 4. After that is done we do the purge.</TD></TR><TR><TD CLASS="l">21</TD><TD> * 5. Then we are all done.</TD></TR><TR><TD CLASS="l">22</TD><TD> * </TD></TR><TR><TD CLASS="l">23</TD><TD> *</TD></TR><TR><TD CLASS="l">24</TD><TD> * NOTE: This strategy will not auto start.</TD></TR><TR><TD CLASS="l">25</TD><TD> *</TD></TR><TR><TD CLASS="l">26</TD><TD> * @author  torress</TD></TR><TR><TD CLASS="l">27</TD><TD> * @author Ravi Vazirani -- fixes.</TD></TR><TR><TD CLASS="l">28</TD><TD> * @version </TD></TR><TR><TD CLASS="l">29</TD><TD> */</TD></TR><TR CLASS="z"><TD CLASS="l">30</TD><TD>public class TradingSessionTpfEOBDStrategyImpl extends TradingSessionStrategyImpl implements TradingSessionEOBDStrategy</TD></TR><TR><TD CLASS="l">31</TD><TD>{</TD></TR><TR><TD CLASS="l"><A NAME="0">32</A></TD><TD>        // CLASS CONSTANTS</TD></TR><TR><TD CLASS="l">33</TD><TD>        /**</TD></TR><TR><TD CLASS="l">34</TD><TD>         * Event list for creating the description structure.</TD></TR><TR><TD CLASS="l">35</TD><TD>         */</TD></TR><TR CLASS="z"><TD CLASS="l">36</TD><TD>         private static final TradingSessionEventDescriptionStruct[] eventList = {</TD></TR><TR CLASS="z"><TD CLASS="l">37</TD><TD>                                        new TradingSessionEventDescriptionStruct((short)TradingSessionEventType.START_PRICE_ADJ.getEnumValue(),TradingSessionEventType.START_PRICE_ADJ + &#34;(Triggered by TPF STOCK SPLIT COMPLETED)&#34;),</TD></TR><TR CLASS="z"><TD CLASS="l">38</TD><TD>                                        new TradingSessionEventDescriptionStruct((short)TradingSessionEventType.WAIT_PRICE_ADJ_COMPLETION.getEnumValue(),TradingSessionEventType.WAIT_PRICE_ADJ_COMPLETION + &#34;&#34;),</TD></TR><TR CLASS="z"><TD CLASS="l">39</TD><TD>                                           new TradingSessionEventDescriptionStruct((short)TradingSessionEventType.PRICE_ADJ_COMPLETE.getEnumValue(),TradingSessionEventType.PRICE_ADJ_COMPLETE + &#34;(DOES NOT WAIT FOR COMPLETION AND NOTIFIES TPF)&#34;),</TD></TR><TR CLASS="z"><TD CLASS="l">40</TD><TD>                                           new TradingSessionEventDescriptionStruct((short)TradingSessionEventType.PURGE_SESSION .getEnumValue(),TradingSessionEventType.PURGE_SESSION + &#34;(Triggered by TPF END ORDER ADJUSTMENT DOWNLOAD)&#34;),</TD></TR><TR CLASS="z"><TD CLASS="l">41</TD><TD>                                           new TradingSessionEventDescriptionStruct((short)TradingSessionEventType.END_OF_DAY.getEnumValue(), TradingSessionEventType.END_OF_DAY + &#34;(ALL DONE)&#34;)</TD></TR><TR><TD CLASS="l">42</TD><TD>                                  };</TD></TR><TR><TD CLASS="l">43</TD><TD>             </TD></TR><TR><TD CLASS="l">44</TD><TD>        /**</TD></TR><TR><TD CLASS="l">45</TD><TD>         * Some Description about the strategy.</TD></TR><TR><TD CLASS="l">46</TD><TD>         */</TD></TR><TR><TD CLASS="l">47</TD><TD>         private static final String description = &#34;This strategy synchronizes End Of Day processing &#34; +</TD></TR><TR><TD CLASS="l">48</TD><TD>                                                                                        &#34; with End of day events that occur on TPF.&#34;;</TD></TR><TR><TD CLASS="l">49</TD><TD>        </TD></TR><TR><TD CLASS="l">50</TD><TD>/**</TD></TR><TR><TD CLASS="l">51</TD><TD> * EOBD strategy implementation.</TD></TR><TR><TD CLASS="l">52</TD><TD> * @see #performEndOfBusinessDay</TD></TR><TR><TD CLASS="l">53</TD><TD> * @param String myName</TD></TR><TR><TD CLASS="l"><A NAME="2">54</A></TD><TD> * @param TradingSessionService</TD></TR><TR><TD CLASS="l">55</TD><TD> */</TD></TR><TR><TD CLASS="l">56</TD><TD>public TradingSessionTpfEOBDStrategyImpl(String aName,TradingSessionService aTradingSessionService)</TD></TR><TR><TD CLASS="l">57</TD><TD>{</TD></TR><TR CLASS="z"><TD CLASS="l">58</TD><TD>        super(aName,aTradingSessionService);</TD></TR><TR CLASS="z"><TD CLASS="l">59</TD><TD>}</TD></TR><TR><TD CLASS="l">60</TD><TD>/**</TD></TR><TR><TD CLASS="l">61</TD><TD> * This method is called when TPF tells us that they aere done applying price</TD></TR><TR><TD CLASS="l">62</TD><TD> * adjustments and now we can start our end of day stuff.</TD></TR><TR><TD CLASS="l">63</TD><TD> * EOD starts with applyiung price adjustments.</TD></TR><TR><TD CLASS="l">64</TD><TD> *</TD></TR><TR><TD CLASS="l">65</TD><TD> * @param int the session key (meaning less)</TD></TR><TR><TD CLASS="l">66</TD><TD> * @param boolean abot on error if true.</TD></TR><TR><TD CLASS="l"><A NAME="3">67</A></TD><TD> * @exception TransactionFailedException.</TD></TR><TR><TD CLASS="l">68</TD><TD> */</TD></TR><TR><TD CLASS="l">69</TD><TD>public void performEndOfBusinessDay(boolean abortOnError,String[] activeClients,String[] inactiveClients) throws TransactionFailedException</TD></TR><TR><TD CLASS="l">70</TD><TD>{</TD></TR><TR CLASS="z"><TD CLASS="l">71</TD><TD>        String[] disabledClients = new String[0];</TD></TR><TR><TD CLASS="l">72</TD><TD>    // Start the price adjustments</TD></TR><TR CLASS="z"><TD CLASS="l">73</TD><TD>        disabledClients = executeActionForEvent(TradingSessionEventType.START_PRICE_ADJ,TradingSessionService.ALL_SESSIONS,true,abortOnError, activeClients, inactiveClients, disabledClients);</TD></TR><TR><TD CLASS="l">74</TD><TD>        </TD></TR><TR><TD CLASS="l">75</TD><TD>        // Wait for all to finish applying their price adjustments.</TD></TR><TR CLASS="z"><TD CLASS="l">76</TD><TD>        disabledClients = executeActionForEvent(TradingSessionEventType.WAIT_PRICE_ADJ_COMPLETION,TradingSessionService.ALL_SESSIONS,true,abortOnError, activeClients, inactiveClients, disabledClients);</TD></TR><TR><TD CLASS="l">77</TD><TD> </TD></TR><TR><TD CLASS="l">78</TD><TD>        // Send all adjustments applied notice, don't wait for completion</TD></TR><TR CLASS="z"><TD CLASS="l">79</TD><TD>           disabledClients = executeActionForEvent(TradingSessionEventType.PRICE_ADJ_COMPLETE,TradingSessionService.ALL_SESSIONS,false,abortOnError, activeClients, inactiveClients, disabledClients);</TD></TR><TR><TD CLASS="l">80</TD><TD>           </TD></TR><TR CLASS="z"><TD CLASS="l">81</TD><TD>        Log.information(&#34;TradingSessionTpfEOBDStrategyImpl: Price adjustment processing is now complete. We will now tell TPF and wait for TPF to send us order adjustments. Once the order adjustments have been sent successfully, then END OF DAY PRUGE WILL BEGIN.&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">82</TD><TD>}</TD></TR><TR><TD CLASS="l">83</TD><TD>/**</TD></TR><TR><TD CLASS="l">84</TD><TD> * This method is called when TPF tells use that they are done sending us order adjustments.</TD></TR><TR><TD CLASS="l">85</TD><TD> * @param int the session key (meaning less)</TD></TR><TR><TD CLASS="l">86</TD><TD> * @param boolean abot on error if true.</TD></TR><TR><TD CLASS="l"><A NAME="4">87</A></TD><TD> * @exception TransactionFailedException.</TD></TR><TR><TD CLASS="l">88</TD><TD> */</TD></TR><TR><TD CLASS="l">89</TD><TD>public void purge(boolean abortOnError, String[] activeClients, String[] inactiveClients) throws TransactionFailedException</TD></TR><TR><TD CLASS="l">90</TD><TD>{</TD></TR><TR CLASS="z"><TD CLASS="l">91</TD><TD>        String[] disabledClients = new String[0];</TD></TR><TR><TD CLASS="l">92</TD><TD>    // PURGE DATA.</TD></TR><TR CLASS="z"><TD CLASS="l">93</TD><TD>           disabledClients = executeActionForEvent(TradingSessionEventType.PURGE_SESSION,TradingSessionService.ALL_SESSIONS,true,abortOnError, activeClients, inactiveClients, disabledClients);</TD></TR><TR><TD CLASS="l">94</TD><TD>        </TD></TR><TR><TD CLASS="l">95</TD><TD>        // POST PURGE VALIDATION.</TD></TR><TR CLASS="z"><TD CLASS="l">96</TD><TD>           disabledClients = executeActionForEvent(TradingSessionEventType.POST_PURGE_VALIDATION,TradingSessionService.ALL_SESSIONS,true,abortOnError, activeClients, inactiveClients, disabledClients);</TD></TR><TR><TD CLASS="l">97</TD><TD>        </TD></TR><TR><TD CLASS="l">98</TD><TD>        // END OF DAY is complete</TD></TR><TR CLASS="z"><TD CLASS="l">99</TD><TD>           disabledClients = executeActionForEvent(TradingSessionEventType.END_OF_DAY,TradingSessionService.ALL_SESSIONS,true,abortOnError, activeClients, inactiveClients, disabledClients);</TD></TR><TR><TD CLASS="l">100</TD><TD>           </TD></TR><TR CLASS="z"><TD CLASS="l">101</TD><TD>        Log.information(&#34;TradingSessionTpfEOBDStrategyImpl: End Of Day processing is now complete ...&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">102</TD><TD>}</TD></TR><TR><TD CLASS="l">103</TD><TD>/**</TD></TR><TR><TD CLASS="l">104</TD><TD> * </TD></TR><TR><TD CLASS="l"><A NAME="5">105</A></TD><TD> * @return TradingSessionStrategyDescriptionStruct</TD></TR><TR><TD CLASS="l">106</TD><TD> */</TD></TR><TR><TD CLASS="l">107</TD><TD>public TradingSessionStrategyDescriptionStruct toStruct()</TD></TR><TR><TD CLASS="l">108</TD><TD>{</TD></TR><TR CLASS="z"><TD CLASS="l">109</TD><TD>        return toStruct(description,eventList);</TD></TR><TR><TD CLASS="l">110</TD><TD>}</TD></TR><TR><TD CLASS="l">111</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../Coverage.html">all classes</A>][<A HREF="12d.html">com.cboe.businessServices.tradingSessionService</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://www.eclemma.org/support.html">EMMA 2.0.5312 EclEmma Fix 2</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>