<HTML><HEAD><META CONTENT="text/html; charset=UTF-8" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://www.eclemma.org/">EMMA</A> Coverage Report (generated Mon Aug 01 05:29:56 CDT 2011)</TH></TR><TR><TD CLASS="nv">[<A HREF="../Coverage.html">all classes</A>][<A HREF="134.html">com.cboe.domain.util.adminRequest</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">ArContext.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>ArContext.java</TD><TD>100% (1/1)</TD><TD CLASS="h">10%  (1/10)</TD><TD CLASS="h">1%   (8/949)</TD><TD CLASS="h">1%   (2/161)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">ArContext</A></TD><TD>100% (1/1)</TD><TD CLASS="h">10%  (1/10)</TD><TD CLASS="h">1%   (8/949)</TD><TD CLASS="h">1%   (2/161)</TD></TR><TR><TD CLASS="f"><A HREF="#1">addArCommand (String, String [], StreamLogger, StreamLogger, long, ExecutorSe...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/259)</TD><TD CLASS="h">0%   (0/45)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">executeAll (StreamLogger, StreamLogger, long, ExecutorService, List, String, ...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/333)</TD><TD CLASS="h">0%   (0/57)</TD></TR><TR><TD CLASS="f"><A HREF="#3">executeAll (StreamLogger, StreamLogger, long, ExecutorService, String, String...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/25)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">executeAllInTwoPhases (StreamLogger, StreamLogger, long, ExecutorService, Str...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/197)</TD><TD CLASS="h">0%   (0/31)</TD></TR><TR><TD CLASS="f"><A HREF="#5">getFaiList (): ArrayList</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">initFastAdminInvokers (String, List, StreamLogger): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/81)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#7">isArCommandAdded (String, String []): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/35)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#8">setFaiList (ArrayList): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#9">setSecondPhasePattern (String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#0">ArContext (): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (8/8)</TD><TD>100% (2/2)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="l">1</TD><TD>package com.cboe.domain.util.adminRequest;</TD></TR><TR><TD CLASS="l">2</TD><TD> </TD></TR><TR><TD CLASS="l">3</TD><TD>import java.util.ArrayList;</TD></TR><TR><TD CLASS="l">4</TD><TD>import java.util.List;</TD></TR><TR><TD CLASS="l">5</TD><TD>import java.util.concurrent.ExecutionException;</TD></TR><TR><TD CLASS="l">6</TD><TD>import java.util.concurrent.ExecutorService;</TD></TR><TR><TD CLASS="l">7</TD><TD>import java.util.concurrent.Future;</TD></TR><TR><TD CLASS="l">8</TD><TD>import java.util.concurrent.TimeUnit;</TD></TR><TR><TD CLASS="l">9</TD><TD>import java.util.concurrent.TimeoutException;</TD></TR><TR><TD CLASS="l">10</TD><TD> </TD></TR><TR><TD CLASS="l">11</TD><TD>import com.cboe.domain.util.StreamLogger;</TD></TR><TR><TD CLASS="l"><A NAME="0">12</A></TD><TD>import com.cboe.domain.util.failover.ProcessInfo;</TD></TR><TR><TD CLASS="l">13</TD><TD>import com.cboe.infrastructureServices.interfaces.adminService.CommandHolder;</TD></TR><TR><TD CLASS="l">14</TD><TD>import com.cboe.infrastructureServices.interfaces.adminService.AdminPackage.UnsupportedCommand;</TD></TR><TR><TD CLASS="l">15</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="8">16</A></TD><TD>public class ArContext</TD></TR><TR><TD CLASS="l">17</TD><TD>{</TD></TR><TR><TD CLASS="l">18</TD><TD>    public void setFaiList(ArrayList&lt;FastAdminInvoker&gt; p_faiList)</TD></TR><TR><TD CLASS="l">19</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">20</TD><TD>        faiList = p_faiList;</TD></TR><TR CLASS="z"><TD CLASS="l">21</TD><TD>    }</TD></TR><TR><TD CLASS="l">22</TD><TD> </TD></TR><TR><TD CLASS="l">23</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">24</TD><TD>    ArrayList&lt;FastAdminInvoker&gt; faiList = new ArrayList&lt;FastAdminInvoker&gt;();</TD></TR><TR><TD CLASS="l">25</TD><TD>    String secondPhasePattern;</TD></TR><TR><TD CLASS="l">26</TD><TD> </TD></TR><TR><TD CLASS="l">27</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="9">28</A></TD><TD> </TD></TR><TR><TD CLASS="l">29</TD><TD> </TD></TR><TR><TD CLASS="l">30</TD><TD>    public void setSecondPhasePattern(String p_secondPhasePattern)</TD></TR><TR><TD CLASS="l">31</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">32</TD><TD>        secondPhasePattern = p_secondPhasePattern;</TD></TR><TR CLASS="z"><TD CLASS="l">33</TD><TD>    }</TD></TR><TR><TD CLASS="l">34</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="5">35</A></TD><TD> </TD></TR><TR><TD CLASS="l">36</TD><TD> </TD></TR><TR><TD CLASS="l">37</TD><TD>    public ArrayList&lt;FastAdminInvoker&gt; getFaiList()</TD></TR><TR><TD CLASS="l">38</TD><TD>    {</TD></TR><TR CLASS="z"><TD CLASS="l">39</TD><TD>        return faiList;</TD></TR><TR><TD CLASS="l">40</TD><TD>    }</TD></TR><TR><TD CLASS="l">41</TD><TD> </TD></TR><TR><TD CLASS="l">42</TD><TD> </TD></TR><TR><TD CLASS="l">43</TD><TD> </TD></TR><TR><TD CLASS="l">44</TD><TD>    /**</TD></TR><TR><TD CLASS="l">45</TD><TD>     * </TD></TR><TR><TD CLASS="l">46</TD><TD>     * @param piAl</TD></TR><TR><TD CLASS="l">47</TD><TD>     * @param errorLog</TD></TR><TR><TD CLASS="l">48</TD><TD>     * @param tm</TD></TR><TR><TD CLASS="l">49</TD><TD>     * @throws Exception</TD></TR><TR><TD CLASS="l"><A NAME="6">50</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">51</TD><TD>    public void initFastAdminInvokers(String host, List&lt;ProcessInfo&gt; piAl, StreamLogger errorLog) throws Exception</TD></TR><TR><TD CLASS="l">52</TD><TD>    {</TD></TR><TR><TD CLASS="l">53</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">54</TD><TD>            faiList.clear();</TD></TR><TR CLASS="z"><TD CLASS="l">55</TD><TD>        for(int i = 0; i&lt;piAl.size(); i++){</TD></TR><TR CLASS="z"><TD CLASS="l">56</TD><TD>            errorLog.println(&#34;Started initializing connection to &#34; + piAl.get(i).getOrbName() + &#34;:&#34; +  piAl.get(i).getPort() + &#34; ...&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">57</TD><TD>            FastAdminInvoker fai = new FastAdminInvoker(host, Integer.parseInt(piAl.get(i).getPort()), piAl.get(i).getOrbName());</TD></TR><TR CLASS="z"><TD CLASS="l">58</TD><TD>            fai.initialize();</TD></TR><TR CLASS="z"><TD CLASS="l">59</TD><TD>            errorLog.println(&#34;Finished initializing connection to &#34; + piAl.get(i).getOrbName() + &#34;:&#34; +  piAl.get(i).getPort() + &#34;.&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">60</TD><TD>            faiList.add(fai);</TD></TR><TR><TD CLASS="l"><A NAME="7">61</A></TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">62</TD><TD>    }</TD></TR><TR><TD CLASS="l">63</TD><TD>    </TD></TR><TR><TD CLASS="l">64</TD><TD>    public boolean isArCommandAdded(String p_cmd, String[] p_args){</TD></TR><TR CLASS="z"><TD CLASS="l">65</TD><TD>        boolean atLeastOnefound = false;</TD></TR><TR CLASS="z"><TD CLASS="l">66</TD><TD>        for(FastAdminInvoker fai:faiList){</TD></TR><TR CLASS="z"><TD CLASS="l">67</TD><TD>            if(fai.getCmdHolder(p_cmd, p_args) == null){ // command not found</TD></TR><TR CLASS="z"><TD CLASS="l">68</TD><TD>                if(fai.isKnownUnsupportedCommand(p_cmd, p_args)){</TD></TR><TR CLASS="z"><TD CLASS="l">69</TD><TD>                  continue;  // ignore unsupported </TD></TR><TR><TD CLASS="l">70</TD><TD>                }</TD></TR><TR><TD CLASS="l">71</TD><TD>                else{</TD></TR><TR CLASS="z"><TD CLASS="l">72</TD><TD>                  return false;   // not found and not unsupported </TD></TR><TR><TD CLASS="l">73</TD><TD>                }</TD></TR><TR><TD CLASS="l">74</TD><TD>            }else{</TD></TR><TR CLASS="z"><TD CLASS="l">75</TD><TD>                atLeastOnefound = true;</TD></TR><TR><TD CLASS="l">76</TD><TD>            }</TD></TR><TR><TD CLASS="l">77</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">78</TD><TD>        if(atLeastOnefound){</TD></TR><TR CLASS="z"><TD CLASS="l">79</TD><TD>            return true;  // ok if some unsupported but at least one has been found</TD></TR><TR><TD CLASS="l">80</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">81</TD><TD>        return false;  //all of them were unsupported, fail the test</TD></TR><TR><TD CLASS="l">82</TD><TD>    }</TD></TR><TR><TD CLASS="l">83</TD><TD> </TD></TR><TR><TD CLASS="l">84</TD><TD>    /**</TD></TR><TR><TD CLASS="l">85</TD><TD>     * @param faiAl</TD></TR><TR><TD CLASS="l">86</TD><TD>     * @param cmd</TD></TR><TR><TD CLASS="l">87</TD><TD>     * @param arguments</TD></TR><TR><TD CLASS="l">88</TD><TD>     * @return</TD></TR><TR><TD CLASS="l">89</TD><TD>     * @throws InterruptedException</TD></TR><TR><TD CLASS="l">90</TD><TD>     * @throws ExecutionException</TD></TR><TR><TD CLASS="l">91</TD><TD>     * @throws TimeoutException</TD></TR><TR><TD CLASS="l"><A NAME="1">92</A></TD><TD>     */</TD></TR><TR><TD CLASS="l">93</TD><TD>    public boolean addArCommand(String cmd, String[] arguments, StreamLogger errorLog,</TD></TR><TR><TD CLASS="l">94</TD><TD>            StreamLogger infoLog, long timeoutInMillis, ExecutorService tpe, boolean ignoreUnsupported) throws Exception {</TD></TR><TR><TD CLASS="l">95</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">96</TD><TD>        ArrayList&lt;Future&lt;Boolean&gt;&gt; futures = new ArrayList&lt;Future&lt;Boolean&gt;&gt;();</TD></TR><TR CLASS="z"><TD CLASS="l">97</TD><TD>        boolean timeout = false;</TD></TR><TR CLASS="z"><TD CLASS="l">98</TD><TD>        Exception exp = null;</TD></TR><TR CLASS="z"><TD CLASS="l">99</TD><TD>        UnsupportedCommand unsupportedException = null;</TD></TR><TR CLASS="z"><TD CLASS="l">100</TD><TD>        boolean brr = true;</TD></TR><TR CLASS="z"><TD CLASS="l">101</TD><TD>        for(FastAdminInvoker fai:faiList){</TD></TR><TR CLASS="z"><TD CLASS="l">102</TD><TD>            AddArHolderCommand setArcmd = new AddArHolderCommand(fai, cmd, arguments, infoLog, errorLog);</TD></TR><TR CLASS="z"><TD CLASS="l">103</TD><TD>            errorLog.println(&#34;Setting up ar command: &#34; + cmd + &#34; on process: &#34; + fai.getOrbName());</TD></TR><TR CLASS="z"><TD CLASS="l">104</TD><TD>            Future&lt;Boolean&gt; rrFuture = tpe.submit(setArcmd);</TD></TR><TR CLASS="z"><TD CLASS="l">105</TD><TD>            futures.add(rrFuture);</TD></TR><TR><TD CLASS="l">106</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">107</TD><TD>        int index =0;</TD></TR><TR CLASS="z"><TD CLASS="l">108</TD><TD>        Boolean arr = false;</TD></TR><TR CLASS="z"><TD CLASS="l">109</TD><TD>        boolean foundAtLeastOne = false;</TD></TR><TR CLASS="z"><TD CLASS="l">110</TD><TD>        for(Future&lt;Boolean&gt; ft:futures){</TD></TR><TR><TD CLASS="l">111</TD><TD>            try{</TD></TR><TR CLASS="z"><TD CLASS="l">112</TD><TD>                timeout=false;</TD></TR><TR CLASS="z"><TD CLASS="l">113</TD><TD>                arr = false;</TD></TR><TR CLASS="z"><TD CLASS="l">114</TD><TD>                foundAtLeastOne = true;</TD></TR><TR CLASS="z"><TD CLASS="l">115</TD><TD>                arr = ft.get(timeoutInMillis, TimeUnit.MILLISECONDS);</TD></TR><TR CLASS="z"><TD CLASS="l">116</TD><TD>                errorLog.println(&#34;Successfully set up ar command: &#34; + cmd + &#34; on process: &#34; + faiList.get(index).getOrbName());</TD></TR><TR><TD CLASS="l">117</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">118</TD><TD>            catch(TimeoutException toe){</TD></TR><TR CLASS="z"><TD CLASS="l">119</TD><TD>                timeout = true;</TD></TR><TR CLASS="z"><TD CLASS="l">120</TD><TD>                exp = toe;</TD></TR><TR><TD CLASS="l">121</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">122</TD><TD>            catch(ExecutionException ee){// special treatment for unimplemented ar commands if requested</TD></TR><TR CLASS="z"><TD CLASS="l">123</TD><TD>                if((ignoreUnsupported) &amp;&amp; (ee.getCause() instanceof UnsupportedCommand)){</TD></TR><TR CLASS="z"><TD CLASS="l">124</TD><TD>                    unsupportedException = (UnsupportedCommand)ee.getCause();</TD></TR><TR CLASS="z"><TD CLASS="l">125</TD><TD>                    faiList.get(index).setUnsupportedCommand(cmd, arguments);</TD></TR><TR><TD CLASS="l">126</TD><TD>                }</TD></TR><TR><TD CLASS="l">127</TD><TD>                else{</TD></TR><TR CLASS="z"><TD CLASS="l">128</TD><TD>                    errorLog.println(&#34;Unable to set up ar command: &#34; + cmd + &#34; on process: &#34; + faiList.get(index).getOrbName());</TD></TR><TR CLASS="z"><TD CLASS="l">129</TD><TD>                    infoLog.println(&#34;Unable to set up ar command: &#34; + cmd + &#34; on process: &#34; + faiList.get(index).getOrbName());</TD></TR><TR CLASS="z"><TD CLASS="l">130</TD><TD>                    throw ee;</TD></TR><TR><TD CLASS="l">131</TD><TD>                }</TD></TR><TR><TD CLASS="l">132</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">133</TD><TD>            catch(Exception e){</TD></TR><TR CLASS="z"><TD CLASS="l">134</TD><TD>                exp = e;   </TD></TR><TR><TD CLASS="l">135</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">136</TD><TD>            if(timeout){</TD></TR><TR CLASS="z"><TD CLASS="l">137</TD><TD>                faiList.get(index).setTimeout(true);</TD></TR><TR CLASS="z"><TD CLASS="l">138</TD><TD>                errorLog.println(&#34;ar command: &#34; + cmd + &#34; on process: &#34; + faiList.get(index).getOrbName() + &#34; has timed out&#34;);</TD></TR><TR><TD CLASS="l">139</TD><TD>            }else{</TD></TR><TR CLASS="z"><TD CLASS="l">140</TD><TD>                faiList.get(index).setTimeout(false);</TD></TR><TR><TD CLASS="l">141</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">142</TD><TD>            if(arr.booleanValue() == false){</TD></TR><TR CLASS="z"><TD CLASS="l">143</TD><TD>                brr = false;</TD></TR><TR CLASS="z"><TD CLASS="l">144</TD><TD>                infoLog.println(&#34;Process: &#34; + faiList.get(index).getOrbName() + &#34; is not up&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">145</TD><TD>                errorLog.println(&#34;Process: &#34; + faiList.get(index).getOrbName() + &#34; is not up&#34;);</TD></TR><TR><TD CLASS="l">146</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">147</TD><TD>            index++;</TD></TR><TR><TD CLASS="l">148</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">149</TD><TD>        if (exp != null){</TD></TR><TR CLASS="z"><TD CLASS="l">150</TD><TD>            throw exp;</TD></TR><TR><TD CLASS="l">151</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">152</TD><TD>        if(!foundAtLeastOne &amp;&amp; unsupportedException != null){ //fail if no process implements the ar command</TD></TR><TR CLASS="z"><TD CLASS="l">153</TD><TD>            throw unsupportedException;</TD></TR><TR><TD CLASS="l">154</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">155</TD><TD>        return brr;</TD></TR><TR><TD CLASS="l">156</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="4">157</A></TD><TD> </TD></TR><TR><TD CLASS="l">158</TD><TD>    private List&lt;ArReturnResult&gt; executeAllInTwoPhases(StreamLogger errorLog,</TD></TR><TR><TD CLASS="l">159</TD><TD>            StreamLogger infoLog, long timeoutInMillis, ExecutorService tpe,  String p_cmd, String[] p_args, boolean ignoreUnsupported) throws Exception{</TD></TR><TR><TD CLASS="l">160</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">161</TD><TD>        ArrayList&lt;FastAdminInvoker&gt; firstPhase = new ArrayList&lt;FastAdminInvoker&gt;();</TD></TR><TR CLASS="z"><TD CLASS="l">162</TD><TD>        ArrayList&lt;FastAdminInvoker&gt; secondPhase = new ArrayList&lt;FastAdminInvoker&gt;();</TD></TR><TR><TD CLASS="l">163</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">164</TD><TD>        for(FastAdminInvoker fai:faiList){</TD></TR><TR CLASS="z"><TD CLASS="l">165</TD><TD>            if(fai.getOrbName().matches(secondPhasePattern)){</TD></TR><TR CLASS="z"><TD CLASS="l">166</TD><TD>                secondPhase.add(fai);</TD></TR><TR><TD CLASS="l">167</TD><TD>            }</TD></TR><TR><TD CLASS="l">168</TD><TD>            else{</TD></TR><TR CLASS="z"><TD CLASS="l">169</TD><TD>                firstPhase.add(fai);</TD></TR><TR><TD CLASS="l">170</TD><TD>            }</TD></TR><TR><TD CLASS="l">171</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">172</TD><TD>        ArrayList&lt;ArReturnResult&gt; rr = new ArrayList&lt;ArReturnResult&gt;();</TD></TR><TR CLASS="z"><TD CLASS="l">173</TD><TD>        if(firstPhase.size() &gt; 0){</TD></TR><TR CLASS="z"><TD CLASS="l">174</TD><TD>            rr.addAll(executeAll(errorLog, infoLog, timeoutInMillis, tpe, firstPhase, p_cmd, p_args, ignoreUnsupported));</TD></TR><TR><TD CLASS="l">175</TD><TD>        }</TD></TR><TR><TD CLASS="l">176</TD><TD>        // Check for a timeout. Do not execute second phase if the first one timed out</TD></TR><TR CLASS="z"><TD CLASS="l">177</TD><TD>        boolean timeout = false;</TD></TR><TR CLASS="z"><TD CLASS="l">178</TD><TD>        for(ArReturnResult arr:rr){</TD></TR><TR CLASS="z"><TD CLASS="l">179</TD><TD>            FastAdminInvoker fai = arr.getFai();</TD></TR><TR CLASS="z"><TD CLASS="l">180</TD><TD>            if(fai.isTimeout()){</TD></TR><TR CLASS="z"><TD CLASS="l">181</TD><TD>                timeout = true;</TD></TR><TR CLASS="z"><TD CLASS="l">182</TD><TD>                if(fai.getCmdHolder(p_cmd, p_args) != null){</TD></TR><TR CLASS="z"><TD CLASS="l">183</TD><TD>                    String[] commandSegments = fai.getCmdHolder(p_cmd, p_args).value.name.split(&#34;\\.&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">184</TD><TD>                    String commandName = commandSegments[commandSegments.length - 1];</TD></TR><TR CLASS="z"><TD CLASS="l">185</TD><TD>                    errorLog.println(&#34;Timeout occurred while executing ar command: &#34; + commandName + &#34; on process: &#34; + fai.getOrbName());</TD></TR><TR CLASS="z"><TD CLASS="l">186</TD><TD>                    infoLog.println(&#34;Timeout occurred while executing ar command: &#34; + commandName + &#34; on process: &#34; + fai.getOrbName());</TD></TR><TR><TD CLASS="l">187</TD><TD>                }</TD></TR><TR><TD CLASS="l">188</TD><TD>            }</TD></TR><TR><TD CLASS="l">189</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">190</TD><TD>        if(timeout){</TD></TR><TR CLASS="z"><TD CLASS="l">191</TD><TD>            StringBuilder aborted = new StringBuilder();</TD></TR><TR CLASS="z"><TD CLASS="l">192</TD><TD>            for(FastAdminInvoker fai:secondPhase){</TD></TR><TR CLASS="z"><TD CLASS="l">193</TD><TD>                if(aborted.length() &gt; 0){</TD></TR><TR CLASS="z"><TD CLASS="l">194</TD><TD>                  aborted.append(&#34;,&#34;);   </TD></TR><TR><TD CLASS="l">195</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">196</TD><TD>                aborted.append(fai.orbName);</TD></TR><TR><TD CLASS="l">197</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">198</TD><TD>            errorLog.println(&#34;Aborting ar command on the following processes: &#34; + aborted.toString());</TD></TR><TR CLASS="z"><TD CLASS="l">199</TD><TD>            infoLog.println(&#34;Aborting ar command on the following processes: &#34; + aborted.toString());</TD></TR><TR CLASS="z"><TD CLASS="l">200</TD><TD>            throw new TimeoutException(&#34;Aborted second phase of ar command&#34;);</TD></TR><TR><TD CLASS="l">201</TD><TD>        }</TD></TR><TR><TD CLASS="l">202</TD><TD> </TD></TR><TR><TD CLASS="l">203</TD><TD>    </TD></TR><TR CLASS="z"><TD CLASS="l">204</TD><TD>        if(secondPhase.size() &gt; 0){</TD></TR><TR CLASS="z"><TD CLASS="l">205</TD><TD>            rr.addAll(executeAll(errorLog, infoLog, timeoutInMillis, tpe, secondPhase, p_cmd, p_args, ignoreUnsupported));</TD></TR><TR><TD CLASS="l">206</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">207</TD><TD>        return rr;</TD></TR><TR><TD CLASS="l">208</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="2">209</A></TD><TD> </TD></TR><TR><TD CLASS="l">210</TD><TD>    private List&lt;ArReturnResult&gt; executeAll(StreamLogger errorLog,</TD></TR><TR><TD CLASS="l">211</TD><TD>            StreamLogger infoLog, long timeoutInMillis, ExecutorService tpe, List&lt;FastAdminInvoker&gt; p_fai, String p_cmd, String[] p_args, boolean ignoreUnsupported) throws Exception{</TD></TR><TR><TD CLASS="l">212</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">213</TD><TD>        Exception exp = null;</TD></TR><TR CLASS="z"><TD CLASS="l">214</TD><TD>        boolean timeout = false;</TD></TR><TR CLASS="z"><TD CLASS="l">215</TD><TD>        ArrayList&lt;String&gt; orbNames = new ArrayList&lt;String&gt;();</TD></TR><TR CLASS="z"><TD CLASS="l">216</TD><TD>        String commandName = null;</TD></TR><TR CLASS="z"><TD CLASS="l">217</TD><TD>        ArrayList&lt;Future&lt;ArReturnResult&gt;&gt; futures = new ArrayList&lt;Future&lt;ArReturnResult&gt;&gt;();</TD></TR><TR CLASS="z"><TD CLASS="l">218</TD><TD>        ArrayList&lt;ArReturnResult&gt; rr = new ArrayList&lt;ArReturnResult&gt;();</TD></TR><TR CLASS="z"><TD CLASS="l">219</TD><TD>        for(FastAdminInvoker fai:p_fai){</TD></TR><TR CLASS="z"><TD CLASS="l">220</TD><TD>            if(ignoreUnsupported){</TD></TR><TR CLASS="z"><TD CLASS="l">221</TD><TD>                if(fai.isKnownUnsupportedCommand(p_cmd, p_args)){</TD></TR><TR CLASS="z"><TD CLASS="l">222</TD><TD>                    String arguments = &#34;&#34;;</TD></TR><TR CLASS="z"><TD CLASS="l">223</TD><TD>                    for(int i= 0 ; i &lt; p_args.length; i++){</TD></TR><TR CLASS="z"><TD CLASS="l">224</TD><TD>                        arguments = arguments + &#34; &#34; + p_args[i];</TD></TR><TR><TD CLASS="l">225</TD><TD>                    }</TD></TR><TR CLASS="z"><TD CLASS="l">226</TD><TD>                    errorLog.println(&#34;Skipping process: &#34; + fai.getOrbName() + &#34; for command: &#34; + p_cmd + &#34; args: &#34; +  arguments + &#34; as requested by the caller&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">227</TD><TD>                    continue;</TD></TR><TR><TD CLASS="l">228</TD><TD>                }</TD></TR><TR><TD CLASS="l">229</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">230</TD><TD>            CommandHolder cmdHolder = fai.getCmdHolder(p_cmd, p_args);</TD></TR><TR CLASS="z"><TD CLASS="l">231</TD><TD>            if(cmdHolder == null){</TD></TR><TR CLASS="z"><TD CLASS="l">232</TD><TD>                String arguments = &#34;&#34;;</TD></TR><TR CLASS="z"><TD CLASS="l">233</TD><TD>                for(int i= 0 ; i &lt; p_args.length; i++){</TD></TR><TR CLASS="z"><TD CLASS="l">234</TD><TD>                    arguments = arguments + &#34; &#34; + p_args[i];</TD></TR><TR><TD CLASS="l">235</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">236</TD><TD>                errorLog.println(&#34;Warning skipping process: &#34; + fai.getOrbName() + &#34; for command: &#34; + p_cmd + &#34; args: &#34; +  arguments + &#34; since the process is probably down&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">237</TD><TD>                infoLog.println(&#34;Warning skipping process: &#34; + fai.getOrbName() + &#34; for command: &#34; + p_cmd + &#34; args: &#34; +  arguments + &#34; since the process is probably down&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">238</TD><TD>                continue; //This one process is probably down. Continue to the next one.</TD></TR><TR><TD CLASS="l">239</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">240</TD><TD>                ArCommand arCmd = new ArCommand(fai, p_cmd, p_args);</TD></TR><TR CLASS="z"><TD CLASS="l">241</TD><TD>                String[] commandSegments = cmdHolder.value.name.split(&#34;\\.&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">242</TD><TD>                commandName = commandSegments[commandSegments.length - 1];</TD></TR><TR CLASS="z"><TD CLASS="l">243</TD><TD>                errorLog.println(&#34;Executing ar command: &#34; + commandName + &#34; on process: &#34; + fai.getOrbName());</TD></TR><TR CLASS="z"><TD CLASS="l">244</TD><TD>                Future&lt;ArReturnResult&gt; rrFuture = tpe.submit(arCmd);</TD></TR><TR CLASS="z"><TD CLASS="l">245</TD><TD>                futures.add(rrFuture);</TD></TR><TR CLASS="z"><TD CLASS="l">246</TD><TD>                orbNames.add(fai.getOrbName());</TD></TR><TR><TD CLASS="l">247</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">248</TD><TD>        int index =0;</TD></TR><TR CLASS="z"><TD CLASS="l">249</TD><TD>        ArReturnResult arr = null;</TD></TR><TR CLASS="z"><TD CLASS="l">250</TD><TD>        for(Future&lt;ArReturnResult&gt; ft:futures){</TD></TR><TR><TD CLASS="l">251</TD><TD>            try{</TD></TR><TR CLASS="z"><TD CLASS="l">252</TD><TD>                timeout =  false;</TD></TR><TR CLASS="z"><TD CLASS="l">253</TD><TD>                arr = ft.get(timeoutInMillis, TimeUnit.MILLISECONDS);</TD></TR><TR><TD CLASS="l">254</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">255</TD><TD>            catch(TimeoutException toe){</TD></TR><TR CLASS="z"><TD CLASS="l">256</TD><TD>                timeout = true;</TD></TR><TR CLASS="z"><TD CLASS="l">257</TD><TD>                int idx = futures.indexOf(ft);</TD></TR><TR CLASS="z"><TD CLASS="l">258</TD><TD>                if(idx == -1){</TD></TR><TR CLASS="z"><TD CLASS="l">259</TD><TD>                 continue;   </TD></TR><TR><TD CLASS="l">260</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">261</TD><TD>                FastAdminInvoker fai = p_fai.get(idx);</TD></TR><TR CLASS="z"><TD CLASS="l">262</TD><TD>                arr = new ArReturnResult();</TD></TR><TR CLASS="z"><TD CLASS="l">263</TD><TD>                arr.setFai(fai);</TD></TR><TR><TD CLASS="l">264</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">265</TD><TD>            catch(Exception e){</TD></TR><TR CLASS="z"><TD CLASS="l">266</TD><TD>                String error = &#34;Failed to execute ar command: &#34; + commandName + &#34; on process: &#34; + orbNames.get(index);</TD></TR><TR CLASS="z"><TD CLASS="l">267</TD><TD>                errorLog.exception(error, e);</TD></TR><TR CLASS="z"><TD CLASS="l">268</TD><TD>                infoLog.println(error);</TD></TR><TR CLASS="z"><TD CLASS="l">269</TD><TD>                exp = e;   </TD></TR><TR><TD CLASS="l">270</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">271</TD><TD>            if(timeout){</TD></TR><TR CLASS="z"><TD CLASS="l">272</TD><TD>                faiList.get(index).setTimeout(true);   </TD></TR><TR CLASS="z"><TD CLASS="l">273</TD><TD>                errorLog.println(&#34;Command: &#34; + commandName + &#34; on process: &#34; + orbNames.get(index) + &#34; has timed out&#34;);</TD></TR><TR><TD CLASS="l">274</TD><TD>            }else{</TD></TR><TR CLASS="z"><TD CLASS="l">275</TD><TD>                faiList.get(index).setTimeout(false);   </TD></TR><TR CLASS="z"><TD CLASS="l">276</TD><TD>                errorLog.println(&#34;Successfully executed ar command: &#34; + commandName + &#34; on process: &#34; + orbNames.get(index));</TD></TR><TR><TD CLASS="l">277</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">278</TD><TD>            rr.add(arr);</TD></TR><TR CLASS="z"><TD CLASS="l">279</TD><TD>            index++;</TD></TR><TR><TD CLASS="l">280</TD><TD>        }</TD></TR><TR><TD CLASS="l">281</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">282</TD><TD>        if (exp != null){</TD></TR><TR CLASS="z"><TD CLASS="l">283</TD><TD>            throw exp;</TD></TR><TR><TD CLASS="l">284</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">285</TD><TD>        return rr;</TD></TR><TR><TD CLASS="l"><A NAME="3">286</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">287</TD><TD> </TD></TR><TR><TD CLASS="l">288</TD><TD>    public List&lt;ArReturnResult&gt; executeAll(StreamLogger errorLog,</TD></TR><TR><TD CLASS="l">289</TD><TD>            StreamLogger infoLog, long timeoutInMillis, ExecutorService tpe, String p_cmd, String[] p_args, boolean ignoreUnsupported) throws Exception{</TD></TR><TR CLASS="z"><TD CLASS="l">290</TD><TD>        if(secondPhasePattern == null){</TD></TR><TR CLASS="z"><TD CLASS="l">291</TD><TD>            return executeAll(errorLog, infoLog, timeoutInMillis, tpe, faiList, p_cmd, p_args, ignoreUnsupported);</TD></TR><TR><TD CLASS="l">292</TD><TD>        }else{</TD></TR><TR CLASS="z"><TD CLASS="l">293</TD><TD>            return executeAllInTwoPhases(errorLog, infoLog, timeoutInMillis, tpe, p_cmd, p_args, ignoreUnsupported);            </TD></TR><TR><TD CLASS="l">294</TD><TD>        }</TD></TR><TR><TD CLASS="l">295</TD><TD>    }</TD></TR><TR><TD CLASS="l">296</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../Coverage.html">all classes</A>][<A HREF="134.html">com.cboe.domain.util.adminRequest</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://www.eclemma.org/support.html">EMMA 2.0.5312 EclEmma Fix 2</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>